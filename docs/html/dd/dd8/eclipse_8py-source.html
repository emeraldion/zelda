<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/generator/eclipse.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css">
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/generator/eclipse.py</h1><a href="../../d8/d83/eclipse_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html">00001</a> <span class="comment"># Copyright (c) 2012 Google Inc. All rights reserved.</span>
<a name="l00002"></a>00002 <span class="comment"># Use of this source code is governed by a BSD-style license that can be</span>
<a name="l00003"></a>00003 <span class="comment"># found in the LICENSE file.</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="stringliteral">"""GYP backend that generates Eclipse CDT settings files.</span>
<a name="l00006"></a>00006 <span class="stringliteral"></span>
<a name="l00007"></a>00007 <span class="stringliteral">This backend DOES NOT generate Eclipse CDT projects. Instead, it generates XML</span>
<a name="l00008"></a>00008 <span class="stringliteral">files that can be imported into an Eclipse CDT project. The XML file contains a</span>
<a name="l00009"></a>00009 <span class="stringliteral">list of include paths and symbols (i.e. defines).</span>
<a name="l00010"></a>00010 <span class="stringliteral"></span>
<a name="l00011"></a>00011 <span class="stringliteral">Because a full .cproject definition is not created by this generator, it's not</span>
<a name="l00012"></a>00012 <span class="stringliteral">possible to properly define the include dirs and symbols for each file</span>
<a name="l00013"></a>00013 <span class="stringliteral">individually.  Instead, one set of includes/symbols is generated for the entire</span>
<a name="l00014"></a>00014 <span class="stringliteral">project.  This works fairly well (and is a vast improvement in general), but may</span>
<a name="l00015"></a>00015 <span class="stringliteral">still result in a few indexer issues here and there.</span>
<a name="l00016"></a>00016 <span class="stringliteral"></span>
<a name="l00017"></a>00017 <span class="stringliteral">This generator has no automated tests, so expect it to be broken.</span>
<a name="l00018"></a>00018 <span class="stringliteral">"""</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">from</span> xml.sax.saxutils <span class="keyword">import</span> escape
<a name="l00021"></a>00021 <span class="keyword">import</span> os.path
<a name="l00022"></a>00022 <span class="keyword">import</span> subprocess
<a name="l00023"></a>00023 <span class="keyword">import</span> gyp
<a name="l00024"></a>00024 <span class="keyword">import</span> gyp.common
<a name="l00025"></a>00025 <span class="keyword">import</span> gyp.msvs_emulation
<a name="l00026"></a>00026 <span class="keyword">import</span> shlex
<a name="l00027"></a>00027 <span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#742c3ccb9a26ca9509de3fa9c76f75a6">00029</a> generator_wants_static_library_dependencies_adjusted = <span class="keyword">False</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#723b572dde78d9a873e8b0c7936f0624">00031</a> generator_default_variables = {
<a name="l00032"></a>00032 }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keywordflow">for</span> dirname <span class="keywordflow">in</span> [<span class="stringliteral">'INTERMEDIATE_DIR'</span>, <span class="stringliteral">'PRODUCT_DIR'</span>, <span class="stringliteral">'LIB_DIR'</span>, <span class="stringliteral">'SHARED_LIB_DIR'</span>]:
<a name="l00035"></a>00035   <span class="comment"># Some gyp steps fail if these are empty(!), so we convert them to variables</span>
<a name="l00036"></a>00036   generator_default_variables[dirname] = <span class="stringliteral">'$'</span> + dirname
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keywordflow">for</span> unused <span class="keywordflow">in</span> [<span class="stringliteral">'RULE_INPUT_PATH'</span>, <span class="stringliteral">'RULE_INPUT_ROOT'</span>, <span class="stringliteral">'RULE_INPUT_NAME'</span>,
<a name="l00039"></a>00039                <span class="stringliteral">'RULE_INPUT_DIRNAME'</span>, <span class="stringliteral">'RULE_INPUT_EXT'</span>,
<a name="l00040"></a>00040                <span class="stringliteral">'EXECUTABLE_PREFIX'</span>, <span class="stringliteral">'EXECUTABLE_SUFFIX'</span>,
<a name="l00041"></a>00041                <span class="stringliteral">'STATIC_LIB_PREFIX'</span>, <span class="stringliteral">'STATIC_LIB_SUFFIX'</span>,
<a name="l00042"></a>00042                <span class="stringliteral">'SHARED_LIB_PREFIX'</span>, <span class="stringliteral">'SHARED_LIB_SUFFIX'</span>,
<a name="l00043"></a>00043                <span class="stringliteral">'CONFIGURATION_NAME'</span>]:
<a name="l00044"></a>00044   generator_default_variables[unused] = <span class="stringliteral">''</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment"># Include dirs will occasionally use the SHARED_INTERMEDIATE_DIR variable as</span>
<a name="l00047"></a>00047 <span class="comment"># part of the path when dealing with generated headers.  This value will be</span>
<a name="l00048"></a>00048 <span class="comment"># replaced dynamically for each configuration.</span>
<a name="l00049"></a>00049 generator_default_variables[<span class="stringliteral">'SHARED_INTERMEDIATE_DIR'</span>] = \
<a name="l00050"></a>00050     <span class="stringliteral">'$SHARED_INTERMEDIATE_DIR'</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#e076159dcdcd8e1fdf6a7cc9b8ce87cb">00053</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#e076159dcdcd8e1fdf6a7cc9b8ce87cb">CalculateVariables</a>(default_variables, params):
<a name="l00054"></a>00054   generator_flags = params.get(<span class="stringliteral">'generator_flags'</span>, {})
<a name="l00055"></a>00055   <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> generator_flags.items():
<a name="l00056"></a>00056     default_variables.setdefault(key, val)
<a name="l00057"></a>00057   flavor = gyp.common.GetFlavor(params)
<a name="l00058"></a>00058   default_variables.setdefault(<span class="stringliteral">'OS'</span>, flavor)
<a name="l00059"></a>00059   <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00060"></a>00060     <span class="comment"># Copy additional generator configuration data from VS, which is shared</span>
<a name="l00061"></a>00061     <span class="comment"># by the Eclipse generator.</span>
<a name="l00062"></a>00062     <span class="keyword">import</span> gyp.generator.msvs <span class="keyword">as</span> msvs_generator
<a name="l00063"></a>00063     generator_additional_non_configuration_keys = getattr(msvs_generator,
<a name="l00064"></a>00064         <span class="stringliteral">'generator_additional_non_configuration_keys'</span>, [])
<a name="l00065"></a>00065     generator_additional_path_sections = getattr(msvs_generator,
<a name="l00066"></a>00066         <span class="stringliteral">'generator_additional_path_sections'</span>, [])
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     gyp.msvs_emulation.CalculateCommonVariables(default_variables, params)
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#a09b93353f4d3bbb8119cdd12b40cfa5">00071</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#a09b93353f4d3bbb8119cdd12b40cfa5">CalculateGeneratorInputInfo</a>(params):
<a name="l00072"></a>00072   <span class="stringliteral">"""Calculate the generator specific info that gets fed to input (called by</span>
<a name="l00073"></a>00073 <span class="stringliteral">  gyp)."""</span>
<a name="l00074"></a>00074   generator_flags = params.get(<span class="stringliteral">'generator_flags'</span>, {})
<a name="l00075"></a>00075   <span class="keywordflow">if</span> generator_flags.get(<span class="stringliteral">'adjust_static_libraries'</span>, <span class="keyword">False</span>):
<a name="l00076"></a>00076     <span class="keyword">global</span> generator_wants_static_library_dependencies_adjusted
<a name="l00077"></a>00077     generator_wants_static_library_dependencies_adjusted = <span class="keyword">True</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#03d121264bb0c00ceaee36e080ee87d8">00080</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#03d121264bb0c00ceaee36e080ee87d8">GetAllIncludeDirectories</a>(target_list, target_dicts,
<a name="l00081"></a>00081                              shared_intermediate_dirs, config_name, params,
<a name="l00082"></a>00082                              compiler_path):
<a name="l00083"></a>00083   <span class="stringliteral">"""Calculate the set of include directories to be used.</span>
<a name="l00084"></a>00084 <span class="stringliteral"></span>
<a name="l00085"></a>00085 <span class="stringliteral">  Returns:</span>
<a name="l00086"></a>00086 <span class="stringliteral">    A list including all the include_dir's specified for every target followed</span>
<a name="l00087"></a>00087 <span class="stringliteral">    by any include directories that were added as cflag compiler options.</span>
<a name="l00088"></a>00088 <span class="stringliteral">  """</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   gyp_includes_set = set()
<a name="l00091"></a>00091   compiler_includes_list = []
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment"># Find compiler's default include dirs.</span>
<a name="l00094"></a>00094   <span class="keywordflow">if</span> compiler_path:
<a name="l00095"></a>00095     command = shlex.split(compiler_path)
<a name="l00096"></a>00096     command.extend([<span class="stringliteral">'-E'</span>, <span class="stringliteral">'-xc++'</span>, <span class="stringliteral">'-v'</span>, <span class="stringliteral">'-'</span>])
<a name="l00097"></a>00097     proc = subprocess.Popen(args=command, stdin=subprocess.PIPE,
<a name="l00098"></a>00098                             stdout=subprocess.PIPE, stderr=subprocess.PIPE)
<a name="l00099"></a>00099     output = proc.communicate()[1]
<a name="l00100"></a>00100     <span class="comment"># Extract the list of include dirs from the output, which has this format:</span>
<a name="l00101"></a>00101     <span class="comment">#   ...</span>
<a name="l00102"></a>00102     <span class="comment">#   #include "..." search starts here:</span>
<a name="l00103"></a>00103     <span class="comment">#   #include &lt;...&gt; search starts here:</span>
<a name="l00104"></a>00104     <span class="comment">#    /usr/include/c++/4.6</span>
<a name="l00105"></a>00105     <span class="comment">#    /usr/local/include</span>
<a name="l00106"></a>00106     <span class="comment">#   End of search list.</span>
<a name="l00107"></a>00107     <span class="comment">#   ...</span>
<a name="l00108"></a>00108     in_include_list = <span class="keyword">False</span>
<a name="l00109"></a>00109     <span class="keywordflow">for</span> line <span class="keywordflow">in</span> output.splitlines():
<a name="l00110"></a>00110       <span class="keywordflow">if</span> line.startswith(<span class="stringliteral">'#include'</span>):
<a name="l00111"></a>00111         in_include_list = <span class="keyword">True</span>
<a name="l00112"></a>00112         <span class="keywordflow">continue</span>
<a name="l00113"></a>00113       <span class="keywordflow">if</span> line.startswith(<span class="stringliteral">'End of search list.'</span>):
<a name="l00114"></a>00114         <span class="keywordflow">break</span>
<a name="l00115"></a>00115       <span class="keywordflow">if</span> in_include_list:
<a name="l00116"></a>00116         include_dir = line.strip()
<a name="l00117"></a>00117         <span class="keywordflow">if</span> include_dir <span class="keywordflow">not</span> <span class="keywordflow">in</span> compiler_includes_list:
<a name="l00118"></a>00118           compiler_includes_list.append(include_dir)
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   flavor = gyp.common.GetFlavor(params)
<a name="l00121"></a>00121   <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00122"></a>00122     generator_flags = params.get(<span class="stringliteral">'generator_flags'</span>, {})
<a name="l00123"></a>00123   <span class="keywordflow">for</span> target_name <span class="keywordflow">in</span> target_list:
<a name="l00124"></a>00124     target = target_dicts[target_name]
<a name="l00125"></a>00125     <span class="keywordflow">if</span> config_name <span class="keywordflow">in</span> target[<span class="stringliteral">'configurations'</span>]:
<a name="l00126"></a>00126       config = target[<span class="stringliteral">'configurations'</span>][config_name]
<a name="l00127"></a>00127 
<a name="l00128"></a>00128       <span class="comment"># Look for any include dirs that were explicitly added via cflags. This</span>
<a name="l00129"></a>00129       <span class="comment"># may be done in gyp files to force certain includes to come at the end.</span>
<a name="l00130"></a>00130       <span class="comment"># TODO(jgreenwald): Change the gyp files to not abuse cflags for this, and</span>
<a name="l00131"></a>00131       <span class="comment"># remove this.</span>
<a name="l00132"></a>00132       <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00133"></a>00133         msvs_settings = gyp.msvs_emulation.MsvsSettings(target, generator_flags)
<a name="l00134"></a>00134         cflags = msvs_settings.GetCflags(config_name)
<a name="l00135"></a>00135       <span class="keywordflow">else</span>:
<a name="l00136"></a>00136         cflags = config[<span class="stringliteral">'cflags'</span>]
<a name="l00137"></a>00137       <span class="keywordflow">for</span> cflag <span class="keywordflow">in</span> cflags:
<a name="l00138"></a>00138         <span class="keywordflow">if</span> cflag.startswith(<span class="stringliteral">'-I'</span>):
<a name="l00139"></a>00139           include_dir = cflag[2:]
<a name="l00140"></a>00140           <span class="keywordflow">if</span> include_dir <span class="keywordflow">not</span> <span class="keywordflow">in</span> compiler_includes_list:
<a name="l00141"></a>00141             compiler_includes_list.append(include_dir)
<a name="l00142"></a>00142 
<a name="l00143"></a>00143       <span class="comment"># Find standard gyp include dirs.</span>
<a name="l00144"></a>00144       <span class="keywordflow">if</span> config.has_key(<span class="stringliteral">'include_dirs'</span>):
<a name="l00145"></a>00145         include_dirs = config[<span class="stringliteral">'include_dirs'</span>]
<a name="l00146"></a>00146         <span class="keywordflow">for</span> shared_intermediate_dir <span class="keywordflow">in</span> shared_intermediate_dirs:
<a name="l00147"></a>00147           <span class="keywordflow">for</span> include_dir <span class="keywordflow">in</span> include_dirs:
<a name="l00148"></a>00148             include_dir = include_dir.replace(<span class="stringliteral">'$SHARED_INTERMEDIATE_DIR'</span>,
<a name="l00149"></a>00149                                               shared_intermediate_dir)
<a name="l00150"></a>00150             <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isabs(include_dir):
<a name="l00151"></a>00151               base_dir = os.path.dirname(target_name)
<a name="l00152"></a>00152 
<a name="l00153"></a>00153               include_dir = base_dir + <span class="stringliteral">'/'</span> + include_dir
<a name="l00154"></a>00154               include_dir = os.path.abspath(include_dir)
<a name="l00155"></a>00155 
<a name="l00156"></a>00156             gyp_includes_set.add(include_dir)
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   <span class="comment"># Generate a list that has all the include dirs.</span>
<a name="l00159"></a>00159   all_includes_list = list(gyp_includes_set)
<a name="l00160"></a>00160   all_includes_list.sort()
<a name="l00161"></a>00161   <span class="keywordflow">for</span> compiler_include <span class="keywordflow">in</span> compiler_includes_list:
<a name="l00162"></a>00162     <span class="keywordflow">if</span> <span class="keywordflow">not</span> compiler_include <span class="keywordflow">in</span> gyp_includes_set:
<a name="l00163"></a>00163       all_includes_list.append(compiler_include)
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="comment"># All done.</span>
<a name="l00166"></a>00166   <span class="keywordflow">return</span> all_includes_list
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#57ec660e68414d9c1a983a704346eec5">00169</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#57ec660e68414d9c1a983a704346eec5">GetCompilerPath</a>(target_list, data, options):
<a name="l00170"></a>00170   <span class="stringliteral">"""Determine a command that can be used to invoke the compiler.</span>
<a name="l00171"></a>00171 <span class="stringliteral"></span>
<a name="l00172"></a>00172 <span class="stringliteral">  Returns:</span>
<a name="l00173"></a>00173 <span class="stringliteral">    If this is a gyp project that has explicit make settings, try to determine</span>
<a name="l00174"></a>00174 <span class="stringliteral">    the compiler from that.  Otherwise, see if a compiler was specified via the</span>
<a name="l00175"></a>00175 <span class="stringliteral">    CC_target environment variable.</span>
<a name="l00176"></a>00176 <span class="stringliteral">  """</span>
<a name="l00177"></a>00177   <span class="comment"># First, see if the compiler is configured in make's settings.</span>
<a name="l00178"></a>00178   build_file, _, _ = gyp.common.ParseQualifiedTarget(target_list[0])
<a name="l00179"></a>00179   make_global_settings_dict = data[build_file].get(<span class="stringliteral">'make_global_settings'</span>, {})
<a name="l00180"></a>00180   <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> make_global_settings_dict:
<a name="l00181"></a>00181     <span class="keywordflow">if</span> key <span class="keywordflow">in</span> [<span class="stringliteral">'CC'</span>, <span class="stringliteral">'CXX'</span>]:
<a name="l00182"></a>00182       <span class="keywordflow">return</span> os.path.join(options.toplevel_dir, value)
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment"># Check to see if the compiler was specified as an environment variable.</span>
<a name="l00185"></a>00185   <span class="keywordflow">for</span> key <span class="keywordflow">in</span> [<span class="stringliteral">'CC_target'</span>, <span class="stringliteral">'CC'</span>, <span class="stringliteral">'CXX'</span>]:
<a name="l00186"></a>00186     compiler = os.environ.get(key)
<a name="l00187"></a>00187     <span class="keywordflow">if</span> compiler:
<a name="l00188"></a>00188       <span class="keywordflow">return</span> compiler
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="keywordflow">return</span> <span class="stringliteral">'gcc'</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#ab5414261441e9e474592b9303d360b9">00193</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#ab5414261441e9e474592b9303d360b9">GetAllDefines</a>(target_list, target_dicts, data, config_name, params,
<a name="l00194"></a>00194                   compiler_path):
<a name="l00195"></a>00195   <span class="stringliteral">"""Calculate the defines for a project.</span>
<a name="l00196"></a>00196 <span class="stringliteral"></span>
<a name="l00197"></a>00197 <span class="stringliteral">  Returns:</span>
<a name="l00198"></a>00198 <span class="stringliteral">    A dict that includes explict defines declared in gyp files along with all of</span>
<a name="l00199"></a>00199 <span class="stringliteral">    the default defines that the compiler uses.</span>
<a name="l00200"></a>00200 <span class="stringliteral">  """</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="comment"># Get defines declared in the gyp files.</span>
<a name="l00203"></a>00203   all_defines = {}
<a name="l00204"></a>00204   flavor = gyp.common.GetFlavor(params)
<a name="l00205"></a>00205   <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00206"></a>00206     generator_flags = params.get(<span class="stringliteral">'generator_flags'</span>, {})
<a name="l00207"></a>00207   <span class="keywordflow">for</span> target_name <span class="keywordflow">in</span> target_list:
<a name="l00208"></a>00208     target = target_dicts[target_name]
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00211"></a>00211       msvs_settings = gyp.msvs_emulation.MsvsSettings(target, generator_flags)
<a name="l00212"></a>00212       extra_defines = msvs_settings.GetComputedDefines(config_name)
<a name="l00213"></a>00213     <span class="keywordflow">else</span>:
<a name="l00214"></a>00214       extra_defines = []
<a name="l00215"></a>00215     <span class="keywordflow">if</span> config_name <span class="keywordflow">in</span> target[<span class="stringliteral">'configurations'</span>]:
<a name="l00216"></a>00216       config = target[<span class="stringliteral">'configurations'</span>][config_name]
<a name="l00217"></a>00217       target_defines = config[<span class="stringliteral">'defines'</span>]
<a name="l00218"></a>00218     <span class="keywordflow">else</span>:
<a name="l00219"></a>00219       target_defines = []
<a name="l00220"></a>00220     <span class="keywordflow">for</span> define <span class="keywordflow">in</span> target_defines + extra_defines:
<a name="l00221"></a>00221       split_define = define.split(<span class="stringliteral">'='</span>, 1)
<a name="l00222"></a>00222       <span class="keywordflow">if</span> len(split_define) == 1:
<a name="l00223"></a>00223         split_define.append(<span class="stringliteral">'1'</span>)
<a name="l00224"></a>00224       <span class="keywordflow">if</span> split_define[0].strip() <span class="keywordflow">in</span> all_defines:
<a name="l00225"></a>00225         <span class="comment"># Already defined</span>
<a name="l00226"></a>00226         <span class="keywordflow">continue</span>
<a name="l00227"></a>00227       all_defines[split_define[0].strip()] = split_define[1].strip()
<a name="l00228"></a>00228   <span class="comment"># Get default compiler defines (if possible).</span>
<a name="l00229"></a>00229   <span class="keywordflow">if</span> flavor == <span class="stringliteral">'win'</span>:
<a name="l00230"></a>00230     <span class="keywordflow">return</span> all_defines  <span class="comment"># Default defines already processed in the loop above.</span>
<a name="l00231"></a>00231   <span class="keywordflow">if</span> compiler_path:
<a name="l00232"></a>00232     command = shlex.split(compiler_path)
<a name="l00233"></a>00233     command.extend([<span class="stringliteral">'-E'</span>, <span class="stringliteral">'-dM'</span>, <span class="stringliteral">'-'</span>])
<a name="l00234"></a>00234     cpp_proc = subprocess.Popen(args=command, cwd=<span class="stringliteral">'.'</span>,
<a name="l00235"></a>00235                                 stdin=subprocess.PIPE, stdout=subprocess.PIPE)
<a name="l00236"></a>00236     cpp_output = cpp_proc.communicate()[0]
<a name="l00237"></a>00237     cpp_lines = cpp_output.split(<span class="stringliteral">'\n'</span>)
<a name="l00238"></a>00238     <span class="keywordflow">for</span> cpp_line <span class="keywordflow">in</span> cpp_lines:
<a name="l00239"></a>00239       <span class="keywordflow">if</span> <span class="keywordflow">not</span> cpp_line.strip():
<a name="l00240"></a>00240         <span class="keywordflow">continue</span>
<a name="l00241"></a>00241       cpp_line_parts = cpp_line.split(<span class="stringliteral">' '</span>, 2)
<a name="l00242"></a>00242       key = cpp_line_parts[1]
<a name="l00243"></a>00243       <span class="keywordflow">if</span> len(cpp_line_parts) &gt;= 3:
<a name="l00244"></a>00244         val = cpp_line_parts[2]
<a name="l00245"></a>00245       <span class="keywordflow">else</span>:
<a name="l00246"></a>00246         val = <span class="stringliteral">'1'</span>
<a name="l00247"></a>00247       all_defines[key] = val
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="keywordflow">return</span> all_defines
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#ea5b417f6086467643c509b53e9fa9eb">00252</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#ea5b417f6086467643c509b53e9fa9eb">WriteIncludePaths</a>(out, eclipse_langs, include_dirs):
<a name="l00253"></a>00253   <span class="stringliteral">"""Write the includes section of a CDT settings export file."""</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   out.write(<span class="stringliteral">'  &lt;section name="org.eclipse.cdt.internal.ui.wizards.'</span> \
<a name="l00256"></a>00256             <span class="stringliteral">'settingswizards.IncludePaths"&gt;\n'</span>)
<a name="l00257"></a>00257   out.write(<span class="stringliteral">'    &lt;language name="holder for library settings"&gt;&lt;/language&gt;\n'</span>)
<a name="l00258"></a>00258   <span class="keywordflow">for</span> lang <span class="keywordflow">in</span> eclipse_langs:
<a name="l00259"></a>00259     out.write(<span class="stringliteral">'    &lt;language name="%s"&gt;\n'</span> % lang)
<a name="l00260"></a>00260     <span class="keywordflow">for</span> include_dir <span class="keywordflow">in</span> include_dirs:
<a name="l00261"></a>00261       out.write(<span class="stringliteral">'      &lt;includepath workspace_path="false"&gt;%s&lt;/includepath&gt;\n'</span> %
<a name="l00262"></a>00262                 include_dir)
<a name="l00263"></a>00263     out.write(<span class="stringliteral">'    &lt;/language&gt;\n'</span>)
<a name="l00264"></a>00264   out.write(<span class="stringliteral">'  &lt;/section&gt;\n'</span>)
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#7ced13c9e8b6fcc18c07d89b00cbfbce">00267</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#7ced13c9e8b6fcc18c07d89b00cbfbce">WriteMacros</a>(out, eclipse_langs, defines):
<a name="l00268"></a>00268   <span class="stringliteral">"""Write the macros section of a CDT settings export file."""</span>
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   out.write(<span class="stringliteral">'  &lt;section name="org.eclipse.cdt.internal.ui.wizards.'</span> \
<a name="l00271"></a>00271             <span class="stringliteral">'settingswizards.Macros"&gt;\n'</span>)
<a name="l00272"></a>00272   out.write(<span class="stringliteral">'    &lt;language name="holder for library settings"&gt;&lt;/language&gt;\n'</span>)
<a name="l00273"></a>00273   <span class="keywordflow">for</span> lang <span class="keywordflow">in</span> eclipse_langs:
<a name="l00274"></a>00274     out.write(<span class="stringliteral">'    &lt;language name="%s"&gt;\n'</span> % lang)
<a name="l00275"></a>00275     <span class="keywordflow">for</span> key <span class="keywordflow">in</span> sorted(defines.iterkeys()):
<a name="l00276"></a>00276       out.write(<span class="stringliteral">'      &lt;macro&gt;&lt;name&gt;%s&lt;/name&gt;&lt;value&gt;%s&lt;/value&gt;&lt;/macro&gt;\n'</span> %
<a name="l00277"></a>00277                 (escape(key), escape(defines[key])))
<a name="l00278"></a>00278     out.write(<span class="stringliteral">'    &lt;/language&gt;\n'</span>)
<a name="l00279"></a>00279   out.write(<span class="stringliteral">'  &lt;/section&gt;\n'</span>)
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#552d3841f0dee013455c393f202e31c7">00282</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#552d3841f0dee013455c393f202e31c7">GenerateOutputForConfig</a>(target_list, target_dicts, data, params,
<a name="l00283"></a>00283                             config_name):
<a name="l00284"></a>00284   options = params[<span class="stringliteral">'options'</span>]
<a name="l00285"></a>00285   generator_flags = params.get(<span class="stringliteral">'generator_flags'</span>, {})
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="comment"># build_dir: relative path from source root to our output files.</span>
<a name="l00288"></a>00288   <span class="comment"># e.g. "out/Debug"</span>
<a name="l00289"></a>00289   build_dir = os.path.join(generator_flags.get(<span class="stringliteral">'output_dir'</span>, <span class="stringliteral">'out'</span>),
<a name="l00290"></a>00290                            config_name)
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   toplevel_build = os.path.join(options.toplevel_dir, build_dir)
<a name="l00293"></a>00293   <span class="comment"># Ninja uses out/Debug/gen while make uses out/Debug/obj/gen as the</span>
<a name="l00294"></a>00294   <span class="comment"># SHARED_INTERMEDIATE_DIR. Include both possible locations.</span>
<a name="l00295"></a>00295   shared_intermediate_dirs = [os.path.join(toplevel_build, <span class="stringliteral">'obj'</span>, <span class="stringliteral">'gen'</span>),
<a name="l00296"></a>00296                               os.path.join(toplevel_build, <span class="stringliteral">'gen'</span>)]
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   GenerateCdtSettingsFile(target_list,
<a name="l00299"></a>00299                           target_dicts,
<a name="l00300"></a>00300                           data,
<a name="l00301"></a>00301                           params,
<a name="l00302"></a>00302                           config_name,
<a name="l00303"></a>00303                           os.path.join(toplevel_build,
<a name="l00304"></a>00304                                        <span class="stringliteral">'eclipse-cdt-settings.xml'</span>),
<a name="l00305"></a>00305                           options,
<a name="l00306"></a>00306                           shared_intermediate_dirs)
<a name="l00307"></a>00307   GenerateClasspathFile(target_list,
<a name="l00308"></a>00308                         target_dicts,
<a name="l00309"></a>00309                         options.toplevel_dir,
<a name="l00310"></a>00310                         toplevel_build,
<a name="l00311"></a>00311                         os.path.join(toplevel_build,
<a name="l00312"></a>00312                                      <span class="stringliteral">'eclipse-classpath.xml'</span>))
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#bee9095a3a1e837e387223c1ed2bb452">00315</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#bee9095a3a1e837e387223c1ed2bb452">GenerateCdtSettingsFile</a>(target_list, target_dicts, data, params,
<a name="l00316"></a>00316                             config_name, out_name, options,
<a name="l00317"></a>00317                             shared_intermediate_dirs):
<a name="l00318"></a>00318   gyp.common.EnsureDirExists(out_name)
<a name="l00319"></a>00319   with open(out_name, <span class="stringliteral">'w'</span>) <span class="keyword">as</span> out:
<a name="l00320"></a>00320     out.write(<span class="stringliteral">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)
<a name="l00321"></a>00321     out.write(<span class="stringliteral">'&lt;cdtprojectproperties&gt;\n'</span>)
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     eclipse_langs = [<span class="stringliteral">'C++ Source File'</span>, <span class="stringliteral">'C Source File'</span>, <span class="stringliteral">'Assembly Source File'</span>,
<a name="l00324"></a>00324                      <span class="stringliteral">'GNU C++'</span>, <span class="stringliteral">'GNU C'</span>, <span class="stringliteral">'Assembly'</span>]
<a name="l00325"></a>00325     compiler_path = GetCompilerPath(target_list, data, options)
<a name="l00326"></a>00326     include_dirs = GetAllIncludeDirectories(target_list, target_dicts,
<a name="l00327"></a>00327                                             shared_intermediate_dirs,
<a name="l00328"></a>00328                                             config_name, params, compiler_path)
<a name="l00329"></a>00329     WriteIncludePaths(out, eclipse_langs, include_dirs)
<a name="l00330"></a>00330     defines = GetAllDefines(target_list, target_dicts, data, config_name,
<a name="l00331"></a>00331                             params, compiler_path)
<a name="l00332"></a>00332     WriteMacros(out, eclipse_langs, defines)
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     out.write(<span class="stringliteral">'&lt;/cdtprojectproperties&gt;\n'</span>)
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#f09bf131e8bcdb7078efde7c31975b40">00337</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#f09bf131e8bcdb7078efde7c31975b40">GenerateClasspathFile</a>(target_list, target_dicts, toplevel_dir,
<a name="l00338"></a>00338                           toplevel_build, out_name):
<a name="l00339"></a>00339   <span class="stringliteral">'''Generates a classpath file suitable for symbol navigation and code</span>
<a name="l00340"></a>00340 <span class="stringliteral">  completion of Java code (such as in Android projects) by finding all</span>
<a name="l00341"></a>00341 <span class="stringliteral">  .java and .jar files used as action inputs.'''</span>
<a name="l00342"></a>00342   gyp.common.EnsureDirExists(out_name)
<a name="l00343"></a>00343   result = ET.Element(<span class="stringliteral">'classpath'</span>)
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="keyword">def </span>AddElements(kind, paths):
<a name="l00346"></a>00346     <span class="comment"># First, we need to normalize the paths so they are all relative to the</span>
<a name="l00347"></a>00347     <span class="comment"># toplevel dir.</span>
<a name="l00348"></a>00348     rel_paths = set()
<a name="l00349"></a>00349     <span class="keywordflow">for</span> path <span class="keywordflow">in</span> paths:
<a name="l00350"></a>00350       <span class="keywordflow">if</span> os.path.isabs(path):
<a name="l00351"></a>00351         rel_paths.add(os.path.relpath(path, toplevel_dir))
<a name="l00352"></a>00352       <span class="keywordflow">else</span>:
<a name="l00353"></a>00353         rel_paths.add(path)
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     <span class="keywordflow">for</span> path <span class="keywordflow">in</span> sorted(rel_paths):
<a name="l00356"></a>00356       entry_element = ET.SubElement(result, <span class="stringliteral">'classpathentry'</span>)
<a name="l00357"></a>00357       entry_element.set(<span class="stringliteral">'kind'</span>, kind)
<a name="l00358"></a>00358       entry_element.set(<span class="stringliteral">'path'</span>, path)
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   AddElements(<span class="stringliteral">'lib'</span>, GetJavaJars(target_list, target_dicts, toplevel_dir))
<a name="l00361"></a>00361   AddElements(<span class="stringliteral">'src'</span>, GetJavaSourceDirs(target_list, target_dicts, toplevel_dir))
<a name="l00362"></a>00362   <span class="comment"># Include the standard JRE container and a dummy out folder</span>
<a name="l00363"></a>00363   AddElements(<span class="stringliteral">'con'</span>, [<span class="stringliteral">'org.eclipse.jdt.launching.JRE_CONTAINER'</span>])
<a name="l00364"></a>00364   <span class="comment"># Include a dummy out folder so that Eclipse doesn't use the default /bin</span>
<a name="l00365"></a>00365   <span class="comment"># folder in the root of the project.</span>
<a name="l00366"></a>00366   AddElements(<span class="stringliteral">'output'</span>, [os.path.join(toplevel_build, <span class="stringliteral">'.eclipse-java-build'</span>)])
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   ET.ElementTree(result).write(out_name)
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#26dc5f513266f64e57e940aa493cd93a">00371</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#26dc5f513266f64e57e940aa493cd93a">GetJavaJars</a>(target_list, target_dicts, toplevel_dir):
<a name="l00372"></a>00372   <span class="stringliteral">'''Generates a sequence of all .jars used as inputs.'''</span>
<a name="l00373"></a>00373   <span class="keywordflow">for</span> target_name <span class="keywordflow">in</span> target_list:
<a name="l00374"></a>00374     target = target_dicts[target_name]
<a name="l00375"></a>00375     <span class="keywordflow">for</span> action <span class="keywordflow">in</span> target.get(<span class="stringliteral">'actions'</span>, []):
<a name="l00376"></a>00376       <span class="keywordflow">for</span> input_ <span class="keywordflow">in</span> action[<span class="stringliteral">'inputs'</span>]:
<a name="l00377"></a>00377         <span class="keywordflow">if</span> os.path.splitext(input_)[1] == <span class="stringliteral">'.jar'</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> input_.startswith(<span class="stringliteral">'$'</span>):
<a name="l00378"></a>00378           <span class="keywordflow">if</span> os.path.isabs(input_):
<a name="l00379"></a>00379             <span class="keywordflow">yield</span> input_
<a name="l00380"></a>00380           <span class="keywordflow">else</span>:
<a name="l00381"></a>00381             <span class="keywordflow">yield</span> os.path.join(os.path.dirname(target_name), input_)
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#3e23bb1aa65033a3c48c471def200e91">00384</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#3e23bb1aa65033a3c48c471def200e91">GetJavaSourceDirs</a>(target_list, target_dicts, toplevel_dir):
<a name="l00385"></a>00385   <span class="stringliteral">'''Generates a sequence of all likely java package root directories.'''</span>
<a name="l00386"></a>00386   <span class="keywordflow">for</span> target_name <span class="keywordflow">in</span> target_list:
<a name="l00387"></a>00387     target = target_dicts[target_name]
<a name="l00388"></a>00388     <span class="keywordflow">for</span> action <span class="keywordflow">in</span> target.get(<span class="stringliteral">'actions'</span>, []):
<a name="l00389"></a>00389       <span class="keywordflow">for</span> input_ <span class="keywordflow">in</span> action[<span class="stringliteral">'inputs'</span>]:
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (os.path.splitext(input_)[1] == <span class="stringliteral">'.java'</span> <span class="keywordflow">and</span>
<a name="l00391"></a>00391             <span class="keywordflow">not</span> input_.startswith(<span class="stringliteral">'$'</span>)):
<a name="l00392"></a>00392           dir_ = os.path.dirname(os.path.join(os.path.dirname(target_name),
<a name="l00393"></a>00393                                               input_))
<a name="l00394"></a>00394           <span class="comment"># If there is a parent 'src' or 'java' folder, navigate up to it -</span>
<a name="l00395"></a>00395           <span class="comment"># these are canonical package root names in Chromium.  This will</span>
<a name="l00396"></a>00396           <span class="comment"># break if 'src' or 'java' exists in the package structure. This</span>
<a name="l00397"></a>00397           <span class="comment"># could be further improved by inspecting the java file for the</span>
<a name="l00398"></a>00398           <span class="comment"># package name if this proves to be too fragile in practice.</span>
<a name="l00399"></a>00399           parent_search = dir_
<a name="l00400"></a>00400           <span class="keywordflow">while</span> os.path.basename(parent_search) <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'src'</span>, <span class="stringliteral">'java'</span>]:
<a name="l00401"></a>00401             parent_search, _ = os.path.split(parent_search)
<a name="l00402"></a>00402             <span class="keywordflow">if</span> <span class="keywordflow">not</span> parent_search <span class="keywordflow">or</span> parent_search == toplevel_dir:
<a name="l00403"></a>00403               <span class="comment"># Didn't find a known root, just return the original path</span>
<a name="l00404"></a>00404               <span class="keywordflow">yield</span> dir_
<a name="l00405"></a>00405               <span class="keywordflow">break</span>
<a name="l00406"></a>00406           <span class="keywordflow">else</span>:
<a name="l00407"></a>00407             <span class="keywordflow">yield</span> parent_search
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#6ce087aeccec92abe0604e753693d505">00410</a> <span class="keyword">def </span><a class="code" href="../../de/d6a/namespacegyp_1_1generator_1_1eclipse.html#6ce087aeccec92abe0604e753693d505">GenerateOutput</a>(target_list, target_dicts, data, params):
<a name="l00411"></a>00411   <span class="stringliteral">"""Generate an XML settings file that can be imported into a CDT project."""</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="keywordflow">if</span> params[<span class="stringliteral">'options'</span>].generator_output:
<a name="l00414"></a>00414     <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">"--generator_output not implemented for eclipse"</span>)
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   user_config = params.get(<span class="stringliteral">'generator_flags'</span>, {}).get(<span class="stringliteral">'config'</span>, <span class="keywordtype">None</span>)
<a name="l00417"></a>00417   <span class="keywordflow">if</span> user_config:
<a name="l00418"></a>00418     GenerateOutputForConfig(target_list, target_dicts, data, params,
<a name="l00419"></a>00419                             user_config)
<a name="l00420"></a>00420   <span class="keywordflow">else</span>:
<a name="l00421"></a>00421     config_names = target_dicts[target_list[0]][<span class="stringliteral">'configurations'</span>].keys()
<a name="l00422"></a>00422     <span class="keywordflow">for</span> config_name <span class="keywordflow">in</span> config_names:
<a name="l00423"></a>00423       GenerateOutputForConfig(target_list, target_dicts, data, params,
<a name="l00424"></a>00424                               config_name)
<a name="l00425"></a>00425 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 7 19:26:26 2015 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
