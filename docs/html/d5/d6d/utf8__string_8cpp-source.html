<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/src/libsass/utf8_string.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css">
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/src/libsass/utf8_string.cpp</h1><a href="../../df/d7c/utf8__string_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="../../db/d7c/utf8_8h.html">utf8.h</a>"</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="keyword">namespace </span>Sass {
<a name="l00009"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html">00009</a>   <span class="keyword">namespace </span>UTF_8 {
<a name="l00010"></a>00010     <span class="keyword">using</span> std::string;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012     <span class="comment">// naming conventions:</span>
<a name="l00013"></a>00013     <span class="comment">// offset: raw byte offset (0 based)</span>
<a name="l00014"></a>00014     <span class="comment">// position: code point offset (0 based)</span>
<a name="l00015"></a>00015     <span class="comment">// index: code point offset (1 based or negative)</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017     <span class="comment">// function that will count the number of code points (utf-8 characters) from the given beginning to the given end</span>
<a name="l00018"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#ac097e39ce41130cebe659b21f2888b2">00018</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#ac097e39ce41130cebe659b21f2888b2">code_point_count</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end) {
<a name="l00019"></a>00019       <span class="keywordflow">return</span> <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b953789c1614e335f9fc8a6b2f150a63">utf8::distance</a>(str.begin() + start, str.begin() + end);
<a name="l00020"></a>00020     }
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#a81f24b7331bf326a3b8a1879f8e99fe">00022</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#ac097e39ce41130cebe659b21f2888b2">code_point_count</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str) {
<a name="l00023"></a>00023       <span class="keywordflow">return</span> <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b953789c1614e335f9fc8a6b2f150a63">utf8::distance</a>(str.begin(), str.end());
<a name="l00024"></a>00024     }
<a name="l00025"></a>00025 
<a name="l00026"></a>00026     <span class="comment">// function that will return the byte offset at a code point position</span>
<a name="l00027"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#d4b22d3b318a59067509d9a1f803417d">00027</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#d4b22d3b318a59067509d9a1f803417d">offset_at_position</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str, <span class="keywordtype">size_t</span> position) {
<a name="l00028"></a>00028       string::const_iterator it = str.begin();
<a name="l00029"></a>00029       <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b508df817c7aaaf3d86938161e44f30a">utf8::advance</a>(it, position, str.end());
<a name="l00030"></a>00030       <span class="keywordflow">return</span> <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b953789c1614e335f9fc8a6b2f150a63">distance</a>(str.begin(), it);
<a name="l00031"></a>00031     }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     <span class="comment">// function that returns number of bytes in a character at offset</span>
<a name="l00034"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#1ff0e785483ccec2fbd3388b01b0055a">00034</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#1ff0e785483ccec2fbd3388b01b0055a">code_point_size_at_offset</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str, <span class="keywordtype">size_t</span> offset) {
<a name="l00035"></a>00035       <span class="comment">// get iterator from string and forward by offset</span>
<a name="l00036"></a>00036       string::const_iterator stop = str.begin() + offset;
<a name="l00037"></a>00037       <span class="comment">// check if beyond boundary</span>
<a name="l00038"></a>00038       <span class="keywordflow">if</span> (stop == str.end()) <span class="keywordflow">return</span> 0;
<a name="l00039"></a>00039       <span class="comment">// advance by one code point</span>
<a name="l00040"></a>00040       <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b508df817c7aaaf3d86938161e44f30a">utf8::advance</a>(stop, 1, str.end());
<a name="l00041"></a>00041       <span class="comment">// calculate offset for code point</span>
<a name="l00042"></a>00042       <span class="keywordflow">return</span>  stop - str.begin() - offset;
<a name="l00043"></a>00043     }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="comment">// function that will return a normalized index, given a crazy one</span>
<a name="l00046"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#cb0719982edaa6677dab63fdd504cb3f">00046</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#cb0719982edaa6677dab63fdd504cb3f">normalize_index</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">size_t</span> len) {
<a name="l00047"></a>00047       <span class="keywordtype">long</span> signed_len = <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(len);
<a name="l00048"></a>00048       <span class="comment">// assuming the index is 1-based</span>
<a name="l00049"></a>00049       <span class="comment">// we are returning a 0-based index</span>
<a name="l00050"></a>00050       <span class="keywordflow">if</span> (index &gt; 0 &amp;&amp; index &lt;= signed_len) {
<a name="l00051"></a>00051         <span class="comment">// positive and within string length</span>
<a name="l00052"></a>00052         <span class="keywordflow">return</span> index-1;
<a name="l00053"></a>00053       }
<a name="l00054"></a>00054       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index &gt; signed_len) {
<a name="l00055"></a>00055         <span class="comment">// positive and past string length</span>
<a name="l00056"></a>00056         <span class="keywordflow">return</span> len;
<a name="l00057"></a>00057       }
<a name="l00058"></a>00058       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == 0) {
<a name="l00059"></a>00059         <span class="keywordflow">return</span> 0;
<a name="l00060"></a>00060       }
<a name="l00061"></a>00061       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::abs((<span class="keywordtype">double</span>)index) &lt;= signed_len) {
<a name="l00062"></a>00062         <span class="comment">// negative and within string length</span>
<a name="l00063"></a>00063         <span class="keywordflow">return</span> index + signed_len;
<a name="l00064"></a>00064       }
<a name="l00065"></a>00065       <span class="keywordflow">else</span> {
<a name="l00066"></a>00066         <span class="comment">// negative and past string length</span>
<a name="l00067"></a>00067         <span class="keywordflow">return</span> 0;
<a name="l00068"></a>00068       }
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="comment">// utf16 functions</span>
<a name="l00072"></a>00072     <span class="keyword">using</span> std::wstring;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="comment">// convert from utf16/wide string to utf8 string</span>
<a name="l00075"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#5756d5e7ef584dc248ef93098e1df4f2">00075</a>     <span class="keywordtype">string</span> <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#5756d5e7ef584dc248ef93098e1df4f2">convert_from_utf16</a>(<span class="keyword">const</span> wstring&amp; utf16)
<a name="l00076"></a>00076     {
<a name="l00077"></a>00077       <span class="keywordtype">string</span> utf8;
<a name="l00078"></a>00078       <span class="comment">// pre-allocate expected memory</span>
<a name="l00079"></a>00079       utf8.reserve(<span class="keyword">sizeof</span>(utf16)/2);
<a name="l00080"></a>00080       <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#b457ef1e13f47b358c9d7c06a1ea02b5">utf8::utf16to8</a>(utf16.begin(), utf16.end(),
<a name="l00081"></a>00081                      back_inserter(utf8));
<a name="l00082"></a>00082       <span class="keywordflow">return</span> utf8;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">// convert from utf8 string to utf16/wide string</span>
<a name="l00086"></a><a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#08b3e5c2e9feb01061ff49e59a4a323e">00086</a>     wstring <a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#08b3e5c2e9feb01061ff49e59a4a323e">convert_to_utf16</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; utf8)
<a name="l00087"></a>00087     {
<a name="l00088"></a>00088       wstring utf16;
<a name="l00089"></a>00089       <span class="comment">// pre-allocate expected memory</span>
<a name="l00090"></a>00090       utf16.reserve(<a class="code" href="../../d5/d16/namespace_sass_1_1_u_t_f__8.html#ac097e39ce41130cebe659b21f2888b2">code_point_count</a>(utf8)*2);
<a name="l00091"></a>00091       <a class="code" href="../../d1/d1d/namespaceutf8_1_1unchecked.html#e3e28916ae35ebc1e58291f6a0fe402f">utf8::utf8to16</a>(utf8.begin(), utf8.end(),
<a name="l00092"></a>00092                      back_inserter(utf16));
<a name="l00093"></a>00093       <span class="keywordflow">return</span> utf16;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   }
<a name="l00097"></a>00097 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 7 19:26:30 2015 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
