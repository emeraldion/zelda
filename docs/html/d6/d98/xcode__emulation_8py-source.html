<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/xcode_emulation.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css">
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/xcode_emulation.py</h1><a href="../../d1/ded/xcode__emulation_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html">00001</a> <span class="comment"># Copyright (c) 2012 Google Inc. All rights reserved.</span>
<a name="l00002"></a>00002 <span class="comment"># Use of this source code is governed by a BSD-style license that can be</span>
<a name="l00003"></a>00003 <span class="comment"># found in the LICENSE file.</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="stringliteral">"""</span>
<a name="l00006"></a>00006 <span class="stringliteral">This module contains classes that help to emulate xcodebuild behavior on top of</span>
<a name="l00007"></a>00007 <span class="stringliteral">other build systems, such as make and ninja.</span>
<a name="l00008"></a>00008 <span class="stringliteral">"""</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">import</span> copy
<a name="l00011"></a>00011 <span class="keyword">import</span> gyp.common
<a name="l00012"></a>00012 <span class="keyword">import</span> os
<a name="l00013"></a>00013 <span class="keyword">import</span> os.path
<a name="l00014"></a>00014 <span class="keyword">import</span> re
<a name="l00015"></a>00015 <span class="keyword">import</span> shlex
<a name="l00016"></a>00016 <span class="keyword">import</span> subprocess
<a name="l00017"></a>00017 <span class="keyword">import</span> sys
<a name="l00018"></a>00018 <span class="keyword">import</span> tempfile
<a name="l00019"></a>00019 <span class="keyword">from</span> gyp.common <span class="keyword">import</span> GypError
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment"># Populated lazily by XcodeVersion, for efficiency, and to fix an issue when</span>
<a name="l00022"></a>00022 <span class="comment"># "xcodebuild" is called too quickly (it has been found to return incorrect</span>
<a name="l00023"></a>00023 <span class="comment"># version number).</span>
<a name="l00024"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#ac83533dfab72d53ff253a23bf2c396e">00024</a> XCODE_VERSION_CACHE = <span class="keywordtype">None</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment"># Populated lazily by GetXcodeArchsDefault, to an |XcodeArchsDefault| instance</span>
<a name="l00027"></a>00027 <span class="comment"># corresponding to the installed version of Xcode.</span>
<a name="l00028"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#f2ec91ed2f68100c135252c88e396bd5">00028</a> XCODE_ARCHS_DEFAULT_CACHE = <span class="keywordtype">None</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a46840db8162ee41adf5a1b429352af8">00031</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a46840db8162ee41adf5a1b429352af8">XcodeArchsVariableMapping</a>(archs, archs_including_64_bit=None):
<a name="l00032"></a>00032   <span class="stringliteral">"""Constructs a dictionary with expansion for $(ARCHS_STANDARD) variable,</span>
<a name="l00033"></a>00033 <span class="stringliteral">  and optionally for $(ARCHS_STANDARD_INCLUDING_64_BIT)."""</span>
<a name="l00034"></a>00034   mapping = {<span class="stringliteral">'$(ARCHS_STANDARD)'</span>: archs}
<a name="l00035"></a>00035   <span class="keywordflow">if</span> archs_including_64_bit:
<a name="l00036"></a>00036     mapping[<span class="stringliteral">'$(ARCHS_STANDARD_INCLUDING_64_BIT)'</span>] = archs_including_64_bit
<a name="l00037"></a>00037   <span class="keywordflow">return</span> mapping
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html">00039</a> <span class="keyword">class </span><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html">XcodeArchsDefault</a>(object):
<a name="l00040"></a>00040   <span class="stringliteral">"""A class to resolve ARCHS variable from xcode_settings, resolving Xcode</span>
<a name="l00041"></a>00041 <span class="stringliteral">  macros and implementing filtering by VALID_ARCHS. The expansion of macros</span>
<a name="l00042"></a>00042 <span class="stringliteral">  depends on the SDKROOT used ("macosx", "iphoneos", "iphonesimulator") and</span>
<a name="l00043"></a>00043 <span class="stringliteral">  on the version of Xcode.</span>
<a name="l00044"></a>00044 <span class="stringliteral">  """</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment"># Match variable like $(ARCHS_STANDARD).</span>
<a name="l00047"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#9f99be55d3e5b2af50f7bed53e7e1711">00047</a>   variable_pattern = re.compile(<span class="stringliteral">r'\$\([a-zA-Z_][a-zA-Z0-9_]*\)$'</span>)
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#c775ee34451fdfa742b318538164070e">00049</a>   <span class="keyword">def </span><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#c775ee34451fdfa742b318538164070e">__init__</a>(self, default, mac, iphonesimulator, iphoneos):
<a name="l00050"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#e4f497877dd40af9020f6ca122302f41">00050</a>     self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#e4f497877dd40af9020f6ca122302f41">_default</a> = (default,)
<a name="l00051"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#81b5028c044cd7944b30b169da54d96f">00051</a>     self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#81b5028c044cd7944b30b169da54d96f">_archs</a> = {<span class="stringliteral">'mac'</span>: mac, <span class="stringliteral">'ios'</span>: iphoneos, <span class="stringliteral">'iossim'</span>: iphonesimulator}
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#a878c5efb6a25fd654012db1223f69ef">00053</a>   <span class="keyword">def </span><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#a878c5efb6a25fd654012db1223f69ef">_VariableMapping</a>(self, sdkroot):
<a name="l00054"></a>00054     <span class="stringliteral">"""Returns the dictionary of variable mapping depending on the SDKROOT."""</span>
<a name="l00055"></a>00055     sdkroot = sdkroot.lower()
<a name="l00056"></a>00056     <span class="keywordflow">if</span> <span class="stringliteral">'iphoneos'</span> <span class="keywordflow">in</span> sdkroot:
<a name="l00057"></a>00057       <span class="keywordflow">return</span> self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#81b5028c044cd7944b30b169da54d96f">_archs</a>[<span class="stringliteral">'ios'</span>]
<a name="l00058"></a>00058     <span class="keywordflow">elif</span> <span class="stringliteral">'iphonesimulator'</span> <span class="keywordflow">in</span> sdkroot:
<a name="l00059"></a>00059       <span class="keywordflow">return</span> self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#81b5028c044cd7944b30b169da54d96f">_archs</a>[<span class="stringliteral">'iossim'</span>]
<a name="l00060"></a>00060     <span class="keywordflow">else</span>:
<a name="l00061"></a>00061       <span class="keywordflow">return</span> self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#81b5028c044cd7944b30b169da54d96f">_archs</a>[<span class="stringliteral">'mac'</span>]
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#3133f6aa7303898cb75ab241fe2b9375">00063</a>   <span class="keyword">def </span><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#3133f6aa7303898cb75ab241fe2b9375">_ExpandArchs</a>(self, archs, sdkroot):
<a name="l00064"></a>00064     <span class="stringliteral">"""Expands variables references in ARCHS, and remove duplicates."""</span>
<a name="l00065"></a>00065     variable_mapping = self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#a878c5efb6a25fd654012db1223f69ef">_VariableMapping</a>(sdkroot)
<a name="l00066"></a>00066     expanded_archs = []
<a name="l00067"></a>00067     <span class="keywordflow">for</span> arch <span class="keywordflow">in</span> archs:
<a name="l00068"></a>00068       <span class="keywordflow">if</span> self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#9f99be55d3e5b2af50f7bed53e7e1711">variable_pattern</a>.match(arch):
<a name="l00069"></a>00069         variable = arch
<a name="l00070"></a>00070         <span class="keywordflow">try</span>:
<a name="l00071"></a>00071           variable_expansion = variable_mapping[variable]
<a name="l00072"></a>00072           <span class="keywordflow">for</span> arch <span class="keywordflow">in</span> variable_expansion:
<a name="l00073"></a>00073             <span class="keywordflow">if</span> arch <span class="keywordflow">not</span> <span class="keywordflow">in</span> expanded_archs:
<a name="l00074"></a>00074               expanded_archs.append(arch)
<a name="l00075"></a>00075         <span class="keywordflow">except</span> KeyError <span class="keyword">as</span> e:
<a name="l00076"></a>00076           <span class="keywordflow">print</span> <span class="stringliteral">'Warning: Ignoring unsupported variable "%s".'</span> % variable
<a name="l00077"></a>00077       <span class="keywordflow">elif</span> arch <span class="keywordflow">not</span> <span class="keywordflow">in</span> expanded_archs:
<a name="l00078"></a>00078         expanded_archs.append(arch)
<a name="l00079"></a>00079     <span class="keywordflow">return</span> expanded_archs
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#db213fc9b15011112c768dd3c82e87fb">00081</a>   <span class="keyword">def </span><a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#db213fc9b15011112c768dd3c82e87fb">ActiveArchs</a>(self, archs, valid_archs, sdkroot):
<a name="l00082"></a>00082     <span class="stringliteral">"""Expands variables references in ARCHS, and filter by VALID_ARCHS if it</span>
<a name="l00083"></a>00083 <span class="stringliteral">    is defined (if not set, Xcode accept any value in ARCHS, otherwise, only</span>
<a name="l00084"></a>00084 <span class="stringliteral">    values present in VALID_ARCHS are kept)."""</span>
<a name="l00085"></a>00085     expanded_archs = self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#3133f6aa7303898cb75ab241fe2b9375">_ExpandArchs</a>(archs <span class="keywordflow">or</span> self.<a class="code" href="../../da/db4/classgyp_1_1xcode__emulation_1_1_xcode_archs_default.html#e4f497877dd40af9020f6ca122302f41">_default</a>, sdkroot <span class="keywordflow">or</span> <span class="stringliteral">''</span>)
<a name="l00086"></a>00086     <span class="keywordflow">if</span> valid_archs:
<a name="l00087"></a>00087       filtered_archs = []
<a name="l00088"></a>00088       <span class="keywordflow">for</span> arch <span class="keywordflow">in</span> expanded_archs:
<a name="l00089"></a>00089         <span class="keywordflow">if</span> arch <span class="keywordflow">in</span> valid_archs:
<a name="l00090"></a>00090           filtered_archs.append(arch)
<a name="l00091"></a>00091       expanded_archs = filtered_archs
<a name="l00092"></a>00092     <span class="keywordflow">return</span> expanded_archs
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#00903b307c821049963be0e946fdc3cc">00095</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#00903b307c821049963be0e946fdc3cc">GetXcodeArchsDefault</a>():
<a name="l00096"></a>00096   <span class="stringliteral">"""Returns the |XcodeArchsDefault| object to use to expand ARCHS for the</span>
<a name="l00097"></a>00097 <span class="stringliteral">  installed version of Xcode. The default values used by Xcode for ARCHS</span>
<a name="l00098"></a>00098 <span class="stringliteral">  and the expansion of the variables depends on the version of Xcode used.</span>
<a name="l00099"></a>00099 <span class="stringliteral"></span>
<a name="l00100"></a>00100 <span class="stringliteral">  For all version anterior to Xcode 5.0 or posterior to Xcode 5.1 included</span>
<a name="l00101"></a>00101 <span class="stringliteral">  uses $(ARCHS_STANDARD) if ARCHS is unset, while Xcode 5.0 to 5.0.2 uses</span>
<a name="l00102"></a>00102 <span class="stringliteral">  $(ARCHS_STANDARD_INCLUDING_64_BIT). This variable was added to Xcode 5.0</span>
<a name="l00103"></a>00103 <span class="stringliteral">  and deprecated with Xcode 5.1.</span>
<a name="l00104"></a>00104 <span class="stringliteral"></span>
<a name="l00105"></a>00105 <span class="stringliteral">  For "macosx" SDKROOT, all version starting with Xcode 5.0 includes 64-bit</span>
<a name="l00106"></a>00106 <span class="stringliteral">  architecture as part of $(ARCHS_STANDARD) and default to only building it.</span>
<a name="l00107"></a>00107 <span class="stringliteral"></span>
<a name="l00108"></a>00108 <span class="stringliteral">  For "iphoneos" and "iphonesimulator" SDKROOT, 64-bit architectures are part</span>
<a name="l00109"></a>00109 <span class="stringliteral">  of $(ARCHS_STANDARD_INCLUDING_64_BIT) from Xcode 5.0. From Xcode 5.1, they</span>
<a name="l00110"></a>00110 <span class="stringliteral">  are also part of $(ARCHS_STANDARD).</span>
<a name="l00111"></a>00111 <span class="stringliteral"></span>
<a name="l00112"></a>00112 <span class="stringliteral">  All thoses rules are coded in the construction of the |XcodeArchsDefault|</span>
<a name="l00113"></a>00113 <span class="stringliteral">  object to use depending on the version of Xcode detected. The object is</span>
<a name="l00114"></a>00114 <span class="stringliteral">  for performance reason."""</span>
<a name="l00115"></a>00115   <span class="keyword">global</span> XCODE_ARCHS_DEFAULT_CACHE
<a name="l00116"></a>00116   <span class="keywordflow">if</span> XCODE_ARCHS_DEFAULT_CACHE:
<a name="l00117"></a>00117     <span class="keywordflow">return</span> XCODE_ARCHS_DEFAULT_CACHE
<a name="l00118"></a>00118   xcode_version, _ = XcodeVersion()
<a name="l00119"></a>00119   <span class="keywordflow">if</span> xcode_version &lt; <span class="stringliteral">'0500'</span>:
<a name="l00120"></a>00120     XCODE_ARCHS_DEFAULT_CACHE = XcodeArchsDefault(
<a name="l00121"></a>00121         <span class="stringliteral">'$(ARCHS_STANDARD)'</span>,
<a name="l00122"></a>00122         XcodeArchsVariableMapping([<span class="stringliteral">'i386'</span>]),
<a name="l00123"></a>00123         XcodeArchsVariableMapping([<span class="stringliteral">'i386'</span>]),
<a name="l00124"></a>00124         XcodeArchsVariableMapping([<span class="stringliteral">'armv7'</span>]))
<a name="l00125"></a>00125   <span class="keywordflow">elif</span> xcode_version &lt; <span class="stringliteral">'0510'</span>:
<a name="l00126"></a>00126     XCODE_ARCHS_DEFAULT_CACHE = XcodeArchsDefault(
<a name="l00127"></a>00127         <span class="stringliteral">'$(ARCHS_STANDARD_INCLUDING_64_BIT)'</span>,
<a name="l00128"></a>00128         XcodeArchsVariableMapping([<span class="stringliteral">'x86_64'</span>], [<span class="stringliteral">'x86_64'</span>]),
<a name="l00129"></a>00129         XcodeArchsVariableMapping([<span class="stringliteral">'i386'</span>], [<span class="stringliteral">'i386'</span>, <span class="stringliteral">'x86_64'</span>]),
<a name="l00130"></a>00130         XcodeArchsVariableMapping(
<a name="l00131"></a>00131             [<span class="stringliteral">'armv7'</span>, <span class="stringliteral">'armv7s'</span>],
<a name="l00132"></a>00132             [<span class="stringliteral">'armv7'</span>, <span class="stringliteral">'armv7s'</span>, <span class="stringliteral">'arm64'</span>]))
<a name="l00133"></a>00133   <span class="keywordflow">else</span>:
<a name="l00134"></a>00134     XCODE_ARCHS_DEFAULT_CACHE = XcodeArchsDefault(
<a name="l00135"></a>00135         <span class="stringliteral">'$(ARCHS_STANDARD)'</span>,
<a name="l00136"></a>00136         XcodeArchsVariableMapping([<span class="stringliteral">'x86_64'</span>], [<span class="stringliteral">'x86_64'</span>]),
<a name="l00137"></a>00137         XcodeArchsVariableMapping([<span class="stringliteral">'i386'</span>, <span class="stringliteral">'x86_64'</span>], [<span class="stringliteral">'i386'</span>, <span class="stringliteral">'x86_64'</span>]),
<a name="l00138"></a>00138         XcodeArchsVariableMapping(
<a name="l00139"></a>00139             [<span class="stringliteral">'armv7'</span>, <span class="stringliteral">'armv7s'</span>, <span class="stringliteral">'arm64'</span>],
<a name="l00140"></a>00140             [<span class="stringliteral">'armv7'</span>, <span class="stringliteral">'armv7s'</span>, <span class="stringliteral">'arm64'</span>]))
<a name="l00141"></a>00141   <span class="keywordflow">return</span> XCODE_ARCHS_DEFAULT_CACHE
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html">00144</a> <span class="keyword">class </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html">XcodeSettings</a>(object):
<a name="l00145"></a>00145   <span class="stringliteral">"""A class that understands the gyp 'xcode_settings' object."""</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <span class="comment"># Populated lazily by _SdkPath(). Shared by all XcodeSettings, so cached</span>
<a name="l00148"></a>00148   <span class="comment"># at class-level for efficiency.</span>
<a name="l00149"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#07e68bfb6847a609a829c5dc82000bc8">00149</a>   _sdk_path_cache = {}
<a name="l00150"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e2ad2fe45dc9e1c89752154e1e28e319">00150</a>   _sdk_root_cache = {}
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment"># Populated lazily by GetExtraPlistItems(). Shared by all XcodeSettings, so</span>
<a name="l00153"></a>00153   <span class="comment"># cached at class-level for efficiency.</span>
<a name="l00154"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f3ff0ccf4f801d65a8ab27171256fa1b">00154</a>   _plist_cache = {}
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="comment"># Populated lazily by GetIOSPostbuilds.  Shared by all XcodeSettings, so</span>
<a name="l00157"></a>00157   <span class="comment"># cached at class-level for efficiency.</span>
<a name="l00158"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#aedfa761851ff8292093991754b61352">00158</a>   _codesigning_key_cache = {}
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c775ee34451fdfa742b318538164070e">00160</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c775ee34451fdfa742b318538164070e">__init__</a>(self, spec):
<a name="l00161"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">00161</a>     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a> = spec
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">00163</a>     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a> = <span class="keyword">False</span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="comment"># Per-target 'xcode_settings' are pushed down into configs earlier by gyp.</span>
<a name="l00166"></a>00166     <span class="comment"># This means self.xcode_settings[config] always contains all settings</span>
<a name="l00167"></a>00167     <span class="comment"># for that config -- the per-target settings as well. Settings that are</span>
<a name="l00168"></a>00168     <span class="comment"># the same for all configs are implicitly per-target settings.</span>
<a name="l00169"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">00169</a>     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a> = {}
<a name="l00170"></a>00170     configs = spec[<span class="stringliteral">'configurations'</span>]
<a name="l00171"></a>00171     <span class="keywordflow">for</span> configname, config <span class="keywordflow">in</span> configs.iteritems():
<a name="l00172"></a>00172       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname] = config.get(<span class="stringliteral">'xcode_settings'</span>, {})
<a name="l00173"></a>00173       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9a7a2df8e6ec7c2762aa301a74700f23">_ConvertConditionalKeys</a>(configname)
<a name="l00174"></a>00174       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(<span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span>,
<a name="l00175"></a>00175                                              <span class="keywordtype">None</span>):
<a name="l00176"></a>00176         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a> = <span class="keyword">True</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="comment"># This is only non-None temporarily during the execution of some methods.</span>
<a name="l00179"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">00179</a>     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment"># Used by _AdjustLibrary to match .a and .dylib entries in libraries.</span>
<a name="l00182"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#34e0988bcc40626e8d76373fabacbf4c">00182</a>     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#34e0988bcc40626e8d76373fabacbf4c">library_re</a> = re.compile(<span class="stringliteral">r'^lib([^/]+)\.(a|dylib)$'</span>)
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9a7a2df8e6ec7c2762aa301a74700f23">00184</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9a7a2df8e6ec7c2762aa301a74700f23">_ConvertConditionalKeys</a>(self, configname):
<a name="l00185"></a>00185     <span class="stringliteral">"""Converts or warns on conditional keys.  Xcode supports conditional keys,</span>
<a name="l00186"></a>00186 <span class="stringliteral">    such as CODE_SIGN_IDENTITY[sdk=iphoneos*].  This is a partial implementation</span>
<a name="l00187"></a>00187 <span class="stringliteral">    with some keys converted while the rest force a warning."""</span>
<a name="l00188"></a>00188     settings = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname]
<a name="l00189"></a>00189     conditional_keys = [key <span class="keywordflow">for</span> key <span class="keywordflow">in</span> settings <span class="keywordflow">if</span> key.endswith(<span class="stringliteral">']'</span>)]
<a name="l00190"></a>00190     <span class="keywordflow">for</span> key <span class="keywordflow">in</span> conditional_keys:
<a name="l00191"></a>00191       <span class="comment"># If you need more, speak up at http://crbug.com/122592</span>
<a name="l00192"></a>00192       <span class="keywordflow">if</span> key.endswith(<span class="stringliteral">"[sdk=iphoneos*]"</span>):
<a name="l00193"></a>00193         <span class="keywordflow">if</span> configname.endswith(<span class="stringliteral">"iphoneos"</span>):
<a name="l00194"></a>00194           new_key = key.split(<span class="stringliteral">"["</span>)[0]
<a name="l00195"></a>00195           settings[new_key] = settings[key]
<a name="l00196"></a>00196       <span class="keywordflow">else</span>:
<a name="l00197"></a>00197         <span class="keywordflow">print</span> <span class="stringliteral">'Warning: Conditional keys not implemented, ignoring:'</span>, \
<a name="l00198"></a>00198               <span class="stringliteral">' '</span>.join(conditional_keys)
<a name="l00199"></a>00199       del settings[key]
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">00201</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>(self):
<a name="l00202"></a>00202     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>
<a name="l00203"></a>00203     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>]
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">00205</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(self, test_key, cond_key, default):
<a name="l00206"></a>00206     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(test_key, default) == cond_key
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">00208</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(self, lst, test_key, format_str, default=None):
<a name="l00209"></a>00209     <span class="keywordflow">if</span> test_key <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>():
<a name="l00210"></a>00210       lst.append(format_str % str(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>()[test_key]))
<a name="l00211"></a>00211     <span class="keywordflow">elif</span> default:
<a name="l00212"></a>00212       lst.append(format_str % str(default))
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">00214</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(self, test_key):
<a name="l00215"></a>00215     <span class="keywordflow">if</span> test_key <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>():
<a name="l00216"></a>00216       <span class="keywordflow">print</span> <span class="stringliteral">'Warning: Ignoring not yet implemented key "%s".'</span> % test_key
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#ac8b049066fafe8b27f512b47b6556a9">00218</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#ac8b049066fafe8b27f512b47b6556a9">IsBinaryOutputFormat</a>(self, configname):
<a name="l00219"></a>00219     default = <span class="stringliteral">"binary"</span> <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a> <span class="keywordflow">else</span> <span class="stringliteral">"xml"</span>
<a name="l00220"></a>00220     format = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(<span class="stringliteral">'INFOPLIST_OUTPUT_FORMAT'</span>,
<a name="l00221"></a>00221                                                  default)
<a name="l00222"></a>00222     <span class="keywordflow">return</span> format == <span class="stringliteral">"binary"</span>
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">00224</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>(self):
<a name="l00225"></a>00225     <span class="keywordflow">return</span> int(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'mac_bundle'</span>, 0)) != 0
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#6427977a5f112f666f7e5dcd32167939">00227</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#6427977a5f112f666f7e5dcd32167939">_IsIosAppExtension</a>(self):
<a name="l00228"></a>00228     <span class="keywordflow">return</span> int(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'ios_app_extension'</span>, 0)) != 0
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#beabc5a1b95fbee5ef482c43bb098ef4">00230</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#beabc5a1b95fbee5ef482c43bb098ef4">_IsIosWatchKitExtension</a>(self):
<a name="l00231"></a>00231     <span class="keywordflow">return</span> int(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'ios_watchkit_extension'</span>, 0)) != 0
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#66be3ee72184ea2650df7b46bb2cbf51">00233</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#66be3ee72184ea2650df7b46bb2cbf51">_IsIosWatchApp</a>(self):
<a name="l00234"></a>00234     <span class="keywordflow">return</span> int(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'ios_watch_app'</span>, 0)) != 0
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#8371cd79ce424cab0711982cbaa999e3">00236</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#8371cd79ce424cab0711982cbaa999e3">GetFrameworkVersion</a>(self):
<a name="l00237"></a>00237     <span class="stringliteral">"""Returns the framework version of the current target. Only valid for</span>
<a name="l00238"></a>00238 <span class="stringliteral">    bundles."""</span>
<a name="l00239"></a>00239     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00240"></a>00240     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(<span class="stringliteral">'FRAMEWORK_VERSION'</span>, default=<span class="stringliteral">'A'</span>)
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c7d2d17b518b58804b8cd779211c279a">00242</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c7d2d17b518b58804b8cd779211c279a">GetWrapperExtension</a>(self):
<a name="l00243"></a>00243     <span class="stringliteral">"""Returns the bundle extension (.app, .framework, .plugin, etc).  Only</span>
<a name="l00244"></a>00244 <span class="stringliteral">    valid for bundles."""</span>
<a name="l00245"></a>00245     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00246"></a>00246     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (<span class="stringliteral">'loadable_module'</span>, <span class="stringliteral">'shared_library'</span>):
<a name="l00247"></a>00247       default_wrapper_extension = {
<a name="l00248"></a>00248         <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">'bundle'</span>,
<a name="l00249"></a>00249         <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'framework'</span>,
<a name="l00250"></a>00250       }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]]
<a name="l00251"></a>00251       wrapper_extension = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(
<a name="l00252"></a>00252           <span class="stringliteral">'WRAPPER_EXTENSION'</span>, default=default_wrapper_extension)
<a name="l00253"></a>00253       <span class="keywordflow">return</span> <span class="stringliteral">'.'</span> + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_extension'</span>, wrapper_extension)
<a name="l00254"></a>00254     <span class="keywordflow">elif</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'executable'</span>:
<a name="l00255"></a>00255       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#6427977a5f112f666f7e5dcd32167939">_IsIosAppExtension</a>() <span class="keywordflow">or</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#beabc5a1b95fbee5ef482c43bb098ef4">_IsIosWatchKitExtension</a>():
<a name="l00256"></a>00256         <span class="keywordflow">return</span> <span class="stringliteral">'.'</span> + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_extension'</span>, <span class="stringliteral">'appex'</span>)
<a name="l00257"></a>00257       <span class="keywordflow">else</span>:
<a name="l00258"></a>00258         <span class="keywordflow">return</span> <span class="stringliteral">'.'</span> + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_extension'</span>, <span class="stringliteral">'app'</span>)
<a name="l00259"></a>00259     <span class="keywordflow">else</span>:
<a name="l00260"></a>00260       <span class="keyword">assert</span> <span class="keyword">False</span>, <span class="stringliteral">"Don't know extension for '%s', target '%s'"</span> % (
<a name="l00261"></a>00261           self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>], self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9cb8301b20e050bf43b9d2baa1623ec0">00263</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9cb8301b20e050bf43b9d2baa1623ec0">GetProductName</a>(self):
<a name="l00264"></a>00264     <span class="stringliteral">"""Returns PRODUCT_NAME."""</span>
<a name="l00265"></a>00265     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_name'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a746b95275cce92c0994ab5a9eb5bb76">00267</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a746b95275cce92c0994ab5a9eb5bb76">GetFullProductName</a>(self):
<a name="l00268"></a>00268     <span class="stringliteral">"""Returns FULL_PRODUCT_NAME."""</span>
<a name="l00269"></a>00269     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00270"></a>00270       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>()
<a name="l00271"></a>00271     <span class="keywordflow">else</span>:
<a name="l00272"></a>00272       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0a6d27e18c24fd26d069e83306adc26e">_GetStandaloneBinaryPath</a>()
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">00274</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>(self):
<a name="l00275"></a>00275     <span class="stringliteral">"""Returns the directory name of the bundle represented by this target.</span>
<a name="l00276"></a>00276 <span class="stringliteral">    Only valid for bundles."""</span>
<a name="l00277"></a>00277     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00278"></a>00278     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9cb8301b20e050bf43b9d2baa1623ec0">GetProductName</a>() + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c7d2d17b518b58804b8cd779211c279a">GetWrapperExtension</a>()
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">00280</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>(self):
<a name="l00281"></a>00281     <span class="stringliteral">"""Returns the qualified path to the bundle's contents folder. E.g.</span>
<a name="l00282"></a>00282 <span class="stringliteral">    Chromium.app/Contents or Foo.bundle/Versions/A. Only valid for bundles."""</span>
<a name="l00283"></a>00283     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a>:
<a name="l00284"></a>00284       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>()
<a name="l00285"></a>00285     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00286"></a>00286     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'shared_library'</span>:
<a name="l00287"></a>00287       <span class="keywordflow">return</span> os.path.join(
<a name="l00288"></a>00288           self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>(), <span class="stringliteral">'Versions'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#8371cd79ce424cab0711982cbaa999e3">GetFrameworkVersion</a>())
<a name="l00289"></a>00289     <span class="keywordflow">else</span>:
<a name="l00290"></a>00290       <span class="comment"># loadable_modules have a 'Contents' folder like executables.</span>
<a name="l00291"></a>00291       <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>(), <span class="stringliteral">'Contents'</span>)
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#17dd455405ec9f4ffdaea4df6836a236">00293</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#17dd455405ec9f4ffdaea4df6836a236">GetBundleResourceFolder</a>(self):
<a name="l00294"></a>00294     <span class="stringliteral">"""Returns the qualified path to the bundle's resource folder. E.g.</span>
<a name="l00295"></a>00295 <span class="stringliteral">    Chromium.app/Contents/Resources. Only valid for bundles."""</span>
<a name="l00296"></a>00296     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00297"></a>00297     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a>:
<a name="l00298"></a>00298       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>()
<a name="l00299"></a>00299     <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>(), <span class="stringliteral">'Resources'</span>)
<a name="l00300"></a>00300 
<a name="l00301"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c57d33840e8817daddcae9e4c24be0bf">00301</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c57d33840e8817daddcae9e4c24be0bf">GetBundlePlistPath</a>(self):
<a name="l00302"></a>00302     <span class="stringliteral">"""Returns the qualified path to the bundle's plist file. E.g.</span>
<a name="l00303"></a>00303 <span class="stringliteral">    Chromium.app/Contents/Info.plist. Only valid for bundles."""</span>
<a name="l00304"></a>00304     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00305"></a>00305     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (<span class="stringliteral">'executable'</span>, <span class="stringliteral">'loadable_module'</span>):
<a name="l00306"></a>00306       <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>(), <span class="stringliteral">'Info.plist'</span>)
<a name="l00307"></a>00307     <span class="keywordflow">else</span>:
<a name="l00308"></a>00308       <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>(),
<a name="l00309"></a>00309                           <span class="stringliteral">'Resources'</span>, <span class="stringliteral">'Info.plist'</span>)
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82f34b767602e93c91bd2b3b0622954d">00311</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82f34b767602e93c91bd2b3b0622954d">GetProductType</a>(self):
<a name="l00312"></a>00312     <span class="stringliteral">"""Returns the PRODUCT_TYPE of this target."""</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#6427977a5f112f666f7e5dcd32167939">_IsIosAppExtension</a>():
<a name="l00314"></a>00314       <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>(), (<span class="stringliteral">'ios_app_extension flag requires mac_bundle '</span>
<a name="l00315"></a>00315           <span class="stringliteral">'(target %s)'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00316"></a>00316       <span class="keywordflow">return</span> <span class="stringliteral">'com.apple.product-type.app-extension'</span>
<a name="l00317"></a>00317     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#beabc5a1b95fbee5ef482c43bb098ef4">_IsIosWatchKitExtension</a>():
<a name="l00318"></a>00318       <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>(), (<span class="stringliteral">'ios_watchkit_extension flag requires '</span>
<a name="l00319"></a>00319           <span class="stringliteral">'mac_bundle (target %s)'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00320"></a>00320       <span class="keywordflow">return</span> <span class="stringliteral">'com.apple.product-type.watchkit-extension'</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#66be3ee72184ea2650df7b46bb2cbf51">_IsIosWatchApp</a>():
<a name="l00322"></a>00322       <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>(), (<span class="stringliteral">'ios_watch_app flag requires mac_bundle '</span>
<a name="l00323"></a>00323           <span class="stringliteral">'(target %s)'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00324"></a>00324       <span class="keywordflow">return</span> <span class="stringliteral">'com.apple.product-type.application.watchapp'</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00326"></a>00326       <span class="keywordflow">return</span> {
<a name="l00327"></a>00327         <span class="stringliteral">'executable'</span>: <span class="stringliteral">'com.apple.product-type.application'</span>,
<a name="l00328"></a>00328         <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">'com.apple.product-type.bundle'</span>,
<a name="l00329"></a>00329         <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'com.apple.product-type.framework'</span>,
<a name="l00330"></a>00330       }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]]
<a name="l00331"></a>00331     <span class="keywordflow">else</span>:
<a name="l00332"></a>00332       <span class="keywordflow">return</span> {
<a name="l00333"></a>00333         <span class="stringliteral">'executable'</span>: <span class="stringliteral">'com.apple.product-type.tool'</span>,
<a name="l00334"></a>00334         <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">'com.apple.product-type.library.dynamic'</span>,
<a name="l00335"></a>00335         <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'com.apple.product-type.library.dynamic'</span>,
<a name="l00336"></a>00336         <span class="stringliteral">'static_library'</span>: <span class="stringliteral">'com.apple.product-type.library.static'</span>,
<a name="l00337"></a>00337       }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]]
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#91d7e2d271f4916f448720d9c957648c">00339</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#91d7e2d271f4916f448720d9c957648c">GetMachOType</a>(self):
<a name="l00340"></a>00340     <span class="stringliteral">"""Returns the MACH_O_TYPE of this target."""</span>
<a name="l00341"></a>00341     <span class="comment"># Weird, but matches Xcode.</span>
<a name="l00342"></a>00342     <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>() <span class="keywordflow">and</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'executable'</span>:
<a name="l00343"></a>00343       <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l00344"></a>00344     <span class="keywordflow">return</span> {
<a name="l00345"></a>00345       <span class="stringliteral">'executable'</span>: <span class="stringliteral">'mh_execute'</span>,
<a name="l00346"></a>00346       <span class="stringliteral">'static_library'</span>: <span class="stringliteral">'staticlib'</span>,
<a name="l00347"></a>00347       <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'mh_dylib'</span>,
<a name="l00348"></a>00348       <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">'mh_bundle'</span>,
<a name="l00349"></a>00349     }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]]
<a name="l00350"></a>00350 
<a name="l00351"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#bc98757013a4eb3bfde8e65f116e80a7">00351</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#bc98757013a4eb3bfde8e65f116e80a7">_GetBundleBinaryPath</a>(self):
<a name="l00352"></a>00352     <span class="stringliteral">"""Returns the name of the bundle binary of by this target.</span>
<a name="l00353"></a>00353 <span class="stringliteral">    E.g. Chromium.app/Contents/MacOS/Chromium. Only valid for bundles."""</span>
<a name="l00354"></a>00354     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00355"></a>00355     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (<span class="stringliteral">'shared_library'</span>) <span class="keywordflow">or</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a>:
<a name="l00356"></a>00356       path = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>()
<a name="l00357"></a>00357     <span class="keywordflow">elif</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (<span class="stringliteral">'executable'</span>, <span class="stringliteral">'loadable_module'</span>):
<a name="l00358"></a>00358       path = os.path.join(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0e371466ad3068f2881aa2f116f55601">GetBundleContentsFolderPath</a>(), <span class="stringliteral">'MacOS'</span>)
<a name="l00359"></a>00359     <span class="keywordflow">return</span> os.path.join(path, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#63a8c9df0bbb2973666c3bcef8c9f9b8">GetExecutableName</a>())
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#86ac043ca74380e79e013bf31ba48bfe">00361</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#86ac043ca74380e79e013bf31ba48bfe">_GetStandaloneExecutableSuffix</a>(self):
<a name="l00362"></a>00362     <span class="keywordflow">if</span> <span class="stringliteral">'product_extension'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>:
<a name="l00363"></a>00363       <span class="keywordflow">return</span> <span class="stringliteral">'.'</span> + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'product_extension'</span>]
<a name="l00364"></a>00364     <span class="keywordflow">return</span> {
<a name="l00365"></a>00365       <span class="stringliteral">'executable'</span>: <span class="stringliteral">''</span>,
<a name="l00366"></a>00366       <span class="stringliteral">'static_library'</span>: <span class="stringliteral">'.a'</span>,
<a name="l00367"></a>00367       <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'.dylib'</span>,
<a name="l00368"></a>00368       <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">'.so'</span>,
<a name="l00369"></a>00369     }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]]
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e09af05b11091bc6c6971eadb8432748">00371</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e09af05b11091bc6c6971eadb8432748">_GetStandaloneExecutablePrefix</a>(self):
<a name="l00372"></a>00372     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_prefix'</span>, {
<a name="l00373"></a>00373       <span class="stringliteral">'executable'</span>: <span class="stringliteral">''</span>,
<a name="l00374"></a>00374       <span class="stringliteral">'static_library'</span>: <span class="stringliteral">'lib'</span>,
<a name="l00375"></a>00375       <span class="stringliteral">'shared_library'</span>: <span class="stringliteral">'lib'</span>,
<a name="l00376"></a>00376       <span class="comment"># Non-bundled loadable_modules are called foo.so for some reason</span>
<a name="l00377"></a>00377       <span class="comment"># (that is, .so and no prefix) with the xcode build -- match that.</span>
<a name="l00378"></a>00378       <span class="stringliteral">'loadable_module'</span>: <span class="stringliteral">''</span>,
<a name="l00379"></a>00379     }[self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>]])
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0a6d27e18c24fd26d069e83306adc26e">00381</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0a6d27e18c24fd26d069e83306adc26e">_GetStandaloneBinaryPath</a>(self):
<a name="l00382"></a>00382     <span class="stringliteral">"""Returns the name of the non-bundle binary represented by this target.</span>
<a name="l00383"></a>00383 <span class="stringliteral">    E.g. hello_world. Only valid for non-bundles."""</span>
<a name="l00384"></a>00384     <span class="keyword">assert</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>()
<a name="l00385"></a>00385     <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (
<a name="l00386"></a>00386         <span class="stringliteral">'executable'</span>, <span class="stringliteral">'shared_library'</span>, <span class="stringliteral">'static_library'</span>, <span class="stringliteral">'loadable_module'</span>), (
<a name="l00387"></a>00387         <span class="stringliteral">'Unexpected type %s'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>])
<a name="l00388"></a>00388     target = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>]
<a name="l00389"></a>00389     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'static_library'</span>:
<a name="l00390"></a>00390       <span class="keywordflow">if</span> target[:3] == <span class="stringliteral">'lib'</span>:
<a name="l00391"></a>00391         target = target[3:]
<a name="l00392"></a>00392     <span class="keywordflow">elif</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (<span class="stringliteral">'loadable_module'</span>, <span class="stringliteral">'shared_library'</span>):
<a name="l00393"></a>00393       <span class="keywordflow">if</span> target[:3] == <span class="stringliteral">'lib'</span>:
<a name="l00394"></a>00394         target = target[3:]
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     target_prefix = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e09af05b11091bc6c6971eadb8432748">_GetStandaloneExecutablePrefix</a>()
<a name="l00397"></a>00397     target = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_name'</span>, target)
<a name="l00398"></a>00398     target_ext = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#86ac043ca74380e79e013bf31ba48bfe">_GetStandaloneExecutableSuffix</a>()
<a name="l00399"></a>00399     <span class="keywordflow">return</span> target_prefix + target + target_ext
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#63a8c9df0bbb2973666c3bcef8c9f9b8">00401</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#63a8c9df0bbb2973666c3bcef8c9f9b8">GetExecutableName</a>(self):
<a name="l00402"></a>00402     <span class="stringliteral">"""Returns the executable name of the bundle represented by this target.</span>
<a name="l00403"></a>00403 <span class="stringliteral">    E.g. Chromium."""</span>
<a name="l00404"></a>00404     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00405"></a>00405       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>.get(<span class="stringliteral">'product_name'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00406"></a>00406     <span class="keywordflow">else</span>:
<a name="l00407"></a>00407       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0a6d27e18c24fd26d069e83306adc26e">_GetStandaloneBinaryPath</a>()
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1a3fc30568b3f03187830df17d9e901e">00409</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1a3fc30568b3f03187830df17d9e901e">GetExecutablePath</a>(self):
<a name="l00410"></a>00410     <span class="stringliteral">"""Returns the directory name of the bundle represented by this target. E.g.</span>
<a name="l00411"></a>00411 <span class="stringliteral">    Chromium.app/Contents/MacOS/Chromium."""</span>
<a name="l00412"></a>00412     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00413"></a>00413       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#bc98757013a4eb3bfde8e65f116e80a7">_GetBundleBinaryPath</a>()
<a name="l00414"></a>00414     <span class="keywordflow">else</span>:
<a name="l00415"></a>00415       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0a6d27e18c24fd26d069e83306adc26e">_GetStandaloneBinaryPath</a>()
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4b1bce4926648ba7c6f7ccce59565112">00417</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4b1bce4926648ba7c6f7ccce59565112">GetActiveArchs</a>(self, configname):
<a name="l00418"></a>00418     <span class="stringliteral">"""Returns the architectures this target should be built for."""</span>
<a name="l00419"></a>00419     config_settings = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname]
<a name="l00420"></a>00420     xcode_archs_default = GetXcodeArchsDefault()
<a name="l00421"></a>00421     <span class="keywordflow">return</span> xcode_archs_default.ActiveArchs(
<a name="l00422"></a>00422         config_settings.get(<span class="stringliteral">'ARCHS'</span>),
<a name="l00423"></a>00423         config_settings.get(<span class="stringliteral">'VALID_ARCHS'</span>),
<a name="l00424"></a>00424         config_settings.get(<span class="stringliteral">'SDKROOT'</span>))
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8aec28c2484fbacd1dd35478a2884f5">00426</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8aec28c2484fbacd1dd35478a2884f5">_GetSdkVersionInfoItem</a>(self, sdk, infoitem):
<a name="l00427"></a>00427     <span class="comment"># xcodebuild requires Xcode and can't run on Command Line Tools-only</span>
<a name="l00428"></a>00428     <span class="comment"># systems from 10.7 onward.</span>
<a name="l00429"></a>00429     <span class="comment"># Since the CLT has no SDK paths anyway, returning None is the</span>
<a name="l00430"></a>00430     <span class="comment"># most sensible route and should still do the right thing.</span>
<a name="l00431"></a>00431     <span class="keywordflow">try</span>:
<a name="l00432"></a>00432       <span class="keywordflow">return</span> GetStdout([<span class="stringliteral">'xcodebuild'</span>, <span class="stringliteral">'-version'</span>, <span class="stringliteral">'-sdk'</span>, sdk, infoitem])
<a name="l00433"></a>00433     <span class="keywordflow">except</span>:
<a name="l00434"></a>00434       <span class="keywordflow">pass</span>
<a name="l00435"></a>00435 
<a name="l00436"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#af2217af0f8066d69aabe87c823a5491">00436</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#af2217af0f8066d69aabe87c823a5491">_SdkRoot</a>(self, configname):
<a name="l00437"></a>00437     <span class="keywordflow">if</span> configname <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00438"></a>00438       configname = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>
<a name="l00439"></a>00439     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e011d2f386269e470429862836fd2c93">GetPerConfigSetting</a>(<span class="stringliteral">'SDKROOT'</span>, configname, default=<span class="stringliteral">''</span>)
<a name="l00440"></a>00440 
<a name="l00441"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">00441</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>(self, configname=None):
<a name="l00442"></a>00442     sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#af2217af0f8066d69aabe87c823a5491">_SdkRoot</a>(configname)
<a name="l00443"></a>00443     <span class="keywordflow">if</span> sdk_root.startswith(<span class="stringliteral">'/'</span>):
<a name="l00444"></a>00444       <span class="keywordflow">return</span> sdk_root
<a name="l00445"></a>00445     <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#7e72108afc42b978e94bd76754cc8e31">_XcodeSdkPath</a>(sdk_root)
<a name="l00446"></a>00446 
<a name="l00447"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#7e72108afc42b978e94bd76754cc8e31">00447</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#7e72108afc42b978e94bd76754cc8e31">_XcodeSdkPath</a>(self, sdk_root):
<a name="l00448"></a>00448     <span class="keywordflow">if</span> sdk_root <span class="keywordflow">not</span> <span class="keywordflow">in</span> XcodeSettings._sdk_path_cache:
<a name="l00449"></a>00449       sdk_path = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8aec28c2484fbacd1dd35478a2884f5">_GetSdkVersionInfoItem</a>(sdk_root, <span class="stringliteral">'Path'</span>)
<a name="l00450"></a>00450       XcodeSettings._sdk_path_cache[sdk_root] = sdk_path
<a name="l00451"></a>00451       <span class="keywordflow">if</span> sdk_root:
<a name="l00452"></a>00452         XcodeSettings._sdk_root_cache[sdk_path] = sdk_root
<a name="l00453"></a>00453     <span class="keywordflow">return</span> XcodeSettings._sdk_path_cache[sdk_root]
<a name="l00454"></a>00454 
<a name="l00455"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3ddb2854778cc533ade4e5b50f1a5c">00455</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3ddb2854778cc533ade4e5b50f1a5c">_AppendPlatformVersionMinFlags</a>(self, lst):
<a name="l00456"></a>00456     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(lst, <span class="stringliteral">'MACOSX_DEPLOYMENT_TARGET'</span>, <span class="stringliteral">'-mmacosx-version-min=%s'</span>)
<a name="l00457"></a>00457     <span class="keywordflow">if</span> <span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>():
<a name="l00458"></a>00458       <span class="comment"># TODO: Implement this better?</span>
<a name="l00459"></a>00459       sdk_path_basename = os.path.basename(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>())
<a name="l00460"></a>00460       <span class="keywordflow">if</span> sdk_path_basename.lower().startswith(<span class="stringliteral">'iphonesimulator'</span>):
<a name="l00461"></a>00461         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(lst, <span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span>,
<a name="l00462"></a>00462                       <span class="stringliteral">'-mios-simulator-version-min=%s'</span>)
<a name="l00463"></a>00463       <span class="keywordflow">else</span>:
<a name="l00464"></a>00464         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(lst, <span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span>,
<a name="l00465"></a>00465                       <span class="stringliteral">'-miphoneos-version-min=%s'</span>)
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#257e9d2d1402ee15d05d8b9fa6b00557">00467</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#257e9d2d1402ee15d05d8b9fa6b00557">GetCflags</a>(self, configname, arch=None):
<a name="l00468"></a>00468     <span class="stringliteral">"""Returns flags that need to be added to .c, .cc, .m, and .mm</span>
<a name="l00469"></a>00469 <span class="stringliteral">    compilations."""</span>
<a name="l00470"></a>00470     <span class="comment"># This functions (and the similar ones below) do not offer complete</span>
<a name="l00471"></a>00471     <span class="comment"># emulation of all xcode_settings keys. They're implemented on demand.</span>
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00474"></a>00474     cflags = []
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>()
<a name="l00477"></a>00477     <span class="keywordflow">if</span> <span class="stringliteral">'SDKROOT'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>() <span class="keywordflow">and</span> sdk_root:
<a name="l00478"></a>00478       cflags.append(<span class="stringliteral">'-isysroot %s'</span> % sdk_root)
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'CLANG_WARN_CONSTANT_CONVERSION'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00481"></a>00481       cflags.append(<span class="stringliteral">'-Wconstant-conversion'</span>)
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_CHAR_IS_UNSIGNED_CHAR'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00484"></a>00484       cflags.append(<span class="stringliteral">'-funsigned-char'</span>)
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_CW_ASM_SYNTAX'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00487"></a>00487       cflags.append(<span class="stringliteral">'-fasm-blocks'</span>)
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <span class="keywordflow">if</span> <span class="stringliteral">'GCC_DYNAMIC_NO_PIC'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>():
<a name="l00490"></a>00490       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>()[<span class="stringliteral">'GCC_DYNAMIC_NO_PIC'</span>] == <span class="stringliteral">'YES'</span>:
<a name="l00491"></a>00491         cflags.append(<span class="stringliteral">'-mdynamic-no-pic'</span>)
<a name="l00492"></a>00492     <span class="keywordflow">else</span>:
<a name="l00493"></a>00493       <span class="keywordflow">pass</span>
<a name="l00494"></a>00494       <span class="comment"># TODO: In this case, it depends on the target. xcode passes</span>
<a name="l00495"></a>00495       <span class="comment"># mdynamic-no-pic by default for executable and possibly static lib</span>
<a name="l00496"></a>00496       <span class="comment"># according to mento</span>
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_PASCAL_STRINGS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00499"></a>00499       cflags.append(<span class="stringliteral">'-mpascal-strings'</span>)
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(cflags, <span class="stringliteral">'GCC_OPTIMIZATION_LEVEL'</span>, <span class="stringliteral">'-O%s'</span>, default=<span class="stringliteral">'s'</span>)
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_GENERATE_DEBUGGING_SYMBOLS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00504"></a>00504       dbg_format = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'DEBUG_INFORMATION_FORMAT'</span>, <span class="stringliteral">'dwarf'</span>)
<a name="l00505"></a>00505       <span class="keywordflow">if</span> dbg_format == <span class="stringliteral">'dwarf'</span>:
<a name="l00506"></a>00506         cflags.append(<span class="stringliteral">'-gdwarf-2'</span>)
<a name="l00507"></a>00507       <span class="keywordflow">elif</span> dbg_format == <span class="stringliteral">'stabs'</span>:
<a name="l00508"></a>00508         <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">'stabs debug format is not supported yet.'</span>)
<a name="l00509"></a>00509       <span class="keywordflow">elif</span> dbg_format == <span class="stringliteral">'dwarf-with-dsym'</span>:
<a name="l00510"></a>00510         cflags.append(<span class="stringliteral">'-gdwarf-2'</span>)
<a name="l00511"></a>00511       <span class="keywordflow">else</span>:
<a name="l00512"></a>00512         <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">'Unknown debug format %s'</span> % dbg_format)
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'GCC_STRICT_ALIASING'</span>) == <span class="stringliteral">'YES'</span>:
<a name="l00515"></a>00515       cflags.append(<span class="stringliteral">'-fstrict-aliasing'</span>)
<a name="l00516"></a>00516     <span class="keywordflow">elif</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'GCC_STRICT_ALIASING'</span>) == <span class="stringliteral">'NO'</span>:
<a name="l00517"></a>00517       cflags.append(<span class="stringliteral">'-fno-strict-aliasing'</span>)
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_SYMBOLS_PRIVATE_EXTERN'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00520"></a>00520       cflags.append(<span class="stringliteral">'-fvisibility=hidden'</span>)
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_TREAT_WARNINGS_AS_ERRORS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00523"></a>00523       cflags.append(<span class="stringliteral">'-Werror'</span>)
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_WARN_ABOUT_MISSING_NEWLINE'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00526"></a>00526       cflags.append(<span class="stringliteral">'-Wnewline-eof'</span>)
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3ddb2854778cc533ade4e5b50f1a5c">_AppendPlatformVersionMinFlags</a>(cflags)
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="comment"># TODO:</span>
<a name="l00531"></a>00531     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'COPY_PHASE_STRIP'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00532"></a>00532       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'COPY_PHASE_STRIP'</span>)
<a name="l00533"></a>00533     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'GCC_DEBUGGING_SYMBOLS'</span>)
<a name="l00534"></a>00534     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'GCC_ENABLE_OBJC_EXCEPTIONS'</span>)
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     <span class="comment"># TODO: This is exported correctly, but assigning to it is not supported.</span>
<a name="l00537"></a>00537     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'MACH_O_TYPE'</span>)
<a name="l00538"></a>00538     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'PRODUCT_TYPE'</span>)
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="keywordflow">if</span> arch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00541"></a>00541       archs = [arch]
<a name="l00542"></a>00542     <span class="keywordflow">else</span>:
<a name="l00543"></a>00543       <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>
<a name="l00544"></a>00544       archs = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4b1bce4926648ba7c6f7ccce59565112">GetActiveArchs</a>(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>)
<a name="l00545"></a>00545     <span class="keywordflow">if</span> len(archs) != 1:
<a name="l00546"></a>00546       <span class="comment"># TODO: Supporting fat binaries will be annoying.</span>
<a name="l00547"></a>00547       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'ARCHS'</span>)
<a name="l00548"></a>00548       archs = [<span class="stringliteral">'i386'</span>]
<a name="l00549"></a>00549     cflags.append(<span class="stringliteral">'-arch '</span> + archs[0])
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">if</span> archs[0] <span class="keywordflow">in</span> (<span class="stringliteral">'i386'</span>, <span class="stringliteral">'x86_64'</span>):
<a name="l00552"></a>00552       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_SSE3_EXTENSIONS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00553"></a>00553         cflags.append(<span class="stringliteral">'-msse3'</span>)
<a name="l00554"></a>00554       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_SUPPLEMENTAL_SSE3_INSTRUCTIONS'</span>, <span class="stringliteral">'YES'</span>,
<a name="l00555"></a>00555                     default=<span class="stringliteral">'NO'</span>):
<a name="l00556"></a>00556         cflags.append(<span class="stringliteral">'-mssse3'</span>)  <span class="comment"># Note 3rd 's'.</span>
<a name="l00557"></a>00557       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_SSE41_EXTENSIONS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00558"></a>00558         cflags.append(<span class="stringliteral">'-msse4.1'</span>)
<a name="l00559"></a>00559       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_SSE42_EXTENSIONS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00560"></a>00560         cflags.append(<span class="stringliteral">'-msse4.2'</span>)
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     cflags += self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'WARNING_CFLAGS'</span>, [])
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">if</span> sdk_root:
<a name="l00565"></a>00565       framework_root = sdk_root
<a name="l00566"></a>00566     <span class="keywordflow">else</span>:
<a name="l00567"></a>00567       framework_root = <span class="stringliteral">''</span>
<a name="l00568"></a>00568     config = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'configurations'</span>][self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>]
<a name="l00569"></a>00569     framework_dirs = config.get(<span class="stringliteral">'mac_framework_dirs'</span>, [])
<a name="l00570"></a>00570     <span class="keywordflow">for</span> directory <span class="keywordflow">in</span> framework_dirs:
<a name="l00571"></a>00571       cflags.append(<span class="stringliteral">'-F'</span> + directory.replace(<span class="stringliteral">'$(SDKROOT)'</span>, framework_root))
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00574"></a>00574     <span class="keywordflow">return</span> cflags
<a name="l00575"></a>00575 
<a name="l00576"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#999affa1ba904004eccc5f5cd3f03f70">00576</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#999affa1ba904004eccc5f5cd3f03f70">GetCflagsC</a>(self, configname):
<a name="l00577"></a>00577     <span class="stringliteral">"""Returns flags that need to be added to .c, and .m compilations."""</span>
<a name="l00578"></a>00578     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00579"></a>00579     cflags_c = []
<a name="l00580"></a>00580     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'GCC_C_LANGUAGE_STANDARD'</span>, <span class="stringliteral">''</span>) == <span class="stringliteral">'ansi'</span>:
<a name="l00581"></a>00581       cflags_c.append(<span class="stringliteral">'-ansi'</span>)
<a name="l00582"></a>00582     <span class="keywordflow">else</span>:
<a name="l00583"></a>00583       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(cflags_c, <span class="stringliteral">'GCC_C_LANGUAGE_STANDARD'</span>, <span class="stringliteral">'-std=%s'</span>)
<a name="l00584"></a>00584     cflags_c += self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'OTHER_CFLAGS'</span>, [])
<a name="l00585"></a>00585     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00586"></a>00586     <span class="keywordflow">return</span> cflags_c
<a name="l00587"></a>00587 
<a name="l00588"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1b62ad5ac3ff8efabe43ea0342fc802e">00588</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1b62ad5ac3ff8efabe43ea0342fc802e">GetCflagsCC</a>(self, configname):
<a name="l00589"></a>00589     <span class="stringliteral">"""Returns flags that need to be added to .cc, and .mm compilations."""</span>
<a name="l00590"></a>00590     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00591"></a>00591     cflags_cc = []
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     clang_cxx_language_standard = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(
<a name="l00594"></a>00594         <span class="stringliteral">'CLANG_CXX_LANGUAGE_STANDARD'</span>)
<a name="l00595"></a>00595     <span class="comment"># Note: Don't make c++0x to c++11 so that c++0x can be used with older</span>
<a name="l00596"></a>00596     <span class="comment"># clangs that don't understand c++11 yet (like Xcode 4.2's).</span>
<a name="l00597"></a>00597     <span class="keywordflow">if</span> clang_cxx_language_standard:
<a name="l00598"></a>00598       cflags_cc.append(<span class="stringliteral">'-std=%s'</span> % clang_cxx_language_standard)
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(cflags_cc, <span class="stringliteral">'CLANG_CXX_LIBRARY'</span>, <span class="stringliteral">'-stdlib=%s'</span>)
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_CPP_RTTI'</span>, <span class="stringliteral">'NO'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00603"></a>00603       cflags_cc.append(<span class="stringliteral">'-fno-rtti'</span>)
<a name="l00604"></a>00604     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_ENABLE_CPP_EXCEPTIONS'</span>, <span class="stringliteral">'NO'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00605"></a>00605       cflags_cc.append(<span class="stringliteral">'-fno-exceptions'</span>)
<a name="l00606"></a>00606     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_INLINES_ARE_PRIVATE_EXTERN'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00607"></a>00607       cflags_cc.append(<span class="stringliteral">'-fvisibility-inlines-hidden'</span>)
<a name="l00608"></a>00608     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_THREADSAFE_STATICS'</span>, <span class="stringliteral">'NO'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00609"></a>00609       cflags_cc.append(<span class="stringliteral">'-fno-threadsafe-statics'</span>)
<a name="l00610"></a>00610     <span class="comment"># Note: This flag is a no-op for clang, it only has an effect for gcc.</span>
<a name="l00611"></a>00611     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_WARN_ABOUT_INVALID_OFFSETOF_MACRO'</span>, <span class="stringliteral">'NO'</span>, default=<span class="stringliteral">'YES'</span>):
<a name="l00612"></a>00612       cflags_cc.append(<span class="stringliteral">'-Wno-invalid-offsetof'</span>)
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     other_ccflags = []
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="keywordflow">for</span> flag <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'OTHER_CPLUSPLUSFLAGS'</span>, [<span class="stringliteral">'$(inherited)'</span>]):
<a name="l00617"></a>00617       <span class="comment"># TODO: More general variable expansion. Missing in many other places too.</span>
<a name="l00618"></a>00618       <span class="keywordflow">if</span> flag <span class="keywordflow">in</span> (<span class="stringliteral">'$inherited'</span>, <span class="stringliteral">'$(inherited)'</span>, <span class="stringliteral">'${inherited}'</span>):
<a name="l00619"></a>00619         flag = <span class="stringliteral">'$OTHER_CFLAGS'</span>
<a name="l00620"></a>00620       <span class="keywordflow">if</span> flag <span class="keywordflow">in</span> (<span class="stringliteral">'$OTHER_CFLAGS'</span>, <span class="stringliteral">'$(OTHER_CFLAGS)'</span>, <span class="stringliteral">'${OTHER_CFLAGS}'</span>):
<a name="l00621"></a>00621         other_ccflags += self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'OTHER_CFLAGS'</span>, [])
<a name="l00622"></a>00622       <span class="keywordflow">else</span>:
<a name="l00623"></a>00623         other_ccflags.append(flag)
<a name="l00624"></a>00624     cflags_cc += other_ccflags
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00627"></a>00627     <span class="keywordflow">return</span> cflags_cc
<a name="l00628"></a>00628 
<a name="l00629"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#67e909515983b2127adae928c4c8bc0f">00629</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#67e909515983b2127adae928c4c8bc0f">_AddObjectiveCGarbageCollectionFlags</a>(self, flags):
<a name="l00630"></a>00630     gc_policy = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'GCC_ENABLE_OBJC_GC'</span>, <span class="stringliteral">'unsupported'</span>)
<a name="l00631"></a>00631     <span class="keywordflow">if</span> gc_policy == <span class="stringliteral">'supported'</span>:
<a name="l00632"></a>00632       flags.append(<span class="stringliteral">'-fobjc-gc'</span>)
<a name="l00633"></a>00633     <span class="keywordflow">elif</span> gc_policy == <span class="stringliteral">'required'</span>:
<a name="l00634"></a>00634       flags.append(<span class="stringliteral">'-fobjc-gc-only'</span>)
<a name="l00635"></a>00635 
<a name="l00636"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#b584c8c9c837214dd10dd58eef00fcd4">00636</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#b584c8c9c837214dd10dd58eef00fcd4">_AddObjectiveCARCFlags</a>(self, flags):
<a name="l00637"></a>00637     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'CLANG_ENABLE_OBJC_ARC'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00638"></a>00638       flags.append(<span class="stringliteral">'-fobjc-arc'</span>)
<a name="l00639"></a>00639 
<a name="l00640"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a10f3545e02977996facf877888d96a2">00640</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a10f3545e02977996facf877888d96a2">_AddObjectiveCMissingPropertySynthesisFlags</a>(self, flags):
<a name="l00641"></a>00641     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'CLANG_WARN_OBJC_MISSING_PROPERTY_SYNTHESIS'</span>,
<a name="l00642"></a>00642                   <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00643"></a>00643       flags.append(<span class="stringliteral">'-Wobjc-missing-property-synthesis'</span>)
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9dc72cedb77ed93426d0a95cf120ab22">00645</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9dc72cedb77ed93426d0a95cf120ab22">GetCflagsObjC</a>(self, configname):
<a name="l00646"></a>00646     <span class="stringliteral">"""Returns flags that need to be added to .m compilations."""</span>
<a name="l00647"></a>00647     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00648"></a>00648     cflags_objc = []
<a name="l00649"></a>00649     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#67e909515983b2127adae928c4c8bc0f">_AddObjectiveCGarbageCollectionFlags</a>(cflags_objc)
<a name="l00650"></a>00650     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#b584c8c9c837214dd10dd58eef00fcd4">_AddObjectiveCARCFlags</a>(cflags_objc)
<a name="l00651"></a>00651     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a10f3545e02977996facf877888d96a2">_AddObjectiveCMissingPropertySynthesisFlags</a>(cflags_objc)
<a name="l00652"></a>00652     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00653"></a>00653     <span class="keywordflow">return</span> cflags_objc
<a name="l00654"></a>00654 
<a name="l00655"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a7daaea09a8c8ed9eda2a185dcf91989">00655</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a7daaea09a8c8ed9eda2a185dcf91989">GetCflagsObjCC</a>(self, configname):
<a name="l00656"></a>00656     <span class="stringliteral">"""Returns flags that need to be added to .mm compilations."""</span>
<a name="l00657"></a>00657     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00658"></a>00658     cflags_objcc = []
<a name="l00659"></a>00659     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#67e909515983b2127adae928c4c8bc0f">_AddObjectiveCGarbageCollectionFlags</a>(cflags_objcc)
<a name="l00660"></a>00660     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#b584c8c9c837214dd10dd58eef00fcd4">_AddObjectiveCARCFlags</a>(cflags_objcc)
<a name="l00661"></a>00661     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a10f3545e02977996facf877888d96a2">_AddObjectiveCMissingPropertySynthesisFlags</a>(cflags_objcc)
<a name="l00662"></a>00662     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_OBJC_CALL_CXX_CDTORS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00663"></a>00663       cflags_objcc.append(<span class="stringliteral">'-fobjc-call-cxx-cdtors'</span>)
<a name="l00664"></a>00664     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00665"></a>00665     <span class="keywordflow">return</span> cflags_objcc
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8aecbbface9d6b1c56f2439981206c4">00667</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8aecbbface9d6b1c56f2439981206c4">GetInstallNameBase</a>(self):
<a name="l00668"></a>00668     <span class="stringliteral">"""Return DYLIB_INSTALL_NAME_BASE for this target."""</span>
<a name="l00669"></a>00669     <span class="comment"># Xcode sets this for shared_libraries, and for nonbundled loadable_modules.</span>
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'shared_library'</span> <span class="keywordflow">and</span>
<a name="l00671"></a>00671         (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'loadable_module'</span> <span class="keywordflow">or</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>())):
<a name="l00672"></a>00672       <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00673"></a>00673     install_base = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(
<a name="l00674"></a>00674         <span class="stringliteral">'DYLIB_INSTALL_NAME_BASE'</span>,
<a name="l00675"></a>00675         default=<span class="stringliteral">'/Library/Frameworks'</span> <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>() <span class="keywordflow">else</span> <span class="stringliteral">'/usr/local/lib'</span>)
<a name="l00676"></a>00676     <span class="keywordflow">return</span> install_base
<a name="l00677"></a>00677 
<a name="l00678"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#dc3f6c691e2a8f86fa5b4b7619092ebc">00678</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#dc3f6c691e2a8f86fa5b4b7619092ebc">_StandardizePath</a>(self, path):
<a name="l00679"></a>00679     <span class="stringliteral">"""Do :standardizepath processing for path."""</span>
<a name="l00680"></a>00680     <span class="comment"># I'm not quite sure what :standardizepath does. Just call normpath(),</span>
<a name="l00681"></a>00681     <span class="comment"># but don't let @executable_path/../foo collapse to foo.</span>
<a name="l00682"></a>00682     <span class="keywordflow">if</span> <span class="stringliteral">'/'</span> <span class="keywordflow">in</span> path:
<a name="l00683"></a>00683       prefix, rest = <span class="stringliteral">''</span>, path
<a name="l00684"></a>00684       <span class="keywordflow">if</span> path.startswith(<span class="stringliteral">'@'</span>):
<a name="l00685"></a>00685         prefix, rest = path.split(<span class="stringliteral">'/'</span>, 1)
<a name="l00686"></a>00686       rest = os.path.normpath(rest)  <span class="comment"># :standardizepath</span>
<a name="l00687"></a>00687       path = os.path.join(prefix, rest)
<a name="l00688"></a>00688     <span class="keywordflow">return</span> path
<a name="l00689"></a>00689 
<a name="l00690"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#620987528f01c66c1f1c3d3c2ba4372b">00690</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#620987528f01c66c1f1c3d3c2ba4372b">GetInstallName</a>(self):
<a name="l00691"></a>00691     <span class="stringliteral">"""Return LD_DYLIB_INSTALL_NAME for this target."""</span>
<a name="l00692"></a>00692     <span class="comment"># Xcode sets this for shared_libraries, and for nonbundled loadable_modules.</span>
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'shared_library'</span> <span class="keywordflow">and</span>
<a name="l00694"></a>00694         (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'loadable_module'</span> <span class="keywordflow">or</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>())):
<a name="l00695"></a>00695       <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     default_install_name = \
<a name="l00698"></a>00698         <span class="stringliteral">'$(DYLIB_INSTALL_NAME_BASE:standardizepath)/$(EXECUTABLE_PATH)'</span>
<a name="l00699"></a>00699     install_name = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(
<a name="l00700"></a>00700         <span class="stringliteral">'LD_DYLIB_INSTALL_NAME'</span>, default=default_install_name)
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment"># Hardcode support for the variables used in chromium for now, to</span>
<a name="l00703"></a>00703     <span class="comment"># unblock people using the make build.</span>
<a name="l00704"></a>00704     <span class="keywordflow">if</span> <span class="stringliteral">'$'</span> <span class="keywordflow">in</span> install_name:
<a name="l00705"></a>00705       <span class="keyword">assert</span> install_name <span class="keywordflow">in</span> (<span class="stringliteral">'$(DYLIB_INSTALL_NAME_BASE:standardizepath)/'</span>
<a name="l00706"></a>00706           <span class="stringliteral">'$(WRAPPER_NAME)/$(PRODUCT_NAME)'</span>, default_install_name), (
<a name="l00707"></a>00707           <span class="stringliteral">'Variables in LD_DYLIB_INSTALL_NAME are not generally supported '</span>
<a name="l00708"></a>00708           <span class="stringliteral">'yet in target \'%s\' (got \'%s\')'</span> %
<a name="l00709"></a>00709               (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>], install_name))
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       install_name = install_name.replace(
<a name="l00712"></a>00712           <span class="stringliteral">'$(DYLIB_INSTALL_NAME_BASE:standardizepath)'</span>,
<a name="l00713"></a>00713           self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#dc3f6c691e2a8f86fa5b4b7619092ebc">_StandardizePath</a>(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8aecbbface9d6b1c56f2439981206c4">GetInstallNameBase</a>()))
<a name="l00714"></a>00714       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00715"></a>00715         <span class="comment"># These are only valid for bundles, hence the |if|.</span>
<a name="l00716"></a>00716         install_name = install_name.replace(
<a name="l00717"></a>00717             <span class="stringliteral">'$(WRAPPER_NAME)'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#0df118b42aa3367e92bbb226e9a6f0dd">GetWrapperName</a>())
<a name="l00718"></a>00718         install_name = install_name.replace(
<a name="l00719"></a>00719             <span class="stringliteral">'$(PRODUCT_NAME)'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9cb8301b20e050bf43b9d2baa1623ec0">GetProductName</a>())
<a name="l00720"></a>00720       <span class="keywordflow">else</span>:
<a name="l00721"></a>00721         <span class="keyword">assert</span> <span class="stringliteral">'$(WRAPPER_NAME)'</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> install_name
<a name="l00722"></a>00722         <span class="keyword">assert</span> <span class="stringliteral">'$(PRODUCT_NAME)'</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> install_name
<a name="l00723"></a>00723 
<a name="l00724"></a>00724       install_name = install_name.replace(
<a name="l00725"></a>00725           <span class="stringliteral">'$(EXECUTABLE_PATH)'</span>, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1a3fc30568b3f03187830df17d9e901e">GetExecutablePath</a>())
<a name="l00726"></a>00726     <span class="keywordflow">return</span> install_name
<a name="l00727"></a>00727 
<a name="l00728"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8685aed164557e2c351d77ad6b3b436">00728</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8685aed164557e2c351d77ad6b3b436">_MapLinkerFlagFilename</a>(self, ldflag, gyp_to_build_path):
<a name="l00729"></a>00729     <span class="stringliteral">"""Checks if ldflag contains a filename and if so remaps it from</span>
<a name="l00730"></a>00730 <span class="stringliteral">    gyp-directory-relative to build-directory-relative."""</span>
<a name="l00731"></a>00731     <span class="comment"># This list is expanded on demand.</span>
<a name="l00732"></a>00732     <span class="comment"># They get matched as:</span>
<a name="l00733"></a>00733     <span class="comment">#   -exported_symbols_list file</span>
<a name="l00734"></a>00734     <span class="comment">#   -Wl,exported_symbols_list file</span>
<a name="l00735"></a>00735     <span class="comment">#   -Wl,exported_symbols_list,file</span>
<a name="l00736"></a>00736     LINKER_FILE = <span class="stringliteral">r'(\S+)'</span>
<a name="l00737"></a>00737     WORD = <span class="stringliteral">r'\S+'</span>
<a name="l00738"></a>00738     linker_flags = [
<a name="l00739"></a>00739       [<span class="stringliteral">'-exported_symbols_list'</span>, LINKER_FILE],    <span class="comment"># Needed for NaCl.</span>
<a name="l00740"></a>00740       [<span class="stringliteral">'-unexported_symbols_list'</span>, LINKER_FILE],
<a name="l00741"></a>00741       [<span class="stringliteral">'-reexported_symbols_list'</span>, LINKER_FILE],
<a name="l00742"></a>00742       [<span class="stringliteral">'-sectcreate'</span>, WORD, WORD, LINKER_FILE],   <span class="comment"># Needed for remoting.</span>
<a name="l00743"></a>00743     ]
<a name="l00744"></a>00744     <span class="keywordflow">for</span> flag_pattern <span class="keywordflow">in</span> linker_flags:
<a name="l00745"></a>00745       regex = re.compile(<span class="stringliteral">'(?:-Wl,)?'</span> + <span class="stringliteral">'[ ,]'</span>.join(flag_pattern))
<a name="l00746"></a>00746       m = regex.match(ldflag)
<a name="l00747"></a>00747       <span class="keywordflow">if</span> m:
<a name="l00748"></a>00748         ldflag = ldflag[:m.start(1)] + gyp_to_build_path(m.group(1)) + \
<a name="l00749"></a>00749                  ldflag[m.end(1):]
<a name="l00750"></a>00750     <span class="comment"># Required for ffmpeg (no idea why they don't use LIBRARY_SEARCH_PATHS,</span>
<a name="l00751"></a>00751     <span class="comment"># TODO(thakis): Update ffmpeg.gyp):</span>
<a name="l00752"></a>00752     <span class="keywordflow">if</span> ldflag.startswith(<span class="stringliteral">'-L'</span>):
<a name="l00753"></a>00753       ldflag = <span class="stringliteral">'-L'</span> + gyp_to_build_path(ldflag[len(<span class="stringliteral">'-L'</span>):])
<a name="l00754"></a>00754     <span class="keywordflow">return</span> ldflag
<a name="l00755"></a>00755 
<a name="l00756"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9286bffacd39415a45539cae26e7c75d">00756</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9286bffacd39415a45539cae26e7c75d">GetLdflags</a>(self, configname, product_dir, gyp_to_build_path, arch=None):
<a name="l00757"></a>00757     <span class="stringliteral">"""Returns flags that need to be passed to the linker.</span>
<a name="l00758"></a>00758 <span class="stringliteral"></span>
<a name="l00759"></a>00759 <span class="stringliteral">    Args:</span>
<a name="l00760"></a>00760 <span class="stringliteral">        configname: The name of the configuration to get ld flags for.</span>
<a name="l00761"></a>00761 <span class="stringliteral">        product_dir: The directory where products such static and dynamic</span>
<a name="l00762"></a>00762 <span class="stringliteral">            libraries are placed. This is added to the library search path.</span>
<a name="l00763"></a>00763 <span class="stringliteral">        gyp_to_build_path: A function that converts paths relative to the</span>
<a name="l00764"></a>00764 <span class="stringliteral">            current gyp file to paths relative to the build direcotry.</span>
<a name="l00765"></a>00765 <span class="stringliteral">    """</span>
<a name="l00766"></a>00766     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00767"></a>00767     ldflags = []
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="comment"># The xcode build is relative to a gyp file's directory, and OTHER_LDFLAGS</span>
<a name="l00770"></a>00770     <span class="comment"># can contain entries that depend on this. Explicitly absolutify these.</span>
<a name="l00771"></a>00771     <span class="keywordflow">for</span> ldflag <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'OTHER_LDFLAGS'</span>, []):
<a name="l00772"></a>00772       ldflags.append(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d8685aed164557e2c351d77ad6b3b436">_MapLinkerFlagFilename</a>(ldflag, gyp_to_build_path))
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'DEAD_CODE_STRIPPING'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00775"></a>00775       ldflags.append(<span class="stringliteral">'-Wl,-dead_strip'</span>)
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'PREBINDING'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>):
<a name="l00778"></a>00778       ldflags.append(<span class="stringliteral">'-Wl,-prebind'</span>)
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(
<a name="l00781"></a>00781         ldflags, <span class="stringliteral">'DYLIB_COMPATIBILITY_VERSION'</span>, <span class="stringliteral">'-compatibility_version %s'</span>)
<a name="l00782"></a>00782     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(
<a name="l00783"></a>00783         ldflags, <span class="stringliteral">'DYLIB_CURRENT_VERSION'</span>, <span class="stringliteral">'-current_version %s'</span>)
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3ddb2854778cc533ade4e5b50f1a5c">_AppendPlatformVersionMinFlags</a>(ldflags)
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keywordflow">if</span> <span class="stringliteral">'SDKROOT'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>() <span class="keywordflow">and</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>():
<a name="l00788"></a>00788       ldflags.append(<span class="stringliteral">'-isysroot '</span> + self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>())
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <span class="keywordflow">for</span> library_path <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'LIBRARY_SEARCH_PATHS'</span>, []):
<a name="l00791"></a>00791       ldflags.append(<span class="stringliteral">'-L'</span> + gyp_to_build_path(library_path))
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     <span class="keywordflow">if</span> <span class="stringliteral">'ORDER_FILE'</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>():
<a name="l00794"></a>00794       ldflags.append(<span class="stringliteral">'-Wl,-order_file '</span> +
<a name="l00795"></a>00795                      <span class="stringliteral">'-Wl,'</span> + gyp_to_build_path(
<a name="l00796"></a>00796                                   self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>()[<span class="stringliteral">'ORDER_FILE'</span>]))
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <span class="keywordflow">if</span> arch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00799"></a>00799       archs = [arch]
<a name="l00800"></a>00800     <span class="keywordflow">else</span>:
<a name="l00801"></a>00801       <span class="keyword">assert</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>
<a name="l00802"></a>00802       archs = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4b1bce4926648ba7c6f7ccce59565112">GetActiveArchs</a>(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>)
<a name="l00803"></a>00803     <span class="keywordflow">if</span> len(archs) != 1:
<a name="l00804"></a>00804       <span class="comment"># TODO: Supporting fat binaries will be annoying.</span>
<a name="l00805"></a>00805       self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#443caff129430bf9406c2cc753de3d4a">_WarnUnimplemented</a>(<span class="stringliteral">'ARCHS'</span>)
<a name="l00806"></a>00806       archs = [<span class="stringliteral">'i386'</span>]
<a name="l00807"></a>00807     ldflags.append(<span class="stringliteral">'-arch '</span> + archs[0])
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="comment"># Xcode adds the product directory by default.</span>
<a name="l00810"></a>00810     ldflags.append(<span class="stringliteral">'-L'</span> + product_dir)
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     install_name = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#620987528f01c66c1f1c3d3c2ba4372b">GetInstallName</a>()
<a name="l00813"></a>00813     <span class="keywordflow">if</span> install_name <span class="keywordflow">and</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'loadable_module'</span>:
<a name="l00814"></a>00814       ldflags.append(<span class="stringliteral">'-install_name '</span> + install_name.replace(<span class="stringliteral">' '</span>, <span class="stringliteral">r'\ '</span>))
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     <span class="keywordflow">for</span> rpath <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'LD_RUNPATH_SEARCH_PATHS'</span>, []):
<a name="l00817"></a>00817       ldflags.append(<span class="stringliteral">'-Wl,-rpath,'</span> + rpath)
<a name="l00818"></a>00818 
<a name="l00819"></a>00819     sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>()
<a name="l00820"></a>00820     <span class="keywordflow">if</span> <span class="keywordflow">not</span> sdk_root:
<a name="l00821"></a>00821       sdk_root = <span class="stringliteral">''</span>
<a name="l00822"></a>00822     config = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'configurations'</span>][self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a>]
<a name="l00823"></a>00823     framework_dirs = config.get(<span class="stringliteral">'mac_framework_dirs'</span>, [])
<a name="l00824"></a>00824     <span class="keywordflow">for</span> directory <span class="keywordflow">in</span> framework_dirs:
<a name="l00825"></a>00825       ldflags.append(<span class="stringliteral">'-F'</span> + directory.replace(<span class="stringliteral">'$(SDKROOT)'</span>, sdk_root))
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     is_extension = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#6427977a5f112f666f7e5dcd32167939">_IsIosAppExtension</a>() <span class="keywordflow">or</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#beabc5a1b95fbee5ef482c43bb098ef4">_IsIosWatchKitExtension</a>()
<a name="l00828"></a>00828     <span class="keywordflow">if</span> sdk_root <span class="keywordflow">and</span> is_extension:
<a name="l00829"></a>00829       <span class="comment"># Adds the link flags for extensions. These flags are common for all</span>
<a name="l00830"></a>00830       <span class="comment"># extensions and provide loader and main function.</span>
<a name="l00831"></a>00831       <span class="comment"># These flags reflect the compilation options used by xcode to compile</span>
<a name="l00832"></a>00832       <span class="comment"># extensions.</span>
<a name="l00833"></a>00833       ldflags.append(<span class="stringliteral">'-lpkstart'</span>)
<a name="l00834"></a>00834       ldflags.append(sdk_root +
<a name="l00835"></a>00835           <span class="stringliteral">'/System/Library/PrivateFrameworks/PlugInKit.framework/PlugInKit'</span>)
<a name="l00836"></a>00836       ldflags.append(<span class="stringliteral">'-fapplication-extension'</span>)
<a name="l00837"></a>00837       ldflags.append(<span class="stringliteral">'-Xlinker -rpath '</span>
<a name="l00838"></a>00838           <span class="stringliteral">'-Xlinker @executable_path/../../Frameworks'</span>)
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#12f30c167598a5abeaf0eabe952e137c">_Appendf</a>(ldflags, <span class="stringliteral">'CLANG_CXX_LIBRARY'</span>, <span class="stringliteral">'-stdlib=%s'</span>)
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00843"></a>00843     <span class="keywordflow">return</span> ldflags
<a name="l00844"></a>00844 
<a name="l00845"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#2159be503f3c20c39e0a0315f77ea416">00845</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#2159be503f3c20c39e0a0315f77ea416">GetLibtoolflags</a>(self, configname):
<a name="l00846"></a>00846     <span class="stringliteral">"""Returns flags that need to be passed to the static linker.</span>
<a name="l00847"></a>00847 <span class="stringliteral"></span>
<a name="l00848"></a>00848 <span class="stringliteral">    Args:</span>
<a name="l00849"></a>00849 <span class="stringliteral">        configname: The name of the configuration to get ld flags for.</span>
<a name="l00850"></a>00850 <span class="stringliteral">    """</span>
<a name="l00851"></a>00851     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00852"></a>00852     libtoolflags = []
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     <span class="keywordflow">for</span> libtoolflag <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'OTHER_LDFLAGS'</span>, []):
<a name="l00855"></a>00855       libtoolflags.append(libtoolflag)
<a name="l00856"></a>00856     <span class="comment"># TODO(thakis): ARCHS?</span>
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00859"></a>00859     <span class="keywordflow">return</span> libtoolflags
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#76cdc84d7746b62b16f84188ce237f6e">00861</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#76cdc84d7746b62b16f84188ce237f6e">GetPerTargetSettings</a>(self):
<a name="l00862"></a>00862     <span class="stringliteral">"""Gets a list of all the per-target settings. This will only fetch keys</span>
<a name="l00863"></a>00863 <span class="stringliteral">    whose values are the same across all configurations."""</span>
<a name="l00864"></a>00864     first_pass = <span class="keyword">True</span>
<a name="l00865"></a>00865     result = {}
<a name="l00866"></a>00866     <span class="keywordflow">for</span> configname <span class="keywordflow">in</span> sorted(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>.keys()):
<a name="l00867"></a>00867       <span class="keywordflow">if</span> first_pass:
<a name="l00868"></a>00868         result = dict(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname])
<a name="l00869"></a>00869         first_pass = <span class="keyword">False</span>
<a name="l00870"></a>00870       <span class="keywordflow">else</span>:
<a name="l00871"></a>00871         <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].iteritems():
<a name="l00872"></a>00872           <span class="keywordflow">if</span> key <span class="keywordflow">not</span> <span class="keywordflow">in</span> result:
<a name="l00873"></a>00873             <span class="keywordflow">continue</span>
<a name="l00874"></a>00874           <span class="keywordflow">elif</span> result[key] != value:
<a name="l00875"></a>00875             del result[key]
<a name="l00876"></a>00876     <span class="keywordflow">return</span> result
<a name="l00877"></a>00877 
<a name="l00878"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e011d2f386269e470429862836fd2c93">00878</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e011d2f386269e470429862836fd2c93">GetPerConfigSetting</a>(self, setting, configname, default=None):
<a name="l00879"></a>00879     <span class="keywordflow">if</span> configname <span class="keywordflow">in</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>:
<a name="l00880"></a>00880       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(setting, default)
<a name="l00881"></a>00881     <span class="keywordflow">else</span>:
<a name="l00882"></a>00882       <span class="keywordflow">return</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(setting, default)
<a name="l00883"></a>00883 
<a name="l00884"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">00884</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#27dfa47ad50f06aa2e5629cb81a7b4cc">GetPerTargetSetting</a>(self, setting, default=None):
<a name="l00885"></a>00885     <span class="stringliteral">"""Tries to get xcode_settings.setting from spec. Assumes that the setting</span>
<a name="l00886"></a>00886 <span class="stringliteral">       has the same value in all configurations and throws otherwise."""</span>
<a name="l00887"></a>00887     is_first_pass = <span class="keyword">True</span>
<a name="l00888"></a>00888     result = <span class="keywordtype">None</span>
<a name="l00889"></a>00889     <span class="keywordflow">for</span> configname <span class="keywordflow">in</span> sorted(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>.keys()):
<a name="l00890"></a>00890       <span class="keywordflow">if</span> is_first_pass:
<a name="l00891"></a>00891         result = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(setting, <span class="keywordtype">None</span>)
<a name="l00892"></a>00892         is_first_pass = <span class="keyword">False</span>
<a name="l00893"></a>00893       <span class="keywordflow">else</span>:
<a name="l00894"></a>00894         <span class="keyword">assert</span> result == self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(setting, <span class="keywordtype">None</span>), (
<a name="l00895"></a>00895             <span class="stringliteral">"Expected per-target setting for '%s', got per-config setting "</span>
<a name="l00896"></a>00896             <span class="stringliteral">"(target %s)"</span> % (setting, self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>]))
<a name="l00897"></a>00897     <span class="keywordflow">if</span> result <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00898"></a>00898       <span class="keywordflow">return</span> default
<a name="l00899"></a>00899     <span class="keywordflow">return</span> result
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#ce05e4fd3cd3f0f187280a80efabad75">00901</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#ce05e4fd3cd3f0f187280a80efabad75">_GetStripPostbuilds</a>(self, configname, output_binary, quiet):
<a name="l00902"></a>00902     <span class="stringliteral">"""Returns a list of shell commands that contain the shell commands</span>
<a name="l00903"></a>00903 <span class="stringliteral">    neccessary to strip this target's binary. These should be run as postbuilds</span>
<a name="l00904"></a>00904 <span class="stringliteral">    before the actual postbuilds run."""</span>
<a name="l00905"></a>00905     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     result = []
<a name="l00908"></a>00908     <span class="keywordflow">if</span> (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'DEPLOYMENT_POSTPROCESSING'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>) <span class="keywordflow">and</span>
<a name="l00909"></a>00909         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'STRIP_INSTALLED_PRODUCT'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'NO'</span>)):
<a name="l00910"></a>00910 
<a name="l00911"></a>00911       default_strip_style = <span class="stringliteral">'debugging'</span>
<a name="l00912"></a>00912       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'loadable_module'</span> <span class="keywordflow">and</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#81e2551e45a48e06b1ae5bf0083c10c5">_IsBundle</a>():
<a name="l00913"></a>00913         default_strip_style = <span class="stringliteral">'non-global'</span>
<a name="l00914"></a>00914       <span class="keywordflow">elif</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'executable'</span>:
<a name="l00915"></a>00915         default_strip_style = <span class="stringliteral">'all'</span>
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       strip_style = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'STRIP_STYLE'</span>, default_strip_style)
<a name="l00918"></a>00918       strip_flags = {
<a name="l00919"></a>00919         <span class="stringliteral">'all'</span>: <span class="stringliteral">''</span>,
<a name="l00920"></a>00920         <span class="stringliteral">'non-global'</span>: <span class="stringliteral">'-x'</span>,
<a name="l00921"></a>00921         <span class="stringliteral">'debugging'</span>: <span class="stringliteral">'-S'</span>,
<a name="l00922"></a>00922       }[strip_style]
<a name="l00923"></a>00923 
<a name="l00924"></a>00924       explicit_strip_flags = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d6405f4bcc12cad8cadcd8c19f71a90b">_Settings</a>().get(<span class="stringliteral">'STRIPFLAGS'</span>, <span class="stringliteral">''</span>)
<a name="l00925"></a>00925       <span class="keywordflow">if</span> explicit_strip_flags:
<a name="l00926"></a>00926         strip_flags += <span class="stringliteral">' '</span> + _NormalizeEnvVarReferences(explicit_strip_flags)
<a name="l00927"></a>00927 
<a name="l00928"></a>00928       <span class="keywordflow">if</span> <span class="keywordflow">not</span> quiet:
<a name="l00929"></a>00929         result.append(<span class="stringliteral">'echo STRIP\\(%s\\)'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00930"></a>00930       result.append(<span class="stringliteral">'strip %s %s'</span> % (strip_flags, output_binary))
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00933"></a>00933     <span class="keywordflow">return</span> result
<a name="l00934"></a>00934 
<a name="l00935"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#485eb384bd785378e3ff9faec691e066">00935</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#485eb384bd785378e3ff9faec691e066">_GetDebugInfoPostbuilds</a>(self, configname, output, output_binary, quiet):
<a name="l00936"></a>00936     <span class="stringliteral">"""Returns a list of shell commands that contain the shell commands</span>
<a name="l00937"></a>00937 <span class="stringliteral">    neccessary to massage this target's debug information. These should be run</span>
<a name="l00938"></a>00938 <span class="stringliteral">    as postbuilds before the actual postbuilds run."""</span>
<a name="l00939"></a>00939     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = configname
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="comment"># For static libraries, no dSYMs are created.</span>
<a name="l00942"></a>00942     result = []
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(<span class="stringliteral">'GCC_GENERATE_DEBUGGING_SYMBOLS'</span>, <span class="stringliteral">'YES'</span>, default=<span class="stringliteral">'YES'</span>) <span class="keywordflow">and</span>
<a name="l00944"></a>00944         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#cd99de2a1ab0d33e4ab0d4209aa7b731">_Test</a>(
<a name="l00945"></a>00945             <span class="stringliteral">'DEBUG_INFORMATION_FORMAT'</span>, <span class="stringliteral">'dwarf-with-dsym'</span>, default=<span class="stringliteral">'dwarf'</span>) <span class="keywordflow">and</span>
<a name="l00946"></a>00946         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'static_library'</span>):
<a name="l00947"></a>00947       <span class="keywordflow">if</span> <span class="keywordflow">not</span> quiet:
<a name="l00948"></a>00948         result.append(<span class="stringliteral">'echo DSYMUTIL\\(%s\\)'</span> % self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'target_name'</span>])
<a name="l00949"></a>00949       result.append(<span class="stringliteral">'dsymutil %s -o %s'</span> % (output_binary, output + <span class="stringliteral">'.dSYM'</span>))
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#9f2fa0daa6c7a452b1e2836cf76539db">configname</a> = <span class="keywordtype">None</span>
<a name="l00952"></a>00952     <span class="keywordflow">return</span> result
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c0d928576f4067bde6f01d98a0d2b4b5">00954</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c0d928576f4067bde6f01d98a0d2b4b5">_GetTargetPostbuilds</a>(self, configname, output, output_binary,
<a name="l00955"></a>00955                            quiet=<span class="keyword">False</span>):
<a name="l00956"></a>00956     <span class="stringliteral">"""Returns a list of shell commands that contain the shell commands</span>
<a name="l00957"></a>00957 <span class="stringliteral">    to run as postbuilds for this target, before the actual postbuilds."""</span>
<a name="l00958"></a>00958     <span class="comment"># dSYMs need to build before stripping happens.</span>
<a name="l00959"></a>00959     <span class="keywordflow">return</span> (
<a name="l00960"></a>00960         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#485eb384bd785378e3ff9faec691e066">_GetDebugInfoPostbuilds</a>(configname, output, output_binary, quiet) +
<a name="l00961"></a>00961         self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#ce05e4fd3cd3f0f187280a80efabad75">_GetStripPostbuilds</a>(configname, output_binary, quiet))
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d4c8b82a89fa5bf66bb3f2441742597e">00963</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d4c8b82a89fa5bf66bb3f2441742597e">_GetIOSPostbuilds</a>(self, configname, output_binary):
<a name="l00964"></a>00964     <span class="stringliteral">"""Return a shell command to codesign the iOS output binary so it can</span>
<a name="l00965"></a>00965 <span class="stringliteral">    be deployed to a device.  This should be run as the very last step of the</span>
<a name="l00966"></a>00966 <span class="stringliteral">    build."""</span>
<a name="l00967"></a>00967     <span class="keywordflow">if</span> <span class="keywordflow">not</span> (self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a> <span class="keywordflow">and</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#daf1b66faf18504ec4b5c8c0b7f6763b">spec</a>[<span class="stringliteral">'type'</span>] == <span class="stringliteral">'executable'</span>):
<a name="l00968"></a>00968       <span class="keywordflow">return</span> []
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     settings = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname]
<a name="l00971"></a>00971     key = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4e267fec70457486caa4eef0690e3260">_GetIOSCodeSignIdentityKey</a>(settings)
<a name="l00972"></a>00972     <span class="keywordflow">if</span> <span class="keywordflow">not</span> key:
<a name="l00973"></a>00973       <span class="keywordflow">return</span> []
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     <span class="comment"># Warn for any unimplemented signing xcode keys.</span>
<a name="l00976"></a>00976     unimpl = [<span class="stringliteral">'OTHER_CODE_SIGN_FLAGS'</span>]
<a name="l00977"></a>00977     unimpl = set(unimpl) &amp; set(self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].keys())
<a name="l00978"></a>00978     <span class="keywordflow">if</span> unimpl:
<a name="l00979"></a>00979       <span class="keywordflow">print</span> <span class="stringliteral">'Warning: Some codesign keys not implemented, ignoring: %s'</span> % (
<a name="l00980"></a>00980           <span class="stringliteral">', '</span>.join(sorted(unimpl)))
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="keywordflow">return</span> [<span class="stringliteral">'%s code-sign-bundle "%s" "%s" "%s" "%s"'</span> % (
<a name="l00983"></a>00983         os.path.join(<span class="stringliteral">'${TARGET_BUILD_DIR}'</span>, <span class="stringliteral">'gyp-mac-tool'</span>), key,
<a name="l00984"></a>00984         settings.get(<span class="stringliteral">'CODE_SIGN_RESOURCE_RULES_PATH'</span>, <span class="stringliteral">''</span>),
<a name="l00985"></a>00985         settings.get(<span class="stringliteral">'CODE_SIGN_ENTITLEMENTS'</span>, <span class="stringliteral">''</span>),
<a name="l00986"></a>00986         settings.get(<span class="stringliteral">'PROVISIONING_PROFILE'</span>, <span class="stringliteral">''</span>))
<a name="l00987"></a>00987     ]
<a name="l00988"></a>00988 
<a name="l00989"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4e267fec70457486caa4eef0690e3260">00989</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#4e267fec70457486caa4eef0690e3260">_GetIOSCodeSignIdentityKey</a>(self, settings):
<a name="l00990"></a>00990     identity = settings.get(<span class="stringliteral">'CODE_SIGN_IDENTITY'</span>)
<a name="l00991"></a>00991     <span class="keywordflow">if</span> <span class="keywordflow">not</span> identity:
<a name="l00992"></a>00992       <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00993"></a>00993     <span class="keywordflow">if</span> identity <span class="keywordflow">not</span> <span class="keywordflow">in</span> XcodeSettings._codesigning_key_cache:
<a name="l00994"></a>00994       output = subprocess.check_output(
<a name="l00995"></a>00995           [<span class="stringliteral">'security'</span>, <span class="stringliteral">'find-identity'</span>, <span class="stringliteral">'-p'</span>, <span class="stringliteral">'codesigning'</span>, <span class="stringliteral">'-v'</span>])
<a name="l00996"></a>00996       <span class="keywordflow">for</span> line <span class="keywordflow">in</span> output.splitlines():
<a name="l00997"></a>00997         <span class="keywordflow">if</span> identity <span class="keywordflow">in</span> line:
<a name="l00998"></a>00998           fingerprint = line.split()[1]
<a name="l00999"></a>00999           cache = XcodeSettings._codesigning_key_cache
<a name="l01000"></a>01000           <span class="keyword">assert</span> identity <span class="keywordflow">not</span> <span class="keywordflow">in</span> cache <span class="keywordflow">or</span> fingerprint == cache[identity], (
<a name="l01001"></a>01001               <span class="stringliteral">"Multiple codesigning fingerprints for identity: %s"</span> % identity)
<a name="l01002"></a>01002           XcodeSettings._codesigning_key_cache[identity] = fingerprint
<a name="l01003"></a>01003     <span class="keywordflow">return</span> XcodeSettings._codesigning_key_cache.get(identity, <span class="stringliteral">''</span>)
<a name="l01004"></a>01004 
<a name="l01005"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3a113bb7d15410a793d0ef8238f846">01005</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#1e3a113bb7d15410a793d0ef8238f846">AddImplicitPostbuilds</a>(self, configname, output, output_binary,
<a name="l01006"></a>01006                             postbuilds=[], quiet=<span class="keyword">False</span>):
<a name="l01007"></a>01007     <span class="stringliteral">"""Returns a list of shell commands that should run before and after</span>
<a name="l01008"></a>01008 <span class="stringliteral">    |postbuilds|."""</span>
<a name="l01009"></a>01009     <span class="keyword">assert</span> output_binary <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>
<a name="l01010"></a>01010     pre = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#c0d928576f4067bde6f01d98a0d2b4b5">_GetTargetPostbuilds</a>(configname, output, output_binary, quiet)
<a name="l01011"></a>01011     post = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#d4c8b82a89fa5bf66bb3f2441742597e">_GetIOSPostbuilds</a>(configname, output_binary)
<a name="l01012"></a>01012     <span class="keywordflow">return</span> pre + postbuilds + post
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#3219b70e3c784a3b209d7b8fbf929bdf">01014</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#3219b70e3c784a3b209d7b8fbf929bdf">_AdjustLibrary</a>(self, library, config_name=None):
<a name="l01015"></a>01015     <span class="keywordflow">if</span> library.endswith(<span class="stringliteral">'.framework'</span>):
<a name="l01016"></a>01016       l = <span class="stringliteral">'-framework '</span> + os.path.splitext(os.path.basename(library))[0]
<a name="l01017"></a>01017     <span class="keywordflow">else</span>:
<a name="l01018"></a>01018       m = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#34e0988bcc40626e8d76373fabacbf4c">library_re</a>.match(library)
<a name="l01019"></a>01019       <span class="keywordflow">if</span> m:
<a name="l01020"></a>01020         l = <span class="stringliteral">'-l'</span> + m.group(1)
<a name="l01021"></a>01021       <span class="keywordflow">else</span>:
<a name="l01022"></a>01022         l = library
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#df30737497efc1f46af59de4211dfb71">_SdkPath</a>(config_name)
<a name="l01025"></a>01025     <span class="keywordflow">if</span> <span class="keywordflow">not</span> sdk_root:
<a name="l01026"></a>01026       sdk_root = <span class="stringliteral">''</span>
<a name="l01027"></a>01027     <span class="keywordflow">return</span> l.replace(<span class="stringliteral">'$(SDKROOT)'</span>, sdk_root)
<a name="l01028"></a>01028 
<a name="l01029"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#8e0a56cdcdf26a3f66c0ccd0477da300">01029</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#8e0a56cdcdf26a3f66c0ccd0477da300">AdjustLibraries</a>(self, libraries, config_name=None):
<a name="l01030"></a>01030     <span class="stringliteral">"""Transforms entries like 'Cocoa.framework' in libraries into entries like</span>
<a name="l01031"></a>01031 <span class="stringliteral">    '-framework Cocoa', 'libcrypto.dylib' into '-lcrypto', etc.</span>
<a name="l01032"></a>01032 <span class="stringliteral">    """</span>
<a name="l01033"></a>01033     libraries = [self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#3219b70e3c784a3b209d7b8fbf929bdf">_AdjustLibrary</a>(library, config_name)
<a name="l01034"></a>01034                  <span class="keywordflow">for</span> library <span class="keywordflow">in</span> libraries]
<a name="l01035"></a>01035     <span class="keywordflow">return</span> libraries
<a name="l01036"></a>01036 
<a name="l01037"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8e2b79abf5a9eacb21baa1ba60cd206">01037</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8e2b79abf5a9eacb21baa1ba60cd206">_BuildMachineOSBuild</a>(self):
<a name="l01038"></a>01038     <span class="keywordflow">return</span> GetStdout([<span class="stringliteral">'sw_vers'</span>, <span class="stringliteral">'-buildVersion'</span>])
<a name="l01039"></a>01039 
<a name="l01040"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#5ca50281b0490fb0c67a81bdfa64a95d">01040</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#5ca50281b0490fb0c67a81bdfa64a95d">_XcodeIOSDeviceFamily</a>(self, configname):
<a name="l01041"></a>01041     family = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#82fdd7ef33787844f2f47ec02555786b">xcode_settings</a>[configname].get(<span class="stringliteral">'TARGETED_DEVICE_FAMILY'</span>, <span class="stringliteral">'1'</span>)
<a name="l01042"></a>01042     <span class="keywordflow">return</span> [int(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> family.split(<span class="stringliteral">','</span>)]
<a name="l01043"></a>01043 
<a name="l01044"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a01b2daad3f0d5c05c3a41c12dd9893a">01044</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#a01b2daad3f0d5c05c3a41c12dd9893a">GetExtraPlistItems</a>(self, configname=None):
<a name="l01045"></a>01045     <span class="stringliteral">"""Returns a dictionary with extra items to insert into Info.plist."""</span>
<a name="l01046"></a>01046     <span class="keywordflow">if</span> configname <span class="keywordflow">not</span> <span class="keywordflow">in</span> XcodeSettings._plist_cache:
<a name="l01047"></a>01047       cache = {}
<a name="l01048"></a>01048       cache[<span class="stringliteral">'BuildMachineOSBuild'</span>] = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8e2b79abf5a9eacb21baa1ba60cd206">_BuildMachineOSBuild</a>()
<a name="l01049"></a>01049 
<a name="l01050"></a>01050       xcode, xcode_build = XcodeVersion()
<a name="l01051"></a>01051       cache[<span class="stringliteral">'DTXcode'</span>] = xcode
<a name="l01052"></a>01052       cache[<span class="stringliteral">'DTXcodeBuild'</span>] = xcode_build
<a name="l01053"></a>01053 
<a name="l01054"></a>01054       sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#af2217af0f8066d69aabe87c823a5491">_SdkRoot</a>(configname)
<a name="l01055"></a>01055       <span class="keywordflow">if</span> <span class="keywordflow">not</span> sdk_root:
<a name="l01056"></a>01056         sdk_root = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e0cfdfeb001e9bb4da37d0a6ce37a2e2">_DefaultSdkRoot</a>()
<a name="l01057"></a>01057       cache[<span class="stringliteral">'DTSDKName'</span>] = sdk_root
<a name="l01058"></a>01058       <span class="keywordflow">if</span> xcode &gt;= <span class="stringliteral">'0430'</span>:
<a name="l01059"></a>01059         cache[<span class="stringliteral">'DTSDKBuild'</span>] = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8aec28c2484fbacd1dd35478a2884f5">_GetSdkVersionInfoItem</a>(
<a name="l01060"></a>01060             sdk_root, <span class="stringliteral">'ProductBuildVersion'</span>)
<a name="l01061"></a>01061       <span class="keywordflow">else</span>:
<a name="l01062"></a>01062         cache[<span class="stringliteral">'DTSDKBuild'</span>] = cache[<span class="stringliteral">'BuildMachineOSBuild'</span>]
<a name="l01063"></a>01063 
<a name="l01064"></a>01064       <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a>:
<a name="l01065"></a>01065         cache[<span class="stringliteral">'DTPlatformName'</span>] = cache[<span class="stringliteral">'DTSDKName'</span>]
<a name="l01066"></a>01066         <span class="keywordflow">if</span> configname.endswith(<span class="stringliteral">"iphoneos"</span>):
<a name="l01067"></a>01067           cache[<span class="stringliteral">'DTPlatformVersion'</span>] = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#f8aec28c2484fbacd1dd35478a2884f5">_GetSdkVersionInfoItem</a>(
<a name="l01068"></a>01068               sdk_root, <span class="stringliteral">'ProductVersion'</span>)
<a name="l01069"></a>01069           cache[<span class="stringliteral">'CFBundleSupportedPlatforms'</span>] = [<span class="stringliteral">'iPhoneOS'</span>]
<a name="l01070"></a>01070         <span class="keywordflow">else</span>:
<a name="l01071"></a>01071           cache[<span class="stringliteral">'CFBundleSupportedPlatforms'</span>] = [<span class="stringliteral">'iPhoneSimulator'</span>]
<a name="l01072"></a>01072       XcodeSettings._plist_cache[configname] = cache
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <span class="comment"># Include extra plist items that are per-target, not per global</span>
<a name="l01075"></a>01075     <span class="comment"># XcodeSettings.</span>
<a name="l01076"></a>01076     items = dict(XcodeSettings._plist_cache[configname])
<a name="l01077"></a>01077     <span class="keywordflow">if</span> self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#592163726865048e2823b2f98e6203f5">isIOS</a>:
<a name="l01078"></a>01078       items[<span class="stringliteral">'UIDeviceFamily'</span>] = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#5ca50281b0490fb0c67a81bdfa64a95d">_XcodeIOSDeviceFamily</a>(configname)
<a name="l01079"></a>01079     <span class="keywordflow">return</span> items
<a name="l01080"></a>01080 
<a name="l01081"></a><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e0cfdfeb001e9bb4da37d0a6ce37a2e2">01081</a>   <span class="keyword">def </span><a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#e0cfdfeb001e9bb4da37d0a6ce37a2e2">_DefaultSdkRoot</a>(self):
<a name="l01082"></a>01082     <span class="stringliteral">"""Returns the default SDKROOT to use.</span>
<a name="l01083"></a>01083 <span class="stringliteral"></span>
<a name="l01084"></a>01084 <span class="stringliteral">    Prior to version 5.0.0, if SDKROOT was not explicitly set in the Xcode</span>
<a name="l01085"></a>01085 <span class="stringliteral">    project, then the environment variable was empty. Starting with this</span>
<a name="l01086"></a>01086 <span class="stringliteral">    version, Xcode uses the name of the newest SDK installed.</span>
<a name="l01087"></a>01087 <span class="stringliteral">    """</span>
<a name="l01088"></a>01088     xcode_version, xcode_build = XcodeVersion()
<a name="l01089"></a>01089     <span class="keywordflow">if</span> xcode_version &lt; <span class="stringliteral">'0500'</span>:
<a name="l01090"></a>01090       <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l01091"></a>01091     default_sdk_path = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#7e72108afc42b978e94bd76754cc8e31">_XcodeSdkPath</a>(<span class="stringliteral">''</span>)
<a name="l01092"></a>01092     default_sdk_root = XcodeSettings._sdk_root_cache.get(default_sdk_path)
<a name="l01093"></a>01093     <span class="keywordflow">if</span> default_sdk_root:
<a name="l01094"></a>01094       <span class="keywordflow">return</span> default_sdk_root
<a name="l01095"></a>01095     <span class="keywordflow">try</span>:
<a name="l01096"></a>01096       all_sdks = GetStdout([<span class="stringliteral">'xcodebuild'</span>, <span class="stringliteral">'-showsdks'</span>])
<a name="l01097"></a>01097     <span class="keywordflow">except</span>:
<a name="l01098"></a>01098       <span class="comment"># If xcodebuild fails, there will be no valid SDKs</span>
<a name="l01099"></a>01099       <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l01100"></a>01100     <span class="keywordflow">for</span> line <span class="keywordflow">in</span> all_sdks.splitlines():
<a name="l01101"></a>01101       items = line.split()
<a name="l01102"></a>01102       <span class="keywordflow">if</span> len(items) &gt;= 3 <span class="keywordflow">and</span> items[-2] == <span class="stringliteral">'-sdk'</span>:
<a name="l01103"></a>01103         sdk_root = items[-1]
<a name="l01104"></a>01104         sdk_path = self.<a class="code" href="../../d1/d51/classgyp_1_1xcode__emulation_1_1_xcode_settings.html#7e72108afc42b978e94bd76754cc8e31">_XcodeSdkPath</a>(sdk_root)
<a name="l01105"></a>01105         <span class="keywordflow">if</span> sdk_path == default_sdk_path:
<a name="l01106"></a>01106           <span class="keywordflow">return</span> sdk_root
<a name="l01107"></a>01107     <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 
<a name="l01110"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html">01110</a> <span class="keyword">class </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html">MacPrefixHeader</a>(object):
<a name="l01111"></a>01111   <span class="stringliteral">"""A class that helps with emulating Xcode's GCC_PREFIX_HEADER feature.</span>
<a name="l01112"></a>01112 <span class="stringliteral"></span>
<a name="l01113"></a>01113 <span class="stringliteral">  This feature consists of several pieces:</span>
<a name="l01114"></a>01114 <span class="stringliteral">  * If GCC_PREFIX_HEADER is present, all compilations in that project get an</span>
<a name="l01115"></a>01115 <span class="stringliteral">    additional |-include path_to_prefix_header| cflag.</span>
<a name="l01116"></a>01116 <span class="stringliteral">  * If GCC_PRECOMPILE_PREFIX_HEADER is present too, then the prefix header is</span>
<a name="l01117"></a>01117 <span class="stringliteral">    instead compiled, and all other compilations in the project get an</span>
<a name="l01118"></a>01118 <span class="stringliteral">    additional |-include path_to_compiled_header| instead.</span>
<a name="l01119"></a>01119 <span class="stringliteral">    + Compiled prefix headers have the extension gch. There is one gch file for</span>
<a name="l01120"></a>01120 <span class="stringliteral">      every language used in the project (c, cc, m, mm), since gch files for</span>
<a name="l01121"></a>01121 <span class="stringliteral">      different languages aren't compatible.</span>
<a name="l01122"></a>01122 <span class="stringliteral">    + gch files themselves are built with the target's normal cflags, but they</span>
<a name="l01123"></a>01123 <span class="stringliteral">      obviously don't get the |-include| flag. Instead, they need a -x flag that</span>
<a name="l01124"></a>01124 <span class="stringliteral">      describes their language.</span>
<a name="l01125"></a>01125 <span class="stringliteral">    + All o files in the target need to depend on the gch file, to make sure</span>
<a name="l01126"></a>01126 <span class="stringliteral">      it's built before any o file is built.</span>
<a name="l01127"></a>01127 <span class="stringliteral"></span>
<a name="l01128"></a>01128 <span class="stringliteral">  This class helps with some of these tasks, but it needs help from the build</span>
<a name="l01129"></a>01129 <span class="stringliteral">  system for writing dependencies to the gch files, for writing build commands</span>
<a name="l01130"></a>01130 <span class="stringliteral">  for the gch files, and for figuring out the location of the gch files.</span>
<a name="l01131"></a>01131 <span class="stringliteral">  """</span>
<a name="l01132"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#c775ee34451fdfa742b318538164070e">01132</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#c775ee34451fdfa742b318538164070e">__init__</a>(self, xcode_settings,
<a name="l01133"></a>01133                gyp_path_to_build_path, gyp_path_to_build_output):
<a name="l01134"></a>01134     <span class="stringliteral">"""If xcode_settings is None, all methods on this class are no-ops.</span>
<a name="l01135"></a>01135 <span class="stringliteral"></span>
<a name="l01136"></a>01136 <span class="stringliteral">    Args:</span>
<a name="l01137"></a>01137 <span class="stringliteral">        gyp_path_to_build_path: A function that takes a gyp-relative path,</span>
<a name="l01138"></a>01138 <span class="stringliteral">            and returns a path relative to the build directory.</span>
<a name="l01139"></a>01139 <span class="stringliteral">        gyp_path_to_build_output: A function that takes a gyp-relative path and</span>
<a name="l01140"></a>01140 <span class="stringliteral">            a language code ('c', 'cc', 'm', or 'mm'), and that returns a path</span>
<a name="l01141"></a>01141 <span class="stringliteral">            to where the output of precompiling that path for that language</span>
<a name="l01142"></a>01142 <span class="stringliteral">            should be placed (without the trailing '.gch').</span>
<a name="l01143"></a>01143 <span class="stringliteral">    """</span>
<a name="l01144"></a>01144     <span class="comment"># This doesn't support per-configuration prefix headers. Good enough</span>
<a name="l01145"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">01145</a>     <span class="comment"># for now.</span>
<a name="l01146"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">01146</a>     self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a> = <span class="keywordtype">None</span>
<a name="l01147"></a>01147     self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a> = <span class="keyword">False</span>
<a name="l01148"></a>01148     <span class="keywordflow">if</span> xcode_settings:
<a name="l01149"></a>01149       self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a> = xcode_settings.GetPerTargetSetting(<span class="stringliteral">'GCC_PREFIX_HEADER'</span>)
<a name="l01150"></a>01150       self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a> = xcode_settings.GetPerTargetSetting(
<a name="l01151"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a371e7e35019539b88c72347bc166091">01151</a>           <span class="stringliteral">'GCC_PRECOMPILE_PREFIX_HEADER'</span>, default=<span class="stringliteral">'NO'</span>) != <span class="stringliteral">'NO'</span>
<a name="l01152"></a>01152     self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a371e7e35019539b88c72347bc166091">compiled_headers</a> = {}
<a name="l01153"></a>01153     <span class="keywordflow">if</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>:
<a name="l01154"></a>01154       <span class="keywordflow">if</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a>:
<a name="l01155"></a>01155         <span class="keywordflow">for</span> lang <span class="keywordflow">in</span> [<span class="stringliteral">'c'</span>, <span class="stringliteral">'cc'</span>, <span class="stringliteral">'m'</span>, <span class="stringliteral">'mm'</span>]:
<a name="l01156"></a>01156           self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a371e7e35019539b88c72347bc166091">compiled_headers</a>[lang] = gyp_path_to_build_output(
<a name="l01157"></a>01157               self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>, lang)
<a name="l01158"></a>01158       self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a> = gyp_path_to_build_path(self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>)
<a name="l01159"></a>01159 
<a name="l01160"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#02b9561e50890e61f1b60464ed155599">01160</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#02b9561e50890e61f1b60464ed155599">_CompiledHeader</a>(self, lang, arch):
<a name="l01161"></a>01161     <span class="keyword">assert</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a>
<a name="l01162"></a>01162     h = self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a371e7e35019539b88c72347bc166091">compiled_headers</a>[lang]
<a name="l01163"></a>01163     <span class="keywordflow">if</span> arch:
<a name="l01164"></a>01164       h += <span class="stringliteral">'.'</span> + arch
<a name="l01165"></a>01165     <span class="keywordflow">return</span> h
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#d9bcfb8ff2d21b98378301772dc664a8">01167</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#d9bcfb8ff2d21b98378301772dc664a8">GetInclude</a>(self, lang, arch=None):
<a name="l01168"></a>01168     <span class="stringliteral">"""Gets the cflags to include the prefix header for language |lang|."""</span>
<a name="l01169"></a>01169     <span class="keywordflow">if</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a> <span class="keywordflow">and</span> lang <span class="keywordflow">in</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a371e7e35019539b88c72347bc166091">compiled_headers</a>:
<a name="l01170"></a>01170       <span class="keywordflow">return</span> <span class="stringliteral">'-include %s'</span> % self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#02b9561e50890e61f1b60464ed155599">_CompiledHeader</a>(lang, arch)
<a name="l01171"></a>01171     <span class="keywordflow">elif</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>:
<a name="l01172"></a>01172       <span class="keywordflow">return</span> <span class="stringliteral">'-include %s'</span> % self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>
<a name="l01173"></a>01173     <span class="keywordflow">else</span>:
<a name="l01174"></a>01174       <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l01175"></a>01175 
<a name="l01176"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">01176</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(self, lang, arch):
<a name="l01177"></a>01177     <span class="stringliteral">"""Returns the actual file name of the prefix header for language |lang|."""</span>
<a name="l01178"></a>01178     <span class="keyword">assert</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a>
<a name="l01179"></a>01179     <span class="keywordflow">return</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#02b9561e50890e61f1b60464ed155599">_CompiledHeader</a>(lang, arch) + <span class="stringliteral">'.gch'</span>
<a name="l01180"></a>01180 
<a name="l01181"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a7709d4fe241cac7a80487ad86ca2693">01181</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#a7709d4fe241cac7a80487ad86ca2693">GetObjDependencies</a>(self, sources, objs, arch=None):
<a name="l01182"></a>01182     <span class="stringliteral">"""Given a list of source files and the corresponding object files, returns</span>
<a name="l01183"></a>01183 <span class="stringliteral">    a list of (source, object, gch) tuples, where |gch| is the build-directory</span>
<a name="l01184"></a>01184 <span class="stringliteral">    relative path to the gch file each object file depends on.  |compilable[i]|</span>
<a name="l01185"></a>01185 <span class="stringliteral">    has to be the source file belonging to |objs[i]|."""</span>
<a name="l01186"></a>01186     <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a> <span class="keywordflow">or</span> <span class="keywordflow">not</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a>:
<a name="l01187"></a>01187       <span class="keywordflow">return</span> []
<a name="l01188"></a>01188 
<a name="l01189"></a>01189     result = []
<a name="l01190"></a>01190     <span class="keywordflow">for</span> source, obj <span class="keywordflow">in</span> zip(sources, objs):
<a name="l01191"></a>01191       ext = os.path.splitext(source)[1]
<a name="l01192"></a>01192       lang = {
<a name="l01193"></a>01193         <span class="stringliteral">'.c'</span>: <span class="stringliteral">'c'</span>,
<a name="l01194"></a>01194         <span class="stringliteral">'.cpp'</span>: <span class="stringliteral">'cc'</span>, <span class="stringliteral">'.cc'</span>: <span class="stringliteral">'cc'</span>, <span class="stringliteral">'.cxx'</span>: <span class="stringliteral">'cc'</span>,
<a name="l01195"></a>01195         <span class="stringliteral">'.m'</span>: <span class="stringliteral">'m'</span>,
<a name="l01196"></a>01196         <span class="stringliteral">'.mm'</span>: <span class="stringliteral">'mm'</span>,
<a name="l01197"></a>01197       }.get(ext, <span class="keywordtype">None</span>)
<a name="l01198"></a>01198       <span class="keywordflow">if</span> lang:
<a name="l01199"></a>01199         result.append((source, obj, self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(lang, arch)))
<a name="l01200"></a>01200     <span class="keywordflow">return</span> result
<a name="l01201"></a>01201 
<a name="l01202"></a><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#2aa3c15c3979806544c12f9450e76efe">01202</a>   <span class="keyword">def </span><a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#2aa3c15c3979806544c12f9450e76efe">GetPchBuildCommands</a>(self, arch=None):
<a name="l01203"></a>01203     <span class="stringliteral">"""Returns [(path_to_gch, language_flag, language, header)].</span>
<a name="l01204"></a>01204 <span class="stringliteral">    |path_to_gch| and |header| are relative to the build directory.</span>
<a name="l01205"></a>01205 <span class="stringliteral">    """</span>
<a name="l01206"></a>01206     <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a> <span class="keywordflow">or</span> <span class="keywordflow">not</span> self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e62cafed3e5fca3aaf498038b833878e">compile_headers</a>:
<a name="l01207"></a>01207       <span class="keywordflow">return</span> []
<a name="l01208"></a>01208     <span class="keywordflow">return</span> [
<a name="l01209"></a>01209       (self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(<span class="stringliteral">'c'</span>, arch), <span class="stringliteral">'-x c-header'</span>, <span class="stringliteral">'c'</span>, self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>),
<a name="l01210"></a>01210       (self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(<span class="stringliteral">'cc'</span>, arch), <span class="stringliteral">'-x c++-header'</span>, <span class="stringliteral">'cc'</span>, self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>),
<a name="l01211"></a>01211       (self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(<span class="stringliteral">'m'</span>, arch), <span class="stringliteral">'-x objective-c-header'</span>, <span class="stringliteral">'m'</span>, self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>),
<a name="l01212"></a>01212       (self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#ce2e6dee57538561aecf8ffea0cbcf3a">_Gch</a>(<span class="stringliteral">'mm'</span>, arch), <span class="stringliteral">'-x objective-c++-header'</span>, <span class="stringliteral">'mm'</span>, self.<a class="code" href="../../df/df7/classgyp_1_1xcode__emulation_1_1_mac_prefix_header.html#e8f626807b2dddc1872b3005556939cd">header</a>),
<a name="l01213"></a>01213     ]
<a name="l01214"></a>01214 
<a name="l01215"></a>01215 
<a name="l01216"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#6d6047f924c264b97e8075323c32104f">01216</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#6d6047f924c264b97e8075323c32104f">XcodeVersion</a>():
<a name="l01217"></a>01217   <span class="stringliteral">"""Returns a tuple of version and build version of installed Xcode."""</span>
<a name="l01218"></a>01218   <span class="comment"># `xcodebuild -version` output looks like</span>
<a name="l01219"></a>01219   <span class="comment">#    Xcode 4.6.3</span>
<a name="l01220"></a>01220   <span class="comment">#    Build version 4H1503</span>
<a name="l01221"></a>01221   <span class="comment"># or like</span>
<a name="l01222"></a>01222   <span class="comment">#    Xcode 3.2.6</span>
<a name="l01223"></a>01223   <span class="comment">#    Component versions: DevToolsCore-1809.0; DevToolsSupport-1806.0</span>
<a name="l01224"></a>01224   <span class="comment">#    BuildVersion: 10M2518</span>
<a name="l01225"></a>01225   <span class="comment"># Convert that to '0463', '4H1503'.</span>
<a name="l01226"></a>01226   <span class="keyword">global</span> XCODE_VERSION_CACHE
<a name="l01227"></a>01227   <span class="keywordflow">if</span> XCODE_VERSION_CACHE:
<a name="l01228"></a>01228     <span class="keywordflow">return</span> XCODE_VERSION_CACHE
<a name="l01229"></a>01229   <span class="keywordflow">try</span>:
<a name="l01230"></a>01230     version_list = GetStdout([<span class="stringliteral">'xcodebuild'</span>, <span class="stringliteral">'-version'</span>]).splitlines()
<a name="l01231"></a>01231     <span class="comment"># In some circumstances xcodebuild exits 0 but doesn't return</span>
<a name="l01232"></a>01232     <span class="comment"># the right results; for example, a user on 10.7 or 10.8 with</span>
<a name="l01233"></a>01233     <span class="comment"># a bogus path set via xcode-select</span>
<a name="l01234"></a>01234     <span class="comment"># In that case this may be a CLT-only install so fall back to</span>
<a name="l01235"></a>01235     <span class="comment"># checking that version.</span>
<a name="l01236"></a>01236     <span class="keywordflow">if</span> len(version_list) &lt; 2:
<a name="l01237"></a>01237       <span class="keywordflow">raise</span> GypError(<span class="stringliteral">"xcodebuild returned unexpected results"</span>)
<a name="l01238"></a>01238   <span class="keywordflow">except</span>:
<a name="l01239"></a>01239     version = CLTVersion()
<a name="l01240"></a>01240     <span class="keywordflow">if</span> version:
<a name="l01241"></a>01241       version = re.match(<span class="stringliteral">r'(\d\.\d\.?\d*)'</span>, version).groups()[0]
<a name="l01242"></a>01242     <span class="keywordflow">else</span>:
<a name="l01243"></a>01243       <span class="keywordflow">raise</span> GypError(<span class="stringliteral">"No Xcode or CLT version detected!"</span>)
<a name="l01244"></a>01244     <span class="comment"># The CLT has no build information, so we return an empty string.</span>
<a name="l01245"></a>01245     version_list = [version, <span class="stringliteral">''</span>]
<a name="l01246"></a>01246   version = version_list[0]
<a name="l01247"></a>01247   build = version_list[-1]
<a name="l01248"></a>01248   <span class="comment"># Be careful to convert "4.2" to "0420":</span>
<a name="l01249"></a>01249   version = version.split()[-1].replace(<span class="stringliteral">'.'</span>, <span class="stringliteral">''</span>)
<a name="l01250"></a>01250   version = (version + <span class="stringliteral">'0'</span> * (3 - len(version))).zfill(4)
<a name="l01251"></a>01251   <span class="keywordflow">if</span> build:
<a name="l01252"></a>01252     build = build.split()[-1]
<a name="l01253"></a>01253   XCODE_VERSION_CACHE = (version, build)
<a name="l01254"></a>01254   <span class="keywordflow">return</span> XCODE_VERSION_CACHE
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 
<a name="l01257"></a>01257 <span class="comment"># This function ported from the logic in Homebrew's CLT version check</span>
<a name="l01258"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#ad2371eac5c39a2e3d84882ddbac185f">01258</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#ad2371eac5c39a2e3d84882ddbac185f">CLTVersion</a>():
<a name="l01259"></a>01259   <span class="stringliteral">"""Returns the version of command-line tools from pkgutil."""</span>
<a name="l01260"></a>01260   <span class="comment"># pkgutil output looks like</span>
<a name="l01261"></a>01261   <span class="comment">#   package-id: com.apple.pkg.CLTools_Executables</span>
<a name="l01262"></a>01262   <span class="comment">#   version: 5.0.1.0.1.1382131676</span>
<a name="l01263"></a>01263   <span class="comment">#   volume: /</span>
<a name="l01264"></a>01264   <span class="comment">#   location: /</span>
<a name="l01265"></a>01265   <span class="comment">#   install-time: 1382544035</span>
<a name="l01266"></a>01266   <span class="comment">#   groups: com.apple.FindSystemFiles.pkg-group com.apple.DevToolsBoth.pkg-group com.apple.DevToolsNonRelocatableShared.pkg-group</span>
<a name="l01267"></a>01267   STANDALONE_PKG_ID = <span class="stringliteral">"com.apple.pkg.DeveloperToolsCLILeo"</span>
<a name="l01268"></a>01268   FROM_XCODE_PKG_ID = <span class="stringliteral">"com.apple.pkg.DeveloperToolsCLI"</span>
<a name="l01269"></a>01269   MAVERICKS_PKG_ID = <span class="stringliteral">"com.apple.pkg.CLTools_Executables"</span>
<a name="l01270"></a>01270 
<a name="l01271"></a>01271   regex = re.compile(<span class="stringliteral">'version: (?P&lt;version&gt;.+)'</span>)
<a name="l01272"></a>01272   <span class="keywordflow">for</span> key <span class="keywordflow">in</span> [MAVERICKS_PKG_ID, STANDALONE_PKG_ID, FROM_XCODE_PKG_ID]:
<a name="l01273"></a>01273     <span class="keywordflow">try</span>:
<a name="l01274"></a>01274       output = GetStdout([<span class="stringliteral">'/usr/sbin/pkgutil'</span>, <span class="stringliteral">'--pkg-info'</span>, key])
<a name="l01275"></a>01275       <span class="keywordflow">return</span> re.search(regex, output).groupdict()[<span class="stringliteral">'version'</span>]
<a name="l01276"></a>01276     <span class="keywordflow">except</span>:
<a name="l01277"></a>01277       <span class="keywordflow">continue</span>
<a name="l01278"></a>01278 
<a name="l01279"></a>01279 
<a name="l01280"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#11688e8b5ae0b244f91411d4afa68dd3">01280</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#11688e8b5ae0b244f91411d4afa68dd3">GetStdout</a>(cmdlist):
<a name="l01281"></a>01281   <span class="stringliteral">"""Returns the content of standard output returned by invoking |cmdlist|.</span>
<a name="l01282"></a>01282 <span class="stringliteral">  Raises |GypError| if the command return with a non-zero return code."""</span>
<a name="l01283"></a>01283   job = subprocess.Popen(cmdlist, stdout=subprocess.PIPE)
<a name="l01284"></a>01284   out = job.communicate()[0]
<a name="l01285"></a>01285   <span class="keywordflow">if</span> job.returncode != 0:
<a name="l01286"></a>01286     sys.stderr.write(out + <span class="stringliteral">'\n'</span>)
<a name="l01287"></a>01287     <span class="keywordflow">raise</span> GypError(<span class="stringliteral">'Error %d running %s'</span> % (job.returncode, cmdlist[0]))
<a name="l01288"></a>01288   <span class="keywordflow">return</span> out.rstrip(<span class="stringliteral">'\n'</span>)
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 
<a name="l01291"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#cd795de2c42a601d1d7bb32a296cccc9">01291</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#cd795de2c42a601d1d7bb32a296cccc9">MergeGlobalXcodeSettingsToSpec</a>(global_dict, spec):
<a name="l01292"></a>01292   <span class="stringliteral">"""Merges the global xcode_settings dictionary into each configuration of the</span>
<a name="l01293"></a>01293 <span class="stringliteral">  target represented by spec. For keys that are both in the global and the local</span>
<a name="l01294"></a>01294 <span class="stringliteral">  xcode_settings dict, the local key gets precendence.</span>
<a name="l01295"></a>01295 <span class="stringliteral">  """</span>
<a name="l01296"></a>01296   <span class="comment"># The xcode generator special-cases global xcode_settings and does something</span>
<a name="l01297"></a>01297   <span class="comment"># that amounts to merging in the global xcode_settings into each local</span>
<a name="l01298"></a>01298   <span class="comment"># xcode_settings dict.</span>
<a name="l01299"></a>01299   global_xcode_settings = global_dict.get(<span class="stringliteral">'xcode_settings'</span>, {})
<a name="l01300"></a>01300   <span class="keywordflow">for</span> config <span class="keywordflow">in</span> spec[<span class="stringliteral">'configurations'</span>].values():
<a name="l01301"></a>01301     <span class="keywordflow">if</span> <span class="stringliteral">'xcode_settings'</span> <span class="keywordflow">in</span> config:
<a name="l01302"></a>01302       new_settings = global_xcode_settings.copy()
<a name="l01303"></a>01303       new_settings.update(config[<span class="stringliteral">'xcode_settings'</span>])
<a name="l01304"></a>01304       config[<span class="stringliteral">'xcode_settings'</span>] = new_settings
<a name="l01305"></a>01305 
<a name="l01306"></a>01306 
<a name="l01307"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#c094cc41dee7e53925cff950bd4c8fb2">01307</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#c094cc41dee7e53925cff950bd4c8fb2">IsMacBundle</a>(flavor, spec):
<a name="l01308"></a>01308   <span class="stringliteral">"""Returns if |spec| should be treated as a bundle.</span>
<a name="l01309"></a>01309 <span class="stringliteral"></span>
<a name="l01310"></a>01310 <span class="stringliteral">  Bundles are directories with a certain subdirectory structure, instead of</span>
<a name="l01311"></a>01311 <span class="stringliteral">  just a single file. Bundle rules do not produce a binary but also package</span>
<a name="l01312"></a>01312 <span class="stringliteral">  resources into that directory."""</span>
<a name="l01313"></a>01313   is_mac_bundle = (int(spec.get(<span class="stringliteral">'mac_bundle'</span>, 0)) != 0 <span class="keywordflow">and</span> flavor == <span class="stringliteral">'mac'</span>)
<a name="l01314"></a>01314   <span class="keywordflow">if</span> is_mac_bundle:
<a name="l01315"></a>01315     <span class="keyword">assert</span> spec[<span class="stringliteral">'type'</span>] != <span class="stringliteral">'none'</span>, (
<a name="l01316"></a>01316         <span class="stringliteral">'mac_bundle targets cannot have type none (target "%s")'</span> %
<a name="l01317"></a>01317         spec[<span class="stringliteral">'target_name'</span>])
<a name="l01318"></a>01318   <span class="keywordflow">return</span> is_mac_bundle
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 
<a name="l01321"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#ca476647bce8c14fd56df31335b589b5">01321</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#ca476647bce8c14fd56df31335b589b5">GetMacBundleResources</a>(product_dir, xcode_settings, resources):
<a name="l01322"></a>01322   <span class="stringliteral">"""Yields (output, resource) pairs for every resource in |resources|.</span>
<a name="l01323"></a>01323 <span class="stringliteral">  Only call this for mac bundle targets.</span>
<a name="l01324"></a>01324 <span class="stringliteral"></span>
<a name="l01325"></a>01325 <span class="stringliteral">  Args:</span>
<a name="l01326"></a>01326 <span class="stringliteral">      product_dir: Path to the directory containing the output bundle,</span>
<a name="l01327"></a>01327 <span class="stringliteral">          relative to the build directory.</span>
<a name="l01328"></a>01328 <span class="stringliteral">      xcode_settings: The XcodeSettings of the current target.</span>
<a name="l01329"></a>01329 <span class="stringliteral">      resources: A list of bundle resources, relative to the build directory.</span>
<a name="l01330"></a>01330 <span class="stringliteral">  """</span>
<a name="l01331"></a>01331   dest = os.path.join(product_dir,
<a name="l01332"></a>01332                       xcode_settings.GetBundleResourceFolder())
<a name="l01333"></a>01333   <span class="keywordflow">for</span> res <span class="keywordflow">in</span> resources:
<a name="l01334"></a>01334     output = dest
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     <span class="comment"># The make generator doesn't support it, so forbid it everywhere</span>
<a name="l01337"></a>01337     <span class="comment"># to keep the generators more interchangable.</span>
<a name="l01338"></a>01338     <span class="keyword">assert</span> <span class="stringliteral">' '</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> res, (
<a name="l01339"></a>01339       <span class="stringliteral">"Spaces in resource filenames not supported (%s)"</span>  % res)
<a name="l01340"></a>01340 
<a name="l01341"></a>01341     <span class="comment"># Split into (path,file).</span>
<a name="l01342"></a>01342     res_parts = os.path.split(res)
<a name="l01343"></a>01343 
<a name="l01344"></a>01344     <span class="comment"># Now split the path into (prefix,maybe.lproj).</span>
<a name="l01345"></a>01345     lproj_parts = os.path.split(res_parts[0])
<a name="l01346"></a>01346     <span class="comment"># If the resource lives in a .lproj bundle, add that to the destination.</span>
<a name="l01347"></a>01347     <span class="keywordflow">if</span> lproj_parts[1].endswith(<span class="stringliteral">'.lproj'</span>):
<a name="l01348"></a>01348       output = os.path.join(output, lproj_parts[1])
<a name="l01349"></a>01349 
<a name="l01350"></a>01350     output = os.path.join(output, res_parts[1])
<a name="l01351"></a>01351     <span class="comment"># Compiled XIB files are referred to by .nib.</span>
<a name="l01352"></a>01352     <span class="keywordflow">if</span> output.endswith(<span class="stringliteral">'.xib'</span>):
<a name="l01353"></a>01353       output = os.path.splitext(output)[0] + <span class="stringliteral">'.nib'</span>
<a name="l01354"></a>01354     <span class="comment"># Compiled storyboard files are referred to by .storyboardc.</span>
<a name="l01355"></a>01355     <span class="keywordflow">if</span> output.endswith(<span class="stringliteral">'.storyboard'</span>):
<a name="l01356"></a>01356       output = os.path.splitext(output)[0] + <span class="stringliteral">'.storyboardc'</span>
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     <span class="keywordflow">yield</span> output, res
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 
<a name="l01361"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#1c99aa131718c75572558f9de5144eb0">01361</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#1c99aa131718c75572558f9de5144eb0">GetMacInfoPlist</a>(product_dir, xcode_settings, gyp_path_to_build_path):
<a name="l01362"></a>01362   <span class="stringliteral">"""Returns (info_plist, dest_plist, defines, extra_env), where:</span>
<a name="l01363"></a>01363 <span class="stringliteral">  * |info_plist| is the source plist path, relative to the</span>
<a name="l01364"></a>01364 <span class="stringliteral">    build directory,</span>
<a name="l01365"></a>01365 <span class="stringliteral">  * |dest_plist| is the destination plist path, relative to the</span>
<a name="l01366"></a>01366 <span class="stringliteral">    build directory,</span>
<a name="l01367"></a>01367 <span class="stringliteral">  * |defines| is a list of preprocessor defines (empty if the plist</span>
<a name="l01368"></a>01368 <span class="stringliteral">    shouldn't be preprocessed,</span>
<a name="l01369"></a>01369 <span class="stringliteral">  * |extra_env| is a dict of env variables that should be exported when</span>
<a name="l01370"></a>01370 <span class="stringliteral">    invoking |mac_tool copy-info-plist|.</span>
<a name="l01371"></a>01371 <span class="stringliteral"></span>
<a name="l01372"></a>01372 <span class="stringliteral">  Only call this for mac bundle targets.</span>
<a name="l01373"></a>01373 <span class="stringliteral"></span>
<a name="l01374"></a>01374 <span class="stringliteral">  Args:</span>
<a name="l01375"></a>01375 <span class="stringliteral">      product_dir: Path to the directory containing the output bundle,</span>
<a name="l01376"></a>01376 <span class="stringliteral">          relative to the build directory.</span>
<a name="l01377"></a>01377 <span class="stringliteral">      xcode_settings: The XcodeSettings of the current target.</span>
<a name="l01378"></a>01378 <span class="stringliteral">      gyp_to_build_path: A function that converts paths relative to the</span>
<a name="l01379"></a>01379 <span class="stringliteral">          current gyp file to paths relative to the build direcotry.</span>
<a name="l01380"></a>01380 <span class="stringliteral">  """</span>
<a name="l01381"></a>01381   info_plist = xcode_settings.GetPerTargetSetting(<span class="stringliteral">'INFOPLIST_FILE'</span>)
<a name="l01382"></a>01382   <span class="keywordflow">if</span> <span class="keywordflow">not</span> info_plist:
<a name="l01383"></a>01383     <span class="keywordflow">return</span> <span class="keywordtype">None</span>, <span class="keywordtype">None</span>, [], {}
<a name="l01384"></a>01384 
<a name="l01385"></a>01385   <span class="comment"># The make generator doesn't support it, so forbid it everywhere</span>
<a name="l01386"></a>01386   <span class="comment"># to keep the generators more interchangable.</span>
<a name="l01387"></a>01387   <span class="keyword">assert</span> <span class="stringliteral">' '</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> info_plist, (
<a name="l01388"></a>01388     <span class="stringliteral">"Spaces in Info.plist filenames not supported (%s)"</span>  % info_plist)
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   info_plist = gyp_path_to_build_path(info_plist)
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <span class="comment"># If explicitly set to preprocess the plist, invoke the C preprocessor and</span>
<a name="l01393"></a>01393   <span class="comment"># specify any defines as -D flags.</span>
<a name="l01394"></a>01394   <span class="keywordflow">if</span> xcode_settings.GetPerTargetSetting(
<a name="l01395"></a>01395       <span class="stringliteral">'INFOPLIST_PREPROCESS'</span>, default=<span class="stringliteral">'NO'</span>) == <span class="stringliteral">'YES'</span>:
<a name="l01396"></a>01396     <span class="comment"># Create an intermediate file based on the path.</span>
<a name="l01397"></a>01397     defines = shlex.split(xcode_settings.GetPerTargetSetting(
<a name="l01398"></a>01398         <span class="stringliteral">'INFOPLIST_PREPROCESSOR_DEFINITIONS'</span>, default=<span class="stringliteral">''</span>))
<a name="l01399"></a>01399   <span class="keywordflow">else</span>:
<a name="l01400"></a>01400     defines = []
<a name="l01401"></a>01401 
<a name="l01402"></a>01402   dest_plist = os.path.join(product_dir, xcode_settings.GetBundlePlistPath())
<a name="l01403"></a>01403   extra_env = xcode_settings.GetPerTargetSettings()
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   <span class="keywordflow">return</span> info_plist, dest_plist, defines, extra_env
<a name="l01406"></a>01406 
<a name="l01407"></a>01407 
<a name="l01408"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#cb013db37b970bc71995507494140417">01408</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#cb013db37b970bc71995507494140417">_GetXcodeEnv</a>(xcode_settings, built_products_dir, srcroot, configuration,
<a name="l01409"></a>01409                 additional_settings=<span class="keywordtype">None</span>):
<a name="l01410"></a>01410   <span class="stringliteral">"""Return the environment variables that Xcode would set. See</span>
<a name="l01411"></a>01411 <span class="stringliteral">  http://developer.apple.com/library/mac/#documentation/DeveloperTools/Reference/XcodeBuildSettingRef/1-Build_Setting_Reference/build_setting_ref.html#//apple_ref/doc/uid/TP40003931-CH3-SW153</span>
<a name="l01412"></a>01412 <span class="stringliteral">  for a full list.</span>
<a name="l01413"></a>01413 <span class="stringliteral"></span>
<a name="l01414"></a>01414 <span class="stringliteral">  Args:</span>
<a name="l01415"></a>01415 <span class="stringliteral">      xcode_settings: An XcodeSettings object. If this is None, this function</span>
<a name="l01416"></a>01416 <span class="stringliteral">          returns an empty dict.</span>
<a name="l01417"></a>01417 <span class="stringliteral">      built_products_dir: Absolute path to the built products dir.</span>
<a name="l01418"></a>01418 <span class="stringliteral">      srcroot: Absolute path to the source root.</span>
<a name="l01419"></a>01419 <span class="stringliteral">      configuration: The build configuration name.</span>
<a name="l01420"></a>01420 <span class="stringliteral">      additional_settings: An optional dict with more values to add to the</span>
<a name="l01421"></a>01421 <span class="stringliteral">          result.</span>
<a name="l01422"></a>01422 <span class="stringliteral">  """</span>
<a name="l01423"></a>01423   <span class="keywordflow">if</span> <span class="keywordflow">not</span> xcode_settings: <span class="keywordflow">return</span> {}
<a name="l01424"></a>01424 
<a name="l01425"></a>01425   <span class="comment"># This function is considered a friend of XcodeSettings, so let it reach into</span>
<a name="l01426"></a>01426   <span class="comment"># its implementation details.</span>
<a name="l01427"></a>01427   spec = xcode_settings.spec
<a name="l01428"></a>01428 
<a name="l01429"></a>01429   <span class="comment"># These are filled in on a as-needed basis.</span>
<a name="l01430"></a>01430   env = {
<a name="l01431"></a>01431     <span class="stringliteral">'BUILT_PRODUCTS_DIR'</span> : built_products_dir,
<a name="l01432"></a>01432     <span class="stringliteral">'CONFIGURATION'</span> : configuration,
<a name="l01433"></a>01433     <span class="stringliteral">'PRODUCT_NAME'</span> : xcode_settings.GetProductName(),
<a name="l01434"></a>01434     <span class="comment"># See /Developer/Platforms/MacOSX.platform/Developer/Library/Xcode/Specifications/MacOSX\ Product\ Types.xcspec for FULL_PRODUCT_NAME</span>
<a name="l01435"></a>01435     <span class="stringliteral">'SRCROOT'</span> : srcroot,
<a name="l01436"></a>01436     <span class="stringliteral">'SOURCE_ROOT'</span>: <span class="stringliteral">'${SRCROOT}'</span>,
<a name="l01437"></a>01437     <span class="comment"># This is not true for static libraries, but currently the env is only</span>
<a name="l01438"></a>01438     <span class="comment"># written for bundles:</span>
<a name="l01439"></a>01439     <span class="stringliteral">'TARGET_BUILD_DIR'</span> : built_products_dir,
<a name="l01440"></a>01440     <span class="stringliteral">'TEMP_DIR'</span> : <span class="stringliteral">'${TMPDIR}'</span>,
<a name="l01441"></a>01441   }
<a name="l01442"></a>01442   <span class="keywordflow">if</span> xcode_settings.GetPerConfigSetting(<span class="stringliteral">'SDKROOT'</span>, configuration):
<a name="l01443"></a>01443     env[<span class="stringliteral">'SDKROOT'</span>] = xcode_settings._SdkPath(configuration)
<a name="l01444"></a>01444   <span class="keywordflow">else</span>:
<a name="l01445"></a>01445     env[<span class="stringliteral">'SDKROOT'</span>] = <span class="stringliteral">''</span>
<a name="l01446"></a>01446 
<a name="l01447"></a>01447   <span class="keywordflow">if</span> spec[<span class="stringliteral">'type'</span>] <span class="keywordflow">in</span> (
<a name="l01448"></a>01448       <span class="stringliteral">'executable'</span>, <span class="stringliteral">'static_library'</span>, <span class="stringliteral">'shared_library'</span>, <span class="stringliteral">'loadable_module'</span>):
<a name="l01449"></a>01449     env[<span class="stringliteral">'EXECUTABLE_NAME'</span>] = xcode_settings.GetExecutableName()
<a name="l01450"></a>01450     env[<span class="stringliteral">'EXECUTABLE_PATH'</span>] = xcode_settings.GetExecutablePath()
<a name="l01451"></a>01451     env[<span class="stringliteral">'FULL_PRODUCT_NAME'</span>] = xcode_settings.GetFullProductName()
<a name="l01452"></a>01452     mach_o_type = xcode_settings.GetMachOType()
<a name="l01453"></a>01453     <span class="keywordflow">if</span> mach_o_type:
<a name="l01454"></a>01454       env[<span class="stringliteral">'MACH_O_TYPE'</span>] = mach_o_type
<a name="l01455"></a>01455     env[<span class="stringliteral">'PRODUCT_TYPE'</span>] = xcode_settings.GetProductType()
<a name="l01456"></a>01456   <span class="keywordflow">if</span> xcode_settings._IsBundle():
<a name="l01457"></a>01457     env[<span class="stringliteral">'CONTENTS_FOLDER_PATH'</span>] = \
<a name="l01458"></a>01458       xcode_settings.GetBundleContentsFolderPath()
<a name="l01459"></a>01459     env[<span class="stringliteral">'UNLOCALIZED_RESOURCES_FOLDER_PATH'</span>] = \
<a name="l01460"></a>01460         xcode_settings.GetBundleResourceFolder()
<a name="l01461"></a>01461     env[<span class="stringliteral">'INFOPLIST_PATH'</span>] = xcode_settings.GetBundlePlistPath()
<a name="l01462"></a>01462     env[<span class="stringliteral">'WRAPPER_NAME'</span>] = xcode_settings.GetWrapperName()
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   install_name = xcode_settings.GetInstallName()
<a name="l01465"></a>01465   <span class="keywordflow">if</span> install_name:
<a name="l01466"></a>01466     env[<span class="stringliteral">'LD_DYLIB_INSTALL_NAME'</span>] = install_name
<a name="l01467"></a>01467   install_name_base = xcode_settings.GetInstallNameBase()
<a name="l01468"></a>01468   <span class="keywordflow">if</span> install_name_base:
<a name="l01469"></a>01469     env[<span class="stringliteral">'DYLIB_INSTALL_NAME_BASE'</span>] = install_name_base
<a name="l01470"></a>01470   <span class="keywordflow">if</span> XcodeVersion() &gt;= <span class="stringliteral">'0500'</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> env.get(<span class="stringliteral">'SDKROOT'</span>):
<a name="l01471"></a>01471     sdk_root = xcode_settings._SdkRoot(configuration)
<a name="l01472"></a>01472     <span class="keywordflow">if</span> <span class="keywordflow">not</span> sdk_root:
<a name="l01473"></a>01473       sdk_root = xcode_settings._XcodeSdkPath(<span class="stringliteral">''</span>)
<a name="l01474"></a>01474     <span class="keywordflow">if</span> sdk_root <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l01475"></a>01475       sdk_root = <span class="stringliteral">''</span>
<a name="l01476"></a>01476     env[<span class="stringliteral">'SDKROOT'</span>] = sdk_root
<a name="l01477"></a>01477 
<a name="l01478"></a>01478   <span class="keywordflow">if</span> <span class="keywordflow">not</span> additional_settings:
<a name="l01479"></a>01479     additional_settings = {}
<a name="l01480"></a>01480   <span class="keywordflow">else</span>:
<a name="l01481"></a>01481     <span class="comment"># Flatten lists to strings.</span>
<a name="l01482"></a>01482     <span class="keywordflow">for</span> k <span class="keywordflow">in</span> additional_settings:
<a name="l01483"></a>01483       <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(additional_settings[k], str):
<a name="l01484"></a>01484         additional_settings[k] = <span class="stringliteral">' '</span>.join(additional_settings[k])
<a name="l01485"></a>01485   additional_settings.update(env)
<a name="l01486"></a>01486 
<a name="l01487"></a>01487   <span class="keywordflow">for</span> k <span class="keywordflow">in</span> additional_settings:
<a name="l01488"></a>01488     additional_settings[k] = _NormalizeEnvVarReferences(additional_settings[k])
<a name="l01489"></a>01489 
<a name="l01490"></a>01490   <span class="keywordflow">return</span> additional_settings
<a name="l01491"></a>01491 
<a name="l01492"></a>01492 
<a name="l01493"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a0fd383d0bde090a84c8ea22d80c1f91">01493</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a0fd383d0bde090a84c8ea22d80c1f91">_NormalizeEnvVarReferences</a>(str):
<a name="l01494"></a>01494   <span class="stringliteral">"""Takes a string containing variable references in the form ${FOO}, $(FOO),</span>
<a name="l01495"></a>01495 <span class="stringliteral">  or $FOO, and returns a string with all variable references in the form ${FOO}.</span>
<a name="l01496"></a>01496 <span class="stringliteral">  """</span>
<a name="l01497"></a>01497   <span class="comment"># $FOO -&gt; ${FOO}</span>
<a name="l01498"></a>01498   str = re.sub(<span class="stringliteral">r'\$([a-zA-Z_][a-zA-Z0-9_]*)'</span>, <span class="stringliteral">r'${\1}'</span>, str)
<a name="l01499"></a>01499 
<a name="l01500"></a>01500   <span class="comment"># $(FOO) -&gt; ${FOO}</span>
<a name="l01501"></a>01501   matches = re.findall(<span class="stringliteral">r'(\$\(([a-zA-Z0-9\-_]+)\))'</span>, str)
<a name="l01502"></a>01502   <span class="keywordflow">for</span> match <span class="keywordflow">in</span> matches:
<a name="l01503"></a>01503     to_replace, variable = match
<a name="l01504"></a>01504     <span class="keyword">assert</span> <span class="stringliteral">'$('</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> match, <span class="stringliteral">'$($(FOO)) variables not supported: '</span> + match
<a name="l01505"></a>01505     str = str.replace(to_replace, <span class="stringliteral">'${'</span> + variable + <span class="stringliteral">'}'</span>)
<a name="l01506"></a>01506 
<a name="l01507"></a>01507   <span class="keywordflow">return</span> str
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a8328c352442f8ec8fa9e6ed1bc3fa5c">01510</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#a8328c352442f8ec8fa9e6ed1bc3fa5c">ExpandEnvVars</a>(string, expansions):
<a name="l01511"></a>01511   <span class="stringliteral">"""Expands ${VARIABLES}, $(VARIABLES), and $VARIABLES in string per the</span>
<a name="l01512"></a>01512 <span class="stringliteral">  expansions list. If the variable expands to something that references</span>
<a name="l01513"></a>01513 <span class="stringliteral">  another variable, this variable is expanded as well if it's in env --</span>
<a name="l01514"></a>01514 <span class="stringliteral">  until no variables present in env are left."""</span>
<a name="l01515"></a>01515   <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> reversed(expansions):
<a name="l01516"></a>01516     string = string.replace(<span class="stringliteral">'${'</span> + k + <span class="stringliteral">'}'</span>, v)
<a name="l01517"></a>01517     string = string.replace(<span class="stringliteral">'$('</span> + k + <span class="stringliteral">')'</span>, v)
<a name="l01518"></a>01518     string = string.replace(<span class="stringliteral">'$'</span> + k, v)
<a name="l01519"></a>01519   <span class="keywordflow">return</span> string
<a name="l01520"></a>01520 
<a name="l01521"></a>01521 
<a name="l01522"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#87be844c18f23fa98b11e3d61d5882d5">01522</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#87be844c18f23fa98b11e3d61d5882d5">_TopologicallySortedEnvVarKeys</a>(env):
<a name="l01523"></a>01523   <span class="stringliteral">"""Takes a dict |env| whose values are strings that can refer to other keys,</span>
<a name="l01524"></a>01524 <span class="stringliteral">  for example env['foo'] = '$(bar) and $(baz)'. Returns a list L of all keys of</span>
<a name="l01525"></a>01525 <span class="stringliteral">  env such that key2 is after key1 in L if env[key2] refers to env[key1].</span>
<a name="l01526"></a>01526 <span class="stringliteral"></span>
<a name="l01527"></a>01527 <span class="stringliteral">  Throws an Exception in case of dependency cycles.</span>
<a name="l01528"></a>01528 <span class="stringliteral">  """</span>
<a name="l01529"></a>01529   <span class="comment"># Since environment variables can refer to other variables, the evaluation</span>
<a name="l01530"></a>01530   <span class="comment"># order is important. Below is the logic to compute the dependency graph</span>
<a name="l01531"></a>01531   <span class="comment"># and sort it.</span>
<a name="l01532"></a>01532   regex = re.compile(<span class="stringliteral">r'\$\{([a-zA-Z0-9\-_]+)\}'</span>)
<a name="l01533"></a>01533   <span class="keyword">def </span>GetEdges(node):
<a name="l01534"></a>01534     <span class="comment"># Use a definition of edges such that user_of_variable -&gt; used_varible.</span>
<a name="l01535"></a>01535     <span class="comment"># This happens to be easier in this case, since a variable's</span>
<a name="l01536"></a>01536     <span class="comment"># definition contains all variables it references in a single string.</span>
<a name="l01537"></a>01537     <span class="comment"># We can then reverse the result of the topological sort at the end.</span>
<a name="l01538"></a>01538     <span class="comment"># Since: reverse(topsort(DAG)) = topsort(reverse_edges(DAG))</span>
<a name="l01539"></a>01539     matches = set([v <span class="keywordflow">for</span> v <span class="keywordflow">in</span> regex.findall(env[node]) <span class="keywordflow">if</span> v <span class="keywordflow">in</span> env])
<a name="l01540"></a>01540     <span class="keywordflow">for</span> dependee <span class="keywordflow">in</span> matches:
<a name="l01541"></a>01541       <span class="keyword">assert</span> <span class="stringliteral">'${'</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> dependee, <span class="stringliteral">'Nested variables not supported: '</span> + dependee
<a name="l01542"></a>01542     <span class="keywordflow">return</span> matches
<a name="l01543"></a>01543 
<a name="l01544"></a>01544   <span class="keywordflow">try</span>:
<a name="l01545"></a>01545     <span class="comment"># Topologically sort, and then reverse, because we used an edge definition</span>
<a name="l01546"></a>01546     <span class="comment"># that's inverted from the expected result of this function (see comment</span>
<a name="l01547"></a>01547     <span class="comment"># above).</span>
<a name="l01548"></a>01548     order = gyp.common.TopologicallySorted(env.keys(), GetEdges)
<a name="l01549"></a>01549     order.reverse()
<a name="l01550"></a>01550     <span class="keywordflow">return</span> order
<a name="l01551"></a>01551   <span class="keywordflow">except</span> gyp.common.CycleError, e:
<a name="l01552"></a>01552     <span class="keywordflow">raise</span> GypError(
<a name="l01553"></a>01553         <span class="stringliteral">'Xcode environment variables are cyclically dependent: '</span> + str(e.nodes))
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 
<a name="l01556"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#d9e583d7e3f3327c0961400485ba595f">01556</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#d9e583d7e3f3327c0961400485ba595f">GetSortedXcodeEnv</a>(xcode_settings, built_products_dir, srcroot,
<a name="l01557"></a>01557                       configuration, additional_settings=<span class="keywordtype">None</span>):
<a name="l01558"></a>01558   env = _GetXcodeEnv(xcode_settings, built_products_dir, srcroot, configuration,
<a name="l01559"></a>01559                     additional_settings)
<a name="l01560"></a>01560   <span class="keywordflow">return</span> [(key, env[key]) <span class="keywordflow">for</span> key <span class="keywordflow">in</span> _TopologicallySortedEnvVarKeys(env)]
<a name="l01561"></a>01561 
<a name="l01562"></a>01562 
<a name="l01563"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#dc7a43ecaf7c2a76953254041814b36b">01563</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#dc7a43ecaf7c2a76953254041814b36b">GetSpecPostbuildCommands</a>(spec, quiet=False):
<a name="l01564"></a>01564   <span class="stringliteral">"""Returns the list of postbuilds explicitly defined on |spec|, in a form</span>
<a name="l01565"></a>01565 <span class="stringliteral">  executable by a shell."""</span>
<a name="l01566"></a>01566   postbuilds = []
<a name="l01567"></a>01567   <span class="keywordflow">for</span> postbuild <span class="keywordflow">in</span> spec.get(<span class="stringliteral">'postbuilds'</span>, []):
<a name="l01568"></a>01568     <span class="keywordflow">if</span> <span class="keywordflow">not</span> quiet:
<a name="l01569"></a>01569       postbuilds.append(<span class="stringliteral">'echo POSTBUILD\\(%s\\) %s'</span> % (
<a name="l01570"></a>01570             spec[<span class="stringliteral">'target_name'</span>], postbuild[<span class="stringliteral">'postbuild_name'</span>]))
<a name="l01571"></a>01571     postbuilds.append(gyp.common.EncodePOSIXShellList(postbuild[<span class="stringliteral">'action'</span>]))
<a name="l01572"></a>01572   <span class="keywordflow">return</span> postbuilds
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 
<a name="l01575"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#05e0c44898e11700d23b430b27166f1f">01575</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#05e0c44898e11700d23b430b27166f1f">_HasIOSTarget</a>(targets):
<a name="l01576"></a>01576   <span class="stringliteral">"""Returns true if any target contains the iOS specific key</span>
<a name="l01577"></a>01577 <span class="stringliteral">  IPHONEOS_DEPLOYMENT_TARGET."""</span>
<a name="l01578"></a>01578   <span class="keywordflow">for</span> target_dict <span class="keywordflow">in</span> targets.values():
<a name="l01579"></a>01579     <span class="keywordflow">for</span> config <span class="keywordflow">in</span> target_dict[<span class="stringliteral">'configurations'</span>].values():
<a name="l01580"></a>01580       <span class="keywordflow">if</span> config.get(<span class="stringliteral">'xcode_settings'</span>, {}).get(<span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span>):
<a name="l01581"></a>01581         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01582"></a>01582   <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01583"></a>01583 
<a name="l01584"></a>01584 
<a name="l01585"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#576269cb8fa072f9181eeb16f0e0b946">01585</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#576269cb8fa072f9181eeb16f0e0b946">_AddIOSDeviceConfigurations</a>(targets):
<a name="l01586"></a>01586   <span class="stringliteral">"""Clone all targets and append -iphoneos to the name. Configure these targets</span>
<a name="l01587"></a>01587 <span class="stringliteral">  to build for iOS devices and use correct architectures for those builds."""</span>
<a name="l01588"></a>01588   <span class="keywordflow">for</span> target_dict <span class="keywordflow">in</span> targets.itervalues():
<a name="l01589"></a>01589     toolset = target_dict[<span class="stringliteral">'toolset'</span>]
<a name="l01590"></a>01590     configs = target_dict[<span class="stringliteral">'configurations'</span>]
<a name="l01591"></a>01591     <span class="keywordflow">for</span> config_name, config_dict <span class="keywordflow">in</span> dict(configs).iteritems():
<a name="l01592"></a>01592       iphoneos_config_dict = copy.deepcopy(config_dict)
<a name="l01593"></a>01593       configs[config_name + <span class="stringliteral">'-iphoneos'</span>] = iphoneos_config_dict
<a name="l01594"></a>01594       configs[config_name + <span class="stringliteral">'-iphonesimulator'</span>] = config_dict
<a name="l01595"></a>01595       <span class="keywordflow">if</span> toolset == <span class="stringliteral">'target'</span>:
<a name="l01596"></a>01596         iphoneos_config_dict[<span class="stringliteral">'xcode_settings'</span>][<span class="stringliteral">'SDKROOT'</span>] = <span class="stringliteral">'iphoneos'</span>
<a name="l01597"></a>01597   <span class="keywordflow">return</span> targets
<a name="l01598"></a>01598 
<a name="l01599"></a><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#8d952c0347428ef04c69cdb8b3b5ac08">01599</a> <span class="keyword">def </span><a class="code" href="../../d7/d84/namespacegyp_1_1xcode__emulation.html#8d952c0347428ef04c69cdb8b3b5ac08">CloneConfigurationForDeviceAndEmulator</a>(target_dicts):
<a name="l01600"></a>01600   <span class="stringliteral">"""If |target_dicts| contains any iOS targets, automatically create -iphoneos</span>
<a name="l01601"></a>01601 <span class="stringliteral">  targets for iOS device builds."""</span>
<a name="l01602"></a>01602   <span class="keywordflow">if</span> _HasIOSTarget(target_dicts):
<a name="l01603"></a>01603     <span class="keywordflow">return</span> _AddIOSDeviceConfigurations(target_dicts)
<a name="l01604"></a>01604   <span class="keywordflow">return</span> target_dicts
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 7 19:26:27 2015 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
