<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/mac_tool.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css">
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/pylib/gyp/mac_tool.py</h1><a href="../../d5/d83/mac__tool_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d4/db6/namespacegyp_1_1mac__tool.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="comment"># Copyright (c) 2012 Google Inc. All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"># Use of this source code is governed by a BSD-style license that can be</span>
<a name="l00004"></a>00004 <span class="comment"># found in the LICENSE file.</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="stringliteral">"""Utility functions to perform Xcode-style build steps.</span>
<a name="l00007"></a>00007 <span class="stringliteral"></span>
<a name="l00008"></a>00008 <span class="stringliteral">These functions are executed via gyp-mac-tool when using the Makefile generator.</span>
<a name="l00009"></a>00009 <span class="stringliteral">"""</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="keyword">import</span> fcntl
<a name="l00012"></a>00012 <span class="keyword">import</span> fnmatch
<a name="l00013"></a>00013 <span class="keyword">import</span> glob
<a name="l00014"></a>00014 <span class="keyword">import</span> json
<a name="l00015"></a>00015 <span class="keyword">import</span> os
<a name="l00016"></a>00016 <span class="keyword">import</span> plistlib
<a name="l00017"></a>00017 <span class="keyword">import</span> re
<a name="l00018"></a>00018 <span class="keyword">import</span> shutil
<a name="l00019"></a>00019 <span class="keyword">import</span> string
<a name="l00020"></a>00020 <span class="keyword">import</span> subprocess
<a name="l00021"></a>00021 <span class="keyword">import</span> sys
<a name="l00022"></a>00022 <span class="keyword">import</span> tempfile
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="../../d4/db6/namespacegyp_1_1mac__tool.html#40c7b6b240c40f81a4b6f508cfc4c504">00025</a> <span class="keyword">def </span><a class="code" href="../../d4/db6/namespacegyp_1_1mac__tool.html#40c7b6b240c40f81a4b6f508cfc4c504">main</a>(args):
<a name="l00026"></a>00026   executor = MacTool()
<a name="l00027"></a>00027   exit_code = executor.Dispatch(args)
<a name="l00028"></a>00028   <span class="keywordflow">if</span> exit_code <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00029"></a>00029     sys.exit(exit_code)
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html">00032</a> <span class="keyword">class </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html">MacTool</a>(object):
<a name="l00033"></a>00033   <span class="stringliteral">"""This class performs all the Mac tooling steps. The methods can either be</span>
<a name="l00034"></a>00034 <span class="stringliteral">  executed directly, or dispatched from an argument list."""</span>
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#567d3181d14f81bb7f88064e5f442eb6">00036</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#567d3181d14f81bb7f88064e5f442eb6">Dispatch</a>(self, args):
<a name="l00037"></a>00037     <span class="stringliteral">"""Dispatches a string command to a method."""</span>
<a name="l00038"></a>00038     <span class="keywordflow">if</span> len(args) &lt; 1:
<a name="l00039"></a>00039       <span class="keywordflow">raise</span> Exception(<span class="stringliteral">"Not enough arguments"</span>)
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     method = <span class="stringliteral">"Exec%s"</span> % self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#e62a450587347c540244a28499f67d11">_CommandifyName</a>(args[0])
<a name="l00042"></a>00042     <span class="keywordflow">return</span> getattr(self, method)(*args[1:])
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#e62a450587347c540244a28499f67d11">00044</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#e62a450587347c540244a28499f67d11">_CommandifyName</a>(self, name_string):
<a name="l00045"></a>00045     <span class="stringliteral">"""Transforms a tool name like copy-info-plist to CopyInfoPlist"""</span>
<a name="l00046"></a>00046     <span class="keywordflow">return</span> name_string.title().replace(<span class="stringliteral">'-'</span>, <span class="stringliteral">''</span>)
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#ad66c7b3dc6f5650de5466a8ff7de1d1">00048</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#ad66c7b3dc6f5650de5466a8ff7de1d1">ExecCopyBundleResource</a>(self, source, dest, convert_to_binary):
<a name="l00049"></a>00049     <span class="stringliteral">"""Copies a resource file to the bundle/Resources directory, performing any</span>
<a name="l00050"></a>00050 <span class="stringliteral">    necessary compilation on each resource."""</span>
<a name="l00051"></a>00051     extension = os.path.splitext(source)[1].lower()
<a name="l00052"></a>00052     <span class="keywordflow">if</span> os.path.isdir(source):
<a name="l00053"></a>00053       <span class="comment"># Copy tree.</span>
<a name="l00054"></a>00054       <span class="comment"># TODO(thakis): This copies file attributes like mtime, while the</span>
<a name="l00055"></a>00055       <span class="comment"># single-file branch below doesn't. This should probably be changed to</span>
<a name="l00056"></a>00056       <span class="comment"># be consistent with the single-file branch.</span>
<a name="l00057"></a>00057       <span class="keywordflow">if</span> os.path.exists(dest):
<a name="l00058"></a>00058         shutil.rmtree(dest)
<a name="l00059"></a>00059       shutil.copytree(source, dest)
<a name="l00060"></a>00060     <span class="keywordflow">elif</span> extension == <span class="stringliteral">'.xib'</span>:
<a name="l00061"></a>00061       <span class="keywordflow">return</span> self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#469f287fead9c9e3fbcda8a06fd65f7b">_CopyXIBFile</a>(source, dest)
<a name="l00062"></a>00062     <span class="keywordflow">elif</span> extension == <span class="stringliteral">'.storyboard'</span>:
<a name="l00063"></a>00063       <span class="keywordflow">return</span> self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#469f287fead9c9e3fbcda8a06fd65f7b">_CopyXIBFile</a>(source, dest)
<a name="l00064"></a>00064     <span class="keywordflow">elif</span> extension == <span class="stringliteral">'.strings'</span>:
<a name="l00065"></a>00065       self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#51e22d4d990bad9fb780e6065e712a47">_CopyStringsFile</a>(source, dest, convert_to_binary)
<a name="l00066"></a>00066     <span class="keywordflow">else</span>:
<a name="l00067"></a>00067       shutil.copy(source, dest)
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#469f287fead9c9e3fbcda8a06fd65f7b">00069</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#469f287fead9c9e3fbcda8a06fd65f7b">_CopyXIBFile</a>(self, source, dest):
<a name="l00070"></a>00070     <span class="stringliteral">"""Compiles a XIB file with ibtool into a binary plist in the bundle."""</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment"># ibtool sometimes crashes with relative paths. See crbug.com/314728.</span>
<a name="l00073"></a>00073     base = os.path.dirname(os.path.realpath(__file__))
<a name="l00074"></a>00074     <span class="keywordflow">if</span> os.path.relpath(source):
<a name="l00075"></a>00075       source = os.path.join(base, source)
<a name="l00076"></a>00076     <span class="keywordflow">if</span> os.path.relpath(dest):
<a name="l00077"></a>00077       dest = os.path.join(base, dest)
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     args = [<span class="stringliteral">'xcrun'</span>, <span class="stringliteral">'ibtool'</span>, <span class="stringliteral">'--errors'</span>, <span class="stringliteral">'--warnings'</span>, <span class="stringliteral">'--notices'</span>,
<a name="l00080"></a>00080         <span class="stringliteral">'--output-format'</span>, <span class="stringliteral">'human-readable-text'</span>, <span class="stringliteral">'--compile'</span>, dest, source]
<a name="l00081"></a>00081     ibtool_section_re = re.compile(<span class="stringliteral">r'/\*.*\*/'</span>)
<a name="l00082"></a>00082     ibtool_re = re.compile(<span class="stringliteral">r'.*note:.*is clipping its content'</span>)
<a name="l00083"></a>00083     ibtoolout = subprocess.Popen(args, stdout=subprocess.PIPE)
<a name="l00084"></a>00084     current_section_header = <span class="keywordtype">None</span>
<a name="l00085"></a>00085     <span class="keywordflow">for</span> line <span class="keywordflow">in</span> ibtoolout.stdout:
<a name="l00086"></a>00086       <span class="keywordflow">if</span> ibtool_section_re.match(line):
<a name="l00087"></a>00087         current_section_header = line
<a name="l00088"></a>00088       <span class="keywordflow">elif</span> <span class="keywordflow">not</span> ibtool_re.match(line):
<a name="l00089"></a>00089         <span class="keywordflow">if</span> current_section_header:
<a name="l00090"></a>00090           sys.stdout.write(current_section_header)
<a name="l00091"></a>00091           current_section_header = <span class="keywordtype">None</span>
<a name="l00092"></a>00092         sys.stdout.write(line)
<a name="l00093"></a>00093     <span class="keywordflow">return</span> ibtoolout.returncode
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#6d0688f4425a5293565be84756a6e0c5">00095</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#6d0688f4425a5293565be84756a6e0c5">_ConvertToBinary</a>(self, dest):
<a name="l00096"></a>00096     subprocess.check_call([
<a name="l00097"></a>00097         <span class="stringliteral">'xcrun'</span>, <span class="stringliteral">'plutil'</span>, <span class="stringliteral">'-convert'</span>, <span class="stringliteral">'binary1'</span>, <span class="stringliteral">'-o'</span>, dest, dest])
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#51e22d4d990bad9fb780e6065e712a47">00099</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#51e22d4d990bad9fb780e6065e712a47">_CopyStringsFile</a>(self, source, dest, convert_to_binary):
<a name="l00100"></a>00100     <span class="stringliteral">"""Copies a .strings file using iconv to reconvert the input into UTF-16."""</span>
<a name="l00101"></a>00101     input_code = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#cdfcc65c082fed47e4392c8a3646a541">_DetectInputEncoding</a>(source) <span class="keywordflow">or</span> <span class="stringliteral">"UTF-8"</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <span class="comment"># Xcode's CpyCopyStringsFile / builtin-copyStrings seems to call</span>
<a name="l00104"></a>00104     <span class="comment"># CFPropertyListCreateFromXMLData() behind the scenes; at least it prints</span>
<a name="l00105"></a>00105     <span class="comment">#     CFPropertyListCreateFromXMLData(): Old-style plist parser: missing</span>
<a name="l00106"></a>00106     <span class="comment">#     semicolon in dictionary.</span>
<a name="l00107"></a>00107     <span class="comment"># on invalid files. Do the same kind of validation.</span>
<a name="l00108"></a>00108     <span class="keyword">import</span> CoreFoundation
<a name="l00109"></a>00109     s = open(source, <span class="stringliteral">'rb'</span>).read()
<a name="l00110"></a>00110     d = CoreFoundation.CFDataCreate(<span class="keywordtype">None</span>, s, len(s))
<a name="l00111"></a>00111     _, error = CoreFoundation.CFPropertyListCreateFromXMLData(<span class="keywordtype">None</span>, d, 0, <span class="keywordtype">None</span>)
<a name="l00112"></a>00112     <span class="keywordflow">if</span> error:
<a name="l00113"></a>00113       <span class="keywordflow">return</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     fp = open(dest, <span class="stringliteral">'wb'</span>)
<a name="l00116"></a>00116     fp.write(s.decode(input_code).encode(<span class="stringliteral">'UTF-16'</span>))
<a name="l00117"></a>00117     fp.close()
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="keywordflow">if</span> convert_to_binary == <span class="stringliteral">'True'</span>:
<a name="l00120"></a>00120       self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#6d0688f4425a5293565be84756a6e0c5">_ConvertToBinary</a>(dest)
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#cdfcc65c082fed47e4392c8a3646a541">00122</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#cdfcc65c082fed47e4392c8a3646a541">_DetectInputEncoding</a>(self, file_name):
<a name="l00123"></a>00123     <span class="stringliteral">"""Reads the first few bytes from file_name and tries to guess the text</span>
<a name="l00124"></a>00124 <span class="stringliteral">    encoding. Returns None as a guess if it can't detect it."""</span>
<a name="l00125"></a>00125     fp = open(file_name, <span class="stringliteral">'rb'</span>)
<a name="l00126"></a>00126     <span class="keywordflow">try</span>:
<a name="l00127"></a>00127       header = fp.read(3)
<a name="l00128"></a>00128     <span class="keywordflow">except</span> e:
<a name="l00129"></a>00129       fp.close()
<a name="l00130"></a>00130       <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00131"></a>00131     fp.close()
<a name="l00132"></a>00132     <span class="keywordflow">if</span> header.startswith(<span class="stringliteral">"\xFE\xFF"</span>):
<a name="l00133"></a>00133       <span class="keywordflow">return</span> <span class="stringliteral">"UTF-16"</span>
<a name="l00134"></a>00134     <span class="keywordflow">elif</span> header.startswith(<span class="stringliteral">"\xFF\xFE"</span>):
<a name="l00135"></a>00135       <span class="keywordflow">return</span> <span class="stringliteral">"UTF-16"</span>
<a name="l00136"></a>00136     <span class="keywordflow">elif</span> header.startswith(<span class="stringliteral">"\xEF\xBB\xBF"</span>):
<a name="l00137"></a>00137       <span class="keywordflow">return</span> <span class="stringliteral">"UTF-8"</span>
<a name="l00138"></a>00138     <span class="keywordflow">else</span>:
<a name="l00139"></a>00139       <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#b84179d2bddcaa4951ab68da5182664e">00141</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#b84179d2bddcaa4951ab68da5182664e">ExecCopyInfoPlist</a>(self, source, dest, convert_to_binary, *keys):
<a name="l00142"></a>00142     <span class="stringliteral">"""Copies the |source| Info.plist to the destination directory |dest|."""</span>
<a name="l00143"></a>00143     <span class="comment"># Read the source Info.plist into memory.</span>
<a name="l00144"></a>00144     fd = open(source, <span class="stringliteral">'</span><span class="stringliteral">r')</span>
<a name="l00145"></a>00145 <span class="stringliteral">    lines = fd.read()</span>
<a name="l00146"></a>00146 <span class="stringliteral">    fd.close()</span>
<a name="l00147"></a>00147 <span class="stringliteral"></span>
<a name="l00148"></a>00148 <span class="stringliteral">    </span><span class="comment"># Insert synthesized key/value pairs (e.g. BuildMachineOSBuild).</span>
<a name="l00149"></a>00149     plist = plistlib.readPlistFromString(lines)
<a name="l00150"></a>00150     <span class="keywordflow">if</span> keys:
<a name="l00151"></a>00151       plist = dict(plist.items() + json.loads(keys[0]).items())
<a name="l00152"></a>00152     lines = plistlib.writePlistToString(plist)
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="comment"># Go through all the environment variables and replace them as variables in</span>
<a name="l00155"></a>00155     <span class="comment"># the file.</span>
<a name="l00156"></a>00156     IDENT_RE = re.compile(<span class="stringliteral">r'[/\s]'</span>)
<a name="l00157"></a>00157     <span class="keywordflow">for</span> key <span class="keywordflow">in</span> os.environ:
<a name="l00158"></a>00158       <span class="keywordflow">if</span> key.startswith(<span class="stringliteral">'_'</span>):
<a name="l00159"></a>00159         <span class="keywordflow">continue</span>
<a name="l00160"></a>00160       evar = <span class="stringliteral">'${%s}'</span> % key
<a name="l00161"></a>00161       evalue = os.environ[key]
<a name="l00162"></a>00162       lines = string.replace(lines, evar, evalue)
<a name="l00163"></a>00163 
<a name="l00164"></a>00164       <span class="comment"># Xcode supports various suffices on environment variables, which are</span>
<a name="l00165"></a>00165       <span class="comment"># all undocumented. :rfc1034identifier is used in the standard project</span>
<a name="l00166"></a>00166       <span class="comment"># template these days, and :identifier was used earlier. They are used to</span>
<a name="l00167"></a>00167       <span class="comment"># convert non-url characters into things that look like valid urls --</span>
<a name="l00168"></a>00168       <span class="comment"># except that the replacement character for :identifier, '_' isn't valid</span>
<a name="l00169"></a>00169       <span class="comment"># in a URL either -- oops, hence :rfc1034identifier was born.</span>
<a name="l00170"></a>00170       evar = <span class="stringliteral">'${%s:identifier}'</span> % key
<a name="l00171"></a>00171       evalue = IDENT_RE.sub(<span class="stringliteral">'_'</span>, os.environ[key])
<a name="l00172"></a>00172       lines = string.replace(lines, evar, evalue)
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       evar = <span class="stringliteral">'${%s:rfc1034identifier}'</span> % key
<a name="l00175"></a>00175       evalue = IDENT_RE.sub(<span class="stringliteral">'-'</span>, os.environ[key])
<a name="l00176"></a>00176       lines = string.replace(lines, evar, evalue)
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="comment"># Remove any keys with values that haven't been replaced.</span>
<a name="l00179"></a>00179     lines = lines.split(<span class="stringliteral">'\n'</span>)
<a name="l00180"></a>00180     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(lines)):
<a name="l00181"></a>00181       <span class="keywordflow">if</span> lines[i].strip().startswith(<span class="stringliteral">"&lt;string&gt;${"</span>):
<a name="l00182"></a>00182         lines[i] = <span class="keywordtype">None</span>
<a name="l00183"></a>00183         lines[i - 1] = <span class="keywordtype">None</span>
<a name="l00184"></a>00184     lines = <span class="stringliteral">'\n'</span>.join(filter(<span class="keyword">lambda</span> x: x <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, lines))
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="comment"># Write out the file with variables replaced.</span>
<a name="l00187"></a>00187     fd = open(dest, <span class="stringliteral">'w'</span>)
<a name="l00188"></a>00188     fd.write(lines)
<a name="l00189"></a>00189     fd.close()
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment"># Now write out PkgInfo file now that the Info.plist file has been</span>
<a name="l00192"></a>00192     <span class="comment"># "compiled".</span>
<a name="l00193"></a>00193     self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#32b719c0e64953dcc7f3a3019373b26b">_WritePkgInfo</a>(dest)
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">if</span> convert_to_binary == <span class="stringliteral">'True'</span>:
<a name="l00196"></a>00196       self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#6d0688f4425a5293565be84756a6e0c5">_ConvertToBinary</a>(dest)
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#32b719c0e64953dcc7f3a3019373b26b">00198</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#32b719c0e64953dcc7f3a3019373b26b">_WritePkgInfo</a>(self, info_plist):
<a name="l00199"></a>00199     <span class="stringliteral">"""This writes the PkgInfo file from the data stored in Info.plist."""</span>
<a name="l00200"></a>00200     plist = plistlib.readPlist(info_plist)
<a name="l00201"></a>00201     <span class="keywordflow">if</span> <span class="keywordflow">not</span> plist:
<a name="l00202"></a>00202       <span class="keywordflow">return</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="comment"># Only create PkgInfo for executable types.</span>
<a name="l00205"></a>00205     package_type = plist[<span class="stringliteral">'CFBundlePackageType'</span>]
<a name="l00206"></a>00206     <span class="keywordflow">if</span> package_type != <span class="stringliteral">'APPL'</span>:
<a name="l00207"></a>00207       <span class="keywordflow">return</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="comment"># The format of PkgInfo is eight characters, representing the bundle type</span>
<a name="l00210"></a>00210     <span class="comment"># and bundle signature, each four characters. If that is missing, four</span>
<a name="l00211"></a>00211     <span class="comment"># '?' characters are used instead.</span>
<a name="l00212"></a>00212     signature_code = plist.get(<span class="stringliteral">'CFBundleSignature'</span>, <span class="stringliteral">'????'</span>)
<a name="l00213"></a>00213     <span class="keywordflow">if</span> len(signature_code) != 4:  <span class="comment"># Wrong length resets everything, too.</span>
<a name="l00214"></a>00214       signature_code = <span class="stringliteral">'?'</span> * 4
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     dest = os.path.join(os.path.dirname(info_plist), <span class="stringliteral">'PkgInfo'</span>)
<a name="l00217"></a>00217     fp = open(dest, <span class="stringliteral">'w'</span>)
<a name="l00218"></a>00218     fp.write(<span class="stringliteral">'%s%s'</span> % (package_type, signature_code))
<a name="l00219"></a>00219     fp.close()
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#237a166f98aa6c2d3a9c74c2f4a9fe8a">00221</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#237a166f98aa6c2d3a9c74c2f4a9fe8a">ExecFlock</a>(self, lockfile, *cmd_list):
<a name="l00222"></a>00222     <span class="stringliteral">"""Emulates the most basic behavior of Linux's flock(1)."""</span>
<a name="l00223"></a>00223     <span class="comment"># Rely on exception handling to report errors.</span>
<a name="l00224"></a>00224     fd = os.open(lockfile, os.O_RDONLY|os.O_NOCTTY|os.O_CREAT, 0o666)
<a name="l00225"></a>00225     fcntl.flock(fd, fcntl.LOCK_EX)
<a name="l00226"></a>00226     <span class="keywordflow">return</span> subprocess.call(cmd_list)
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#ca4919e2d6b220829eea816f4e38261b">00228</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#ca4919e2d6b220829eea816f4e38261b">ExecFilterLibtool</a>(self, *cmd_list):
<a name="l00229"></a>00229     <span class="stringliteral">"""Calls libtool and filters out '/path/to/libtool: file: foo.o has no</span>
<a name="l00230"></a>00230 <span class="stringliteral">    symbols'."""</span>
<a name="l00231"></a>00231     libtool_re = re.compile(<span class="stringliteral">r'^.*libtool: file: .* has no symbols$'</span>)
<a name="l00232"></a>00232     libtool_re5 = re.compile(
<a name="l00233"></a>00233         <span class="stringliteral">r'^.*libtool: warning for library: '</span> +
<a name="l00234"></a>00234         <span class="stringliteral">r'.* the table of contents is empty '</span> +
<a name="l00235"></a>00235         <span class="stringliteral">r'\(no object file members in the library define global symbols\)$'</span>)
<a name="l00236"></a>00236     env = os.environ.copy()
<a name="l00237"></a>00237     <span class="comment"># Ref:</span>
<a name="l00238"></a>00238     <span class="comment"># http://www.opensource.apple.com/source/cctools/cctools-809/misc/libtool.c</span>
<a name="l00239"></a>00239     <span class="comment"># The problem with this flag is that it resets the file mtime on the file to</span>
<a name="l00240"></a>00240     <span class="comment"># epoch=0, e.g. 1970-1-1 or 1969-12-31 depending on timezone.</span>
<a name="l00241"></a>00241     env[<span class="stringliteral">'ZERO_AR_DATE'</span>] = <span class="stringliteral">'1'</span>
<a name="l00242"></a>00242     libtoolout = subprocess.Popen(cmd_list, stderr=subprocess.PIPE, env=env)
<a name="l00243"></a>00243     _, err = libtoolout.communicate()
<a name="l00244"></a>00244     <span class="keywordflow">for</span> line <span class="keywordflow">in</span> err.splitlines():
<a name="l00245"></a>00245       <span class="keywordflow">if</span> <span class="keywordflow">not</span> libtool_re.match(line) <span class="keywordflow">and</span> <span class="keywordflow">not</span> libtool_re5.match(line):
<a name="l00246"></a>00246         <span class="keywordflow">print</span> &gt;&gt;sys.stderr, line
<a name="l00247"></a>00247     <span class="comment"># Unconditionally touch the output .a file on the command line if present</span>
<a name="l00248"></a>00248     <span class="comment"># and the command succeeded. A bit hacky.</span>
<a name="l00249"></a>00249     <span class="keywordflow">if</span> <span class="keywordflow">not</span> libtoolout.returncode:
<a name="l00250"></a>00250       <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(cmd_list) - 1):
<a name="l00251"></a>00251         <span class="keywordflow">if</span> cmd_list[i] == <span class="stringliteral">"-o"</span> <span class="keywordflow">and</span> cmd_list[i+1].endswith(<span class="stringliteral">'.a'</span>):
<a name="l00252"></a>00252           os.utime(cmd_list[i+1], <span class="keywordtype">None</span>)
<a name="l00253"></a>00253           <span class="keywordflow">break</span>
<a name="l00254"></a>00254     <span class="keywordflow">return</span> libtoolout.returncode
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4f9503bf835e023afea0ee54c58cdff8">00256</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4f9503bf835e023afea0ee54c58cdff8">ExecPackageFramework</a>(self, framework, version):
<a name="l00257"></a>00257     <span class="stringliteral">"""Takes a path to Something.framework and the Current version of that and</span>
<a name="l00258"></a>00258 <span class="stringliteral">    sets up all the symlinks."""</span>
<a name="l00259"></a>00259     <span class="comment"># Find the name of the binary based on the part before the ".framework".</span>
<a name="l00260"></a>00260     binary = os.path.basename(framework).split(<span class="stringliteral">'.'</span>)[0]
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     CURRENT = <span class="stringliteral">'Current'</span>
<a name="l00263"></a>00263     RESOURCES = <span class="stringliteral">'Resources'</span>
<a name="l00264"></a>00264     VERSIONS = <span class="stringliteral">'Versions'</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(os.path.join(framework, VERSIONS, version, binary)):
<a name="l00267"></a>00267       <span class="comment"># Binary-less frameworks don't seem to contain symlinks (see e.g.</span>
<a name="l00268"></a>00268       <span class="comment"># chromium's out/Debug/org.chromium.Chromium.manifest/ bundle).</span>
<a name="l00269"></a>00269       <span class="keywordflow">return</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="comment"># Move into the framework directory to set the symlinks correctly.</span>
<a name="l00272"></a>00272     pwd = os.getcwd()
<a name="l00273"></a>00273     os.chdir(framework)
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment"># Set up the Current version.</span>
<a name="l00276"></a>00276     self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#8c749aeba52e24540c7a6e46db023dd3">_Relink</a>(version, os.path.join(VERSIONS, CURRENT))
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="comment"># Set up the root symlinks.</span>
<a name="l00279"></a>00279     self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#8c749aeba52e24540c7a6e46db023dd3">_Relink</a>(os.path.join(VERSIONS, CURRENT, binary), binary)
<a name="l00280"></a>00280     self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#8c749aeba52e24540c7a6e46db023dd3">_Relink</a>(os.path.join(VERSIONS, CURRENT, RESOURCES), RESOURCES)
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="comment"># Back to where we were before!</span>
<a name="l00283"></a>00283     os.chdir(pwd)
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#8c749aeba52e24540c7a6e46db023dd3">00285</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#8c749aeba52e24540c7a6e46db023dd3">_Relink</a>(self, dest, link):
<a name="l00286"></a>00286     <span class="stringliteral">"""Creates a symlink to |dest| named |link|. If |link| already exists,</span>
<a name="l00287"></a>00287 <span class="stringliteral">    it is overwritten."""</span>
<a name="l00288"></a>00288     <span class="keywordflow">if</span> os.path.lexists(link):
<a name="l00289"></a>00289       os.remove(link)
<a name="l00290"></a>00290     os.symlink(dest, link)
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#84842c9284ad30614eb4f911f7a754ac">00292</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#84842c9284ad30614eb4f911f7a754ac">ExecCompileXcassets</a>(self, keys, *inputs):
<a name="l00293"></a>00293     <span class="stringliteral">"""Compiles multiple .xcassets files into a single .car file.</span>
<a name="l00294"></a>00294 <span class="stringliteral"></span>
<a name="l00295"></a>00295 <span class="stringliteral">    This invokes 'actool' to compile all the inputs .xcassets files. The</span>
<a name="l00296"></a>00296 <span class="stringliteral">    |keys| arguments is a json-encoded dictionary of extra arguments to</span>
<a name="l00297"></a>00297 <span class="stringliteral">    pass to 'actool' when the asset catalogs contains an application icon</span>
<a name="l00298"></a>00298 <span class="stringliteral">    or a launch image.</span>
<a name="l00299"></a>00299 <span class="stringliteral"></span>
<a name="l00300"></a>00300 <span class="stringliteral">    Note that 'actool' does not create the Assets.car file if the asset</span>
<a name="l00301"></a>00301 <span class="stringliteral">    catalogs does not contains imageset.</span>
<a name="l00302"></a>00302 <span class="stringliteral">    """</span>
<a name="l00303"></a>00303     command_line = [
<a name="l00304"></a>00304       <span class="stringliteral">'xcrun'</span>, <span class="stringliteral">'actool'</span>, <span class="stringliteral">'--output-format'</span>, <span class="stringliteral">'human-readable-text'</span>,
<a name="l00305"></a>00305       <span class="stringliteral">'--compress-pngs'</span>, <span class="stringliteral">'--notices'</span>, <span class="stringliteral">'--warnings'</span>, <span class="stringliteral">'--errors'</span>,
<a name="l00306"></a>00306     ]
<a name="l00307"></a>00307     is_iphone_target = <span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span> <span class="keywordflow">in</span> os.environ
<a name="l00308"></a>00308     <span class="keywordflow">if</span> is_iphone_target:
<a name="l00309"></a>00309       platform = os.environ[<span class="stringliteral">'CONFIGURATION'</span>].split(<span class="stringliteral">'-'</span>)[-1]
<a name="l00310"></a>00310       <span class="keywordflow">if</span> platform <span class="keywordflow">not</span> <span class="keywordflow">in</span> (<span class="stringliteral">'iphoneos'</span>, <span class="stringliteral">'iphonesimulator'</span>):
<a name="l00311"></a>00311         platform = <span class="stringliteral">'iphonesimulator'</span>
<a name="l00312"></a>00312       command_line.extend([
<a name="l00313"></a>00313           <span class="stringliteral">'--platform'</span>, platform, <span class="stringliteral">'--target-device'</span>, <span class="stringliteral">'iphone'</span>,
<a name="l00314"></a>00314           <span class="stringliteral">'--target-device'</span>, <span class="stringliteral">'ipad'</span>, <span class="stringliteral">'--minimum-deployment-target'</span>,
<a name="l00315"></a>00315           os.environ[<span class="stringliteral">'IPHONEOS_DEPLOYMENT_TARGET'</span>], <span class="stringliteral">'--compile'</span>,
<a name="l00316"></a>00316           os.path.abspath(os.environ[<span class="stringliteral">'CONTENTS_FOLDER_PATH'</span>]),
<a name="l00317"></a>00317       ])
<a name="l00318"></a>00318     <span class="keywordflow">else</span>:
<a name="l00319"></a>00319       command_line.extend([
<a name="l00320"></a>00320           <span class="stringliteral">'--platform'</span>, <span class="stringliteral">'macosx'</span>, <span class="stringliteral">'--target-device'</span>, <span class="stringliteral">'mac'</span>,
<a name="l00321"></a>00321           <span class="stringliteral">'--minimum-deployment-target'</span>, os.environ[<span class="stringliteral">'MACOSX_DEPLOYMENT_TARGET'</span>],
<a name="l00322"></a>00322           <span class="stringliteral">'--compile'</span>,
<a name="l00323"></a>00323           os.path.abspath(os.environ[<span class="stringliteral">'UNLOCALIZED_RESOURCES_FOLDER_PATH'</span>]),
<a name="l00324"></a>00324       ])
<a name="l00325"></a>00325     <span class="keywordflow">if</span> keys:
<a name="l00326"></a>00326       keys = json.loads(keys)
<a name="l00327"></a>00327       <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> keys.iteritems():
<a name="l00328"></a>00328         arg_name = <span class="stringliteral">'--'</span> + key
<a name="l00329"></a>00329         <span class="keywordflow">if</span> isinstance(value, bool):
<a name="l00330"></a>00330           <span class="keywordflow">if</span> value:
<a name="l00331"></a>00331             command_line.append(arg_name)
<a name="l00332"></a>00332         <span class="keywordflow">elif</span> isinstance(value, list):
<a name="l00333"></a>00333           <span class="keywordflow">for</span> v <span class="keywordflow">in</span> value:
<a name="l00334"></a>00334             command_line.append(arg_name)
<a name="l00335"></a>00335             command_line.append(str(v))
<a name="l00336"></a>00336         <span class="keywordflow">else</span>:
<a name="l00337"></a>00337           command_line.append(arg_name)
<a name="l00338"></a>00338           command_line.append(str(value))
<a name="l00339"></a>00339     <span class="comment"># Note: actool crashes if inputs path are relative, so use os.path.abspath</span>
<a name="l00340"></a>00340     <span class="comment"># to get absolute path name for inputs.</span>
<a name="l00341"></a>00341     command_line.extend(map(os.path.abspath, inputs))
<a name="l00342"></a>00342     subprocess.check_call(command_line)
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#b4d706cdeb84d3156ecf43d9ee6dc2fe">00344</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#b4d706cdeb84d3156ecf43d9ee6dc2fe">ExecMergeInfoPlist</a>(self, output, *inputs):
<a name="l00345"></a>00345     <span class="stringliteral">"""Merge multiple .plist files into a single .plist file."""</span>
<a name="l00346"></a>00346     merged_plist = {}
<a name="l00347"></a>00347     <span class="keywordflow">for</span> path <span class="keywordflow">in</span> inputs:
<a name="l00348"></a>00348       plist = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">_LoadPlistMaybeBinary</a>(path)
<a name="l00349"></a>00349       self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#3e5ebf0263c12ca5d94b3a55be77d781">_MergePlist</a>(merged_plist, plist)
<a name="l00350"></a>00350     plistlib.writePlist(merged_plist, output)
<a name="l00351"></a>00351 
<a name="l00352"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#9098ba2a9597c5d9b451f0fad06285d5">00352</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#9098ba2a9597c5d9b451f0fad06285d5">ExecCodeSignBundle</a>(self, key, resource_rules, entitlements, provisioning):
<a name="l00353"></a>00353     <span class="stringliteral">"""Code sign a bundle.</span>
<a name="l00354"></a>00354 <span class="stringliteral"></span>
<a name="l00355"></a>00355 <span class="stringliteral">    This function tries to code sign an iOS bundle, following the same</span>
<a name="l00356"></a>00356 <span class="stringliteral">    algorithm as Xcode:</span>
<a name="l00357"></a>00357 <span class="stringliteral">      1. copy ResourceRules.plist from the user or the SDK into the bundle,</span>
<a name="l00358"></a>00358 <span class="stringliteral">      2. pick the provisioning profile that best match the bundle identifier,</span>
<a name="l00359"></a>00359 <span class="stringliteral">         and copy it into the bundle as embedded.mobileprovision,</span>
<a name="l00360"></a>00360 <span class="stringliteral">      3. copy Entitlements.plist from user or SDK next to the bundle,</span>
<a name="l00361"></a>00361 <span class="stringliteral">      4. code sign the bundle.</span>
<a name="l00362"></a>00362 <span class="stringliteral">    """</span>
<a name="l00363"></a>00363     resource_rules_path = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4df10bcf872d754e55a735ed8e75900c">_InstallResourceRules</a>(resource_rules)
<a name="l00364"></a>00364     substitutions, overrides = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#243bedefa22bf5ea6bc89a580338f8e3">_InstallProvisioningProfile</a>(
<a name="l00365"></a>00365         provisioning, self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#15a593190abc9b1dd7957fee169d54db">_GetCFBundleIdentifier</a>())
<a name="l00366"></a>00366     entitlements_path = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#37e2718dca267973a844c9125452bc6c">_InstallEntitlements</a>(
<a name="l00367"></a>00367         entitlements, substitutions, overrides)
<a name="l00368"></a>00368     subprocess.check_call([
<a name="l00369"></a>00369         <span class="stringliteral">'codesign'</span>, <span class="stringliteral">'--force'</span>, <span class="stringliteral">'--sign'</span>, key, <span class="stringliteral">'--resource-rules'</span>,
<a name="l00370"></a>00370         resource_rules_path, <span class="stringliteral">'--entitlements'</span>, entitlements_path,
<a name="l00371"></a>00371         os.path.join(
<a name="l00372"></a>00372             os.environ[<span class="stringliteral">'TARGET_BUILD_DIR'</span>],
<a name="l00373"></a>00373             os.environ[<span class="stringliteral">'FULL_PRODUCT_NAME'</span>])])
<a name="l00374"></a>00374 
<a name="l00375"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4df10bcf872d754e55a735ed8e75900c">00375</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4df10bcf872d754e55a735ed8e75900c">_InstallResourceRules</a>(self, resource_rules):
<a name="l00376"></a>00376     <span class="stringliteral">"""Installs ResourceRules.plist from user or SDK into the bundle.</span>
<a name="l00377"></a>00377 <span class="stringliteral"></span>
<a name="l00378"></a>00378 <span class="stringliteral">    Args:</span>
<a name="l00379"></a>00379 <span class="stringliteral">      resource_rules: string, optional, path to the ResourceRules.plist file</span>
<a name="l00380"></a>00380 <span class="stringliteral">        to use, default to "${SDKROOT}/ResourceRules.plist"</span>
<a name="l00381"></a>00381 <span class="stringliteral"></span>
<a name="l00382"></a>00382 <span class="stringliteral">    Returns:</span>
<a name="l00383"></a>00383 <span class="stringliteral">      Path to the copy of ResourceRules.plist into the bundle.</span>
<a name="l00384"></a>00384 <span class="stringliteral">    """</span>
<a name="l00385"></a>00385     source_path = resource_rules
<a name="l00386"></a>00386     target_path = os.path.join(
<a name="l00387"></a>00387         os.environ[<span class="stringliteral">'BUILT_PRODUCTS_DIR'</span>],
<a name="l00388"></a>00388         os.environ[<span class="stringliteral">'CONTENTS_FOLDER_PATH'</span>],
<a name="l00389"></a>00389         <span class="stringliteral">'ResourceRules.plist'</span>)
<a name="l00390"></a>00390     <span class="keywordflow">if</span> <span class="keywordflow">not</span> source_path:
<a name="l00391"></a>00391       source_path = os.path.join(
<a name="l00392"></a>00392           os.environ[<span class="stringliteral">'SDKROOT'</span>], <span class="stringliteral">'ResourceRules.plist'</span>)
<a name="l00393"></a>00393     shutil.copy2(source_path, target_path)
<a name="l00394"></a>00394     <span class="keywordflow">return</span> target_path
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#243bedefa22bf5ea6bc89a580338f8e3">00396</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#243bedefa22bf5ea6bc89a580338f8e3">_InstallProvisioningProfile</a>(self, profile, bundle_identifier):
<a name="l00397"></a>00397     <span class="stringliteral">"""Installs embedded.mobileprovision into the bundle.</span>
<a name="l00398"></a>00398 <span class="stringliteral"></span>
<a name="l00399"></a>00399 <span class="stringliteral">    Args:</span>
<a name="l00400"></a>00400 <span class="stringliteral">      profile: string, optional, short name of the .mobileprovision file</span>
<a name="l00401"></a>00401 <span class="stringliteral">        to use, if empty or the file is missing, the best file installed</span>
<a name="l00402"></a>00402 <span class="stringliteral">        will be used</span>
<a name="l00403"></a>00403 <span class="stringliteral">      bundle_identifier: string, value of CFBundleIdentifier from Info.plist</span>
<a name="l00404"></a>00404 <span class="stringliteral"></span>
<a name="l00405"></a>00405 <span class="stringliteral">    Returns:</span>
<a name="l00406"></a>00406 <span class="stringliteral">      A tuple containing two dictionary: variables substitutions and values</span>
<a name="l00407"></a>00407 <span class="stringliteral">      to overrides when generating the entitlements file.</span>
<a name="l00408"></a>00408 <span class="stringliteral">    """</span>
<a name="l00409"></a>00409     source_path, provisioning_data, team_id = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#7779b38a5f4d50721b990887d9465e9a">_FindProvisioningProfile</a>(
<a name="l00410"></a>00410         profile, bundle_identifier)
<a name="l00411"></a>00411     target_path = os.path.join(
<a name="l00412"></a>00412         os.environ[<span class="stringliteral">'BUILT_PRODUCTS_DIR'</span>],
<a name="l00413"></a>00413         os.environ[<span class="stringliteral">'CONTENTS_FOLDER_PATH'</span>],
<a name="l00414"></a>00414         <span class="stringliteral">'embedded.mobileprovision'</span>)
<a name="l00415"></a>00415     shutil.copy2(source_path, target_path)
<a name="l00416"></a>00416     substitutions = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#319fae30d4af9a3b1eb05db387dd7895">_GetSubstitutions</a>(bundle_identifier, team_id + <span class="stringliteral">'.'</span>)
<a name="l00417"></a>00417     <span class="keywordflow">return</span> substitutions, provisioning_data[<span class="stringliteral">'Entitlements'</span>]
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#7779b38a5f4d50721b990887d9465e9a">00419</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#7779b38a5f4d50721b990887d9465e9a">_FindProvisioningProfile</a>(self, profile, bundle_identifier):
<a name="l00420"></a>00420     <span class="stringliteral">"""Finds the .mobileprovision file to use for signing the bundle.</span>
<a name="l00421"></a>00421 <span class="stringliteral"></span>
<a name="l00422"></a>00422 <span class="stringliteral">    Checks all the installed provisioning profiles (or if the user specified</span>
<a name="l00423"></a>00423 <span class="stringliteral">    the PROVISIONING_PROFILE variable, only consult it) and select the most</span>
<a name="l00424"></a>00424 <span class="stringliteral">    specific that correspond to the bundle identifier.</span>
<a name="l00425"></a>00425 <span class="stringliteral"></span>
<a name="l00426"></a>00426 <span class="stringliteral">    Args:</span>
<a name="l00427"></a>00427 <span class="stringliteral">      profile: string, optional, short name of the .mobileprovision file</span>
<a name="l00428"></a>00428 <span class="stringliteral">        to use, if empty or the file is missing, the best file installed</span>
<a name="l00429"></a>00429 <span class="stringliteral">        will be used</span>
<a name="l00430"></a>00430 <span class="stringliteral">      bundle_identifier: string, value of CFBundleIdentifier from Info.plist</span>
<a name="l00431"></a>00431 <span class="stringliteral"></span>
<a name="l00432"></a>00432 <span class="stringliteral">    Returns:</span>
<a name="l00433"></a>00433 <span class="stringliteral">      A tuple of the path to the selected provisioning profile, the data of</span>
<a name="l00434"></a>00434 <span class="stringliteral">      the embedded plist in the provisioning profile and the team identifier</span>
<a name="l00435"></a>00435 <span class="stringliteral">      to use for code signing.</span>
<a name="l00436"></a>00436 <span class="stringliteral"></span>
<a name="l00437"></a>00437 <span class="stringliteral">    Raises:</span>
<a name="l00438"></a>00438 <span class="stringliteral">      SystemExit: if no .mobileprovision can be used to sign the bundle.</span>
<a name="l00439"></a>00439 <span class="stringliteral">    """</span>
<a name="l00440"></a>00440     profiles_dir = os.path.join(
<a name="l00441"></a>00441         os.environ[<span class="stringliteral">'HOME'</span>], <span class="stringliteral">'Library'</span>, <span class="stringliteral">'MobileDevice'</span>, <span class="stringliteral">'Provisioning Profiles'</span>)
<a name="l00442"></a>00442     <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(profiles_dir):
<a name="l00443"></a>00443       <span class="keywordflow">print</span> &gt;&gt;sys.stderr, (
<a name="l00444"></a>00444           <span class="stringliteral">'cannot find mobile provisioning for %s'</span> % bundle_identifier)
<a name="l00445"></a>00445       sys.exit(1)
<a name="l00446"></a>00446     provisioning_profiles = <span class="keywordtype">None</span>
<a name="l00447"></a>00447     <span class="keywordflow">if</span> profile:
<a name="l00448"></a>00448       profile_path = os.path.join(profiles_dir, profile + <span class="stringliteral">'.mobileprovision'</span>)
<a name="l00449"></a>00449       <span class="keywordflow">if</span> os.path.exists(profile_path):
<a name="l00450"></a>00450         provisioning_profiles = [profile_path]
<a name="l00451"></a>00451     <span class="keywordflow">if</span> <span class="keywordflow">not</span> provisioning_profiles:
<a name="l00452"></a>00452       provisioning_profiles = glob.glob(
<a name="l00453"></a>00453           os.path.join(profiles_dir, <span class="stringliteral">'*.mobileprovision'</span>))
<a name="l00454"></a>00454     valid_provisioning_profiles = {}
<a name="l00455"></a>00455     <span class="keywordflow">for</span> profile_path <span class="keywordflow">in</span> provisioning_profiles:
<a name="l00456"></a>00456       profile_data = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#31343bc3c1e417b8b2693ba31df68c8d">_LoadProvisioningProfile</a>(profile_path)
<a name="l00457"></a>00457       app_id_pattern = profile_data.get(
<a name="l00458"></a>00458           <span class="stringliteral">'Entitlements'</span>, {}).get(<span class="stringliteral">'application-identifier'</span>, <span class="stringliteral">''</span>)
<a name="l00459"></a>00459       <span class="keywordflow">for</span> team_identifier <span class="keywordflow">in</span> profile_data.get(<span class="stringliteral">'TeamIdentifier'</span>, []):
<a name="l00460"></a>00460         app_id = <span class="stringliteral">'%s.%s'</span> % (team_identifier, bundle_identifier)
<a name="l00461"></a>00461         <span class="keywordflow">if</span> fnmatch.fnmatch(app_id, app_id_pattern):
<a name="l00462"></a>00462           valid_provisioning_profiles[app_id_pattern] = (
<a name="l00463"></a>00463               profile_path, profile_data, team_identifier)
<a name="l00464"></a>00464     <span class="keywordflow">if</span> <span class="keywordflow">not</span> valid_provisioning_profiles:
<a name="l00465"></a>00465       <span class="keywordflow">print</span> &gt;&gt;sys.stderr, (
<a name="l00466"></a>00466           <span class="stringliteral">'cannot find mobile provisioning for %s'</span> % bundle_identifier)
<a name="l00467"></a>00467       sys.exit(1)
<a name="l00468"></a>00468     <span class="comment"># If the user has multiple provisioning profiles installed that can be</span>
<a name="l00469"></a>00469     <span class="comment"># used for ${bundle_identifier}, pick the most specific one (ie. the</span>
<a name="l00470"></a>00470     <span class="comment"># provisioning profile whose pattern is the longest).</span>
<a name="l00471"></a>00471     selected_key = max(valid_provisioning_profiles, key=<span class="keyword">lambda</span> v: len(v))
<a name="l00472"></a>00472     <span class="keywordflow">return</span> valid_provisioning_profiles[selected_key]
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#31343bc3c1e417b8b2693ba31df68c8d">00474</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#31343bc3c1e417b8b2693ba31df68c8d">_LoadProvisioningProfile</a>(self, profile_path):
<a name="l00475"></a>00475     <span class="stringliteral">"""Extracts the plist embedded in a provisioning profile.</span>
<a name="l00476"></a>00476 <span class="stringliteral"></span>
<a name="l00477"></a>00477 <span class="stringliteral">    Args:</span>
<a name="l00478"></a>00478 <span class="stringliteral">      profile_path: string, path to the .mobileprovision file</span>
<a name="l00479"></a>00479 <span class="stringliteral"></span>
<a name="l00480"></a>00480 <span class="stringliteral">    Returns:</span>
<a name="l00481"></a>00481 <span class="stringliteral">      Content of the plist embedded in the provisioning profile as a dictionary.</span>
<a name="l00482"></a>00482 <span class="stringliteral">    """</span>
<a name="l00483"></a>00483     with tempfile.NamedTemporaryFile() <span class="keyword">as</span> temp:
<a name="l00484"></a>00484       subprocess.check_call([
<a name="l00485"></a>00485           <span class="stringliteral">'security'</span>, <span class="stringliteral">'cms'</span>, <span class="stringliteral">'-D'</span>, <span class="stringliteral">'-i'</span>, profile_path, <span class="stringliteral">'-o'</span>, temp.name])
<a name="l00486"></a>00486       <span class="keywordflow">return</span> self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">_LoadPlistMaybeBinary</a>(temp.name)
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#3e5ebf0263c12ca5d94b3a55be77d781">00488</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#3e5ebf0263c12ca5d94b3a55be77d781">_MergePlist</a>(self, merged_plist, plist):
<a name="l00489"></a>00489     <span class="stringliteral">"""Merge |plist| into |merged_plist|."""</span>
<a name="l00490"></a>00490     <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> plist.iteritems():
<a name="l00491"></a>00491       <span class="keywordflow">if</span> isinstance(value, dict):
<a name="l00492"></a>00492         merged_value = merged_plist.get(key, {})
<a name="l00493"></a>00493         <span class="keywordflow">if</span> isinstance(merged_value, dict):
<a name="l00494"></a>00494           self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#3e5ebf0263c12ca5d94b3a55be77d781">_MergePlist</a>(merged_value, value)
<a name="l00495"></a>00495           merged_plist[key] = merged_value
<a name="l00496"></a>00496         <span class="keywordflow">else</span>:
<a name="l00497"></a>00497           merged_plist[key] = value
<a name="l00498"></a>00498       <span class="keywordflow">else</span>:
<a name="l00499"></a>00499         merged_plist[key] = value
<a name="l00500"></a>00500 
<a name="l00501"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">00501</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">_LoadPlistMaybeBinary</a>(self, plist_path):
<a name="l00502"></a>00502     <span class="stringliteral">"""Loads into a memory a plist possibly encoded in binary format.</span>
<a name="l00503"></a>00503 <span class="stringliteral"></span>
<a name="l00504"></a>00504 <span class="stringliteral">    This is a wrapper around plistlib.readPlist that tries to convert the</span>
<a name="l00505"></a>00505 <span class="stringliteral">    plist to the XML format if it can't be parsed (assuming that it is in</span>
<a name="l00506"></a>00506 <span class="stringliteral">    the binary format).</span>
<a name="l00507"></a>00507 <span class="stringliteral"></span>
<a name="l00508"></a>00508 <span class="stringliteral">    Args:</span>
<a name="l00509"></a>00509 <span class="stringliteral">      plist_path: string, path to a plist file, in XML or binary format</span>
<a name="l00510"></a>00510 <span class="stringliteral"></span>
<a name="l00511"></a>00511 <span class="stringliteral">    Returns:</span>
<a name="l00512"></a>00512 <span class="stringliteral">      Content of the plist as a dictionary.</span>
<a name="l00513"></a>00513 <span class="stringliteral">    """</span>
<a name="l00514"></a>00514     <span class="keywordflow">try</span>:
<a name="l00515"></a>00515       <span class="comment"># First, try to read the file using plistlib that only supports XML,</span>
<a name="l00516"></a>00516       <span class="comment"># and if an exception is raised, convert a temporary copy to XML and</span>
<a name="l00517"></a>00517       <span class="comment"># load that copy.</span>
<a name="l00518"></a>00518       <span class="keywordflow">return</span> plistlib.readPlist(plist_path)
<a name="l00519"></a>00519     <span class="keywordflow">except</span>:
<a name="l00520"></a>00520       <span class="keywordflow">pass</span>
<a name="l00521"></a>00521     with tempfile.NamedTemporaryFile() <span class="keyword">as</span> temp:
<a name="l00522"></a>00522       shutil.copy2(plist_path, temp.name)
<a name="l00523"></a>00523       subprocess.check_call([<span class="stringliteral">'plutil'</span>, <span class="stringliteral">'-convert'</span>, <span class="stringliteral">'xml1'</span>, temp.name])
<a name="l00524"></a>00524       <span class="keywordflow">return</span> plistlib.readPlist(temp.name)
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#319fae30d4af9a3b1eb05db387dd7895">00526</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#319fae30d4af9a3b1eb05db387dd7895">_GetSubstitutions</a>(self, bundle_identifier, app_identifier_prefix):
<a name="l00527"></a>00527     <span class="stringliteral">"""Constructs a dictionary of variable substitutions for Entitlements.plist.</span>
<a name="l00528"></a>00528 <span class="stringliteral"></span>
<a name="l00529"></a>00529 <span class="stringliteral">    Args:</span>
<a name="l00530"></a>00530 <span class="stringliteral">      bundle_identifier: string, value of CFBundleIdentifier from Info.plist</span>
<a name="l00531"></a>00531 <span class="stringliteral">      app_identifier_prefix: string, value for AppIdentifierPrefix</span>
<a name="l00532"></a>00532 <span class="stringliteral"></span>
<a name="l00533"></a>00533 <span class="stringliteral">    Returns:</span>
<a name="l00534"></a>00534 <span class="stringliteral">      Dictionary of substitutions to apply when generating Entitlements.plist.</span>
<a name="l00535"></a>00535 <span class="stringliteral">    """</span>
<a name="l00536"></a>00536     <span class="keywordflow">return</span> {
<a name="l00537"></a>00537       <span class="stringliteral">'CFBundleIdentifier'</span>: bundle_identifier,
<a name="l00538"></a>00538       <span class="stringliteral">'AppIdentifierPrefix'</span>: app_identifier_prefix,
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#15a593190abc9b1dd7957fee169d54db">00541</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#15a593190abc9b1dd7957fee169d54db">_GetCFBundleIdentifier</a>(self):
<a name="l00542"></a>00542     <span class="stringliteral">"""Extracts CFBundleIdentifier value from Info.plist in the bundle.</span>
<a name="l00543"></a>00543 <span class="stringliteral"></span>
<a name="l00544"></a>00544 <span class="stringliteral">    Returns:</span>
<a name="l00545"></a>00545 <span class="stringliteral">      Value of CFBundleIdentifier in the Info.plist located in the bundle.</span>
<a name="l00546"></a>00546 <span class="stringliteral">    """</span>
<a name="l00547"></a>00547     info_plist_path = os.path.join(
<a name="l00548"></a>00548         os.environ[<span class="stringliteral">'TARGET_BUILD_DIR'</span>],
<a name="l00549"></a>00549         os.environ[<span class="stringliteral">'INFOPLIST_PATH'</span>])
<a name="l00550"></a>00550     info_plist_data = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">_LoadPlistMaybeBinary</a>(info_plist_path)
<a name="l00551"></a>00551     <span class="keywordflow">return</span> info_plist_data[<span class="stringliteral">'CFBundleIdentifier'</span>]
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#37e2718dca267973a844c9125452bc6c">00553</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#37e2718dca267973a844c9125452bc6c">_InstallEntitlements</a>(self, entitlements, substitutions, overrides):
<a name="l00554"></a>00554     <span class="stringliteral">"""Generates and install the ${BundleName}.xcent entitlements file.</span>
<a name="l00555"></a>00555 <span class="stringliteral"></span>
<a name="l00556"></a>00556 <span class="stringliteral">    Expands variables "$(variable)" pattern in the source entitlements file,</span>
<a name="l00557"></a>00557 <span class="stringliteral">    add extra entitlements defined in the .mobileprovision file and the copy</span>
<a name="l00558"></a>00558 <span class="stringliteral">    the generated plist to "${BundlePath}.xcent".</span>
<a name="l00559"></a>00559 <span class="stringliteral"></span>
<a name="l00560"></a>00560 <span class="stringliteral">    Args:</span>
<a name="l00561"></a>00561 <span class="stringliteral">      entitlements: string, optional, path to the Entitlements.plist template</span>
<a name="l00562"></a>00562 <span class="stringliteral">        to use, defaults to "${SDKROOT}/Entitlements.plist"</span>
<a name="l00563"></a>00563 <span class="stringliteral">      substitutions: dictionary, variable substitutions</span>
<a name="l00564"></a>00564 <span class="stringliteral">      overrides: dictionary, values to add to the entitlements</span>
<a name="l00565"></a>00565 <span class="stringliteral"></span>
<a name="l00566"></a>00566 <span class="stringliteral">    Returns:</span>
<a name="l00567"></a>00567 <span class="stringliteral">      Path to the generated entitlements file.</span>
<a name="l00568"></a>00568 <span class="stringliteral">    """</span>
<a name="l00569"></a>00569     source_path = entitlements
<a name="l00570"></a>00570     target_path = os.path.join(
<a name="l00571"></a>00571         os.environ[<span class="stringliteral">'BUILT_PRODUCTS_DIR'</span>],
<a name="l00572"></a>00572         os.environ[<span class="stringliteral">'PRODUCT_NAME'</span>] + <span class="stringliteral">'.xcent'</span>)
<a name="l00573"></a>00573     <span class="keywordflow">if</span> <span class="keywordflow">not</span> source_path:
<a name="l00574"></a>00574       source_path = os.path.join(
<a name="l00575"></a>00575           os.environ[<span class="stringliteral">'SDKROOT'</span>],
<a name="l00576"></a>00576           <span class="stringliteral">'Entitlements.plist'</span>)
<a name="l00577"></a>00577     shutil.copy2(source_path, target_path)
<a name="l00578"></a>00578     data = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#98af7419cfbcf0dd194ed08fe7f89f6d">_LoadPlistMaybeBinary</a>(target_path)
<a name="l00579"></a>00579     data = self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4a84c4dc731cf5ad9c15530522a4e340">_ExpandVariables</a>(data, substitutions)
<a name="l00580"></a>00580     <span class="keywordflow">if</span> overrides:
<a name="l00581"></a>00581       <span class="keywordflow">for</span> key <span class="keywordflow">in</span> overrides:
<a name="l00582"></a>00582         <span class="keywordflow">if</span> key <span class="keywordflow">not</span> <span class="keywordflow">in</span> data:
<a name="l00583"></a>00583           data[key] = overrides[key]
<a name="l00584"></a>00584     plistlib.writePlist(data, target_path)
<a name="l00585"></a>00585     <span class="keywordflow">return</span> target_path
<a name="l00586"></a>00586 
<a name="l00587"></a><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4a84c4dc731cf5ad9c15530522a4e340">00587</a>   <span class="keyword">def </span><a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4a84c4dc731cf5ad9c15530522a4e340">_ExpandVariables</a>(self, data, substitutions):
<a name="l00588"></a>00588     <span class="stringliteral">"""Expands variables "$(variable)" in data.</span>
<a name="l00589"></a>00589 <span class="stringliteral"></span>
<a name="l00590"></a>00590 <span class="stringliteral">    Args:</span>
<a name="l00591"></a>00591 <span class="stringliteral">      data: object, can be either string, list or dictionary</span>
<a name="l00592"></a>00592 <span class="stringliteral">      substitutions: dictionary, variable substitutions to perform</span>
<a name="l00593"></a>00593 <span class="stringliteral"></span>
<a name="l00594"></a>00594 <span class="stringliteral">    Returns:</span>
<a name="l00595"></a>00595 <span class="stringliteral">      Copy of data where each references to "$(variable)" has been replaced</span>
<a name="l00596"></a>00596 <span class="stringliteral">      by the corresponding value found in substitutions, or left intact if</span>
<a name="l00597"></a>00597 <span class="stringliteral">      the key was not found.</span>
<a name="l00598"></a>00598 <span class="stringliteral">    """</span>
<a name="l00599"></a>00599     <span class="keywordflow">if</span> isinstance(data, str):
<a name="l00600"></a>00600       <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> substitutions.iteritems():
<a name="l00601"></a>00601         data = data.replace(<span class="stringliteral">'$(%s)'</span> % key, value)
<a name="l00602"></a>00602       <span class="keywordflow">return</span> data
<a name="l00603"></a>00603     <span class="keywordflow">if</span> isinstance(data, list):
<a name="l00604"></a>00604       <span class="keywordflow">return</span> [self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4a84c4dc731cf5ad9c15530522a4e340">_ExpandVariables</a>(v, substitutions) <span class="keywordflow">for</span> v <span class="keywordflow">in</span> data]
<a name="l00605"></a>00605     <span class="keywordflow">if</span> isinstance(data, dict):
<a name="l00606"></a>00606       <span class="keywordflow">return</span> dict((k, self.<a class="code" href="../../df/d83/classgyp_1_1mac__tool_1_1_mac_tool.html#4a84c4dc731cf5ad9c15530522a4e340">_ExpandVariables</a>(data[k],
<a name="l00607"></a>00607                                             substitutions)) <span class="keywordflow">for</span> k <span class="keywordflow">in</span> data)
<a name="l00608"></a>00608     <span class="keywordflow">return</span> data
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">'__main__'</span>:
<a name="l00611"></a>00611   sys.exit(main(sys.argv[1:]))
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 7 19:26:26 2015 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
