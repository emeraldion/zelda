<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Sviluppo/SVN/emeraldion.it/zelda/helpers/rss_parser.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Sviluppo/SVN/emeraldion.it/zelda/helpers/rss_parser.php</h1><a href="rss__parser_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00007"></a><a class="code" href="class_r_s_s_parser.html">00007</a>         <span class="keyword">class </span><a class="code" href="class_r_s_s_parser.html" title="Helper class for RSS feed parsing.">RSSParser</a>
<a name="l00008"></a>00008         {
<a name="l00013"></a><a class="code" href="class_r_s_s_parser.html#1ecd7d87fb53086c704d6940be4e4dfd">00013</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#1ecd7d87fb53086c704d6940be4e4dfd" title="The parser.">$parser</a>;
<a name="l00014"></a>00014                 
<a name="l00019"></a><a class="code" href="class_r_s_s_parser.html#0ffbdcd7780161769059b023abc3ba46">00019</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#0ffbdcd7780161769059b023abc3ba46" title="The file of the feed.">$file</a>;
<a name="l00020"></a>00020                 
<a name="l00021"></a><a class="code" href="class_r_s_s_parser.html#964b2a7587a977b850aa5b26618cf1de">00021</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#964b2a7587a977b850aa5b26618cf1de">$isWithinItem</a>;
<a name="l00022"></a><a class="code" href="class_r_s_s_parser.html#905d388fae506be325e3e5d288099806">00022</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#905d388fae506be325e3e5d288099806">$currentItem</a>;
<a name="l00023"></a><a class="code" href="class_r_s_s_parser.html#7b34f76b5f96c4a6d2b929942fff0957">00023</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#7b34f76b5f96c4a6d2b929942fff0957">$currentTag</a>;
<a name="l00024"></a><a class="code" href="class_r_s_s_parser.html#079333cfd814e35c00b09ccbdebb25b5">00024</a>                 <span class="keyword">public</span> <a class="code" href="class_r_s_s_parser.html#079333cfd814e35c00b09ccbdebb25b5">$items</a>;
<a name="l00025"></a>00025                 
<a name="l00031"></a><a class="code" href="class_r_s_s_parser.html#ed225b91093d1b0b96ba2a14c97f8e07">00031</a>                 <span class="keyword">public</span> function <a class="code" href="class_r_s_s_parser.html#ed225b91093d1b0b96ba2a14c97f8e07" title="Constructor for the RSSParser object.">RSSParser</a>($inFile = null)
<a name="l00032"></a>00032                 {
<a name="l00033"></a>00033                         $this-&gt;parser = null;
<a name="l00034"></a>00034                         $this-&gt;file = $inFile;
<a name="l00035"></a>00035                         $this-&gt;isWithinItem = <span class="keyword">false</span>;
<a name="l00036"></a>00036                         $this-&gt;currentItem = array();
<a name="l00037"></a>00037                         $this-&gt;items = array();
<a name="l00038"></a>00038                 }
<a name="l00039"></a>00039                 
<a name="l00045"></a><a class="code" href="class_r_s_s_parser.html#b7a6b58c6c8201fcdfbe1ea71681d813">00045</a>                 <span class="keyword">public</span> function <a class="code" href="class_r_s_s_parser.html#b7a6b58c6c8201fcdfbe1ea71681d813" title="Parses the file.">parseFile</a>($persist = <span class="keyword">false</span>)
<a name="l00046"></a>00046                 {
<a name="l00047"></a>00047                         <span class="keywordflow">if</span> (empty($this-&gt;parser))
<a name="l00048"></a>00048                         {
<a name="l00049"></a>00049                                 error_log(<span class="stringliteral">"No parser, so allocating new xml parser"</span>);
<a name="l00050"></a>00050                                 $this-&gt;parser = xml_parser_create();
<a name="l00051"></a>00051                                 xml_set_object($this-&gt;parser, $this);
<a name="l00052"></a>00052                                 xml_set_element_handler($this-&gt;parser, <span class="stringliteral">"startHandler"</span>, <span class="stringliteral">"endHandler"</span>);
<a name="l00053"></a>00053                                 xml_set_character_data_handler($this-&gt;parser, <span class="stringliteral">"cdataHandler"</span>);
<a name="l00054"></a>00054                         }
<a name="l00055"></a>00055                         
<a name="l00056"></a>00056                         <span class="keywordflow">if</span> (!empty($this-&gt;file))
<a name="l00057"></a>00057                         {
<a name="l00058"></a>00058                                 <span class="comment">// process &amp; parse</span>
<a name="l00059"></a>00059                                 $fp = fopen($this-&gt;file, <span class="charliteral">'r'</span>);
<a name="l00060"></a>00060                                 <span class="keywordflow">if</span> ($fp)
<a name="l00061"></a>00061                                 {
<a name="l00062"></a>00062                                         <span class="comment">// could read the file successfully</span>
<a name="l00063"></a>00063                                         <span class="keywordflow">while</span> ($data = fread($fp, 4096))
<a name="l00064"></a>00064                                         {
<a name="l00065"></a>00065                                                 xml_parse($this-&gt;parser, $data, feof($fp)) 
<a name="l00066"></a>00066                                                         or 
<a name="l00067"></a>00067                                                 error_log(sprintf(      <span class="stringliteral">"Error in parsing XML: %s at line %d"</span>, 
<a name="l00068"></a>00068                                                                                         xml_error_string(xml_get_error_code($this-&gt;parser)),
<a name="l00069"></a>00069                                                                                         xml_get_current_line_number($this-&gt;parser)));
<a name="l00070"></a>00070                                         }
<a name="l00071"></a>00071                                         fclose($fp);
<a name="l00072"></a>00072                                 }
<a name="l00073"></a>00073                                 <span class="keywordflow">else</span>
<a name="l00074"></a>00074                                 {
<a name="l00075"></a>00075                                         error_log(<span class="stringliteral">"Could not read file (name: {$this-&gt;file})."</span>);
<a name="l00076"></a>00076                                 }
<a name="l00077"></a>00077                         }
<a name="l00078"></a>00078                         <span class="keywordflow">else</span>
<a name="l00079"></a>00079                         {
<a name="l00080"></a>00080                                 error_log(<span class="stringliteral">"Could not parse. No file specified."</span>);
<a name="l00081"></a>00081                         }
<a name="l00082"></a>00082                         
<a name="l00083"></a>00083                         <span class="keywordflow">if</span> (!$persist)
<a name="l00084"></a>00084                         {
<a name="l00085"></a>00085                                 xml_parser_free($this-&gt;parser);
<a name="l00086"></a>00086                         }
<a name="l00087"></a>00087                         
<a name="l00088"></a>00088                 }
<a name="l00089"></a>00089                 
<a name="l00090"></a><a class="code" href="class_r_s_s_parser.html#b62e147efa3e4dc63fd4d6b19422cd13">00090</a>                 <span class="keyword">protected</span> function <a class="code" href="class_r_s_s_parser.html#b62e147efa3e4dc63fd4d6b19422cd13">startHandler</a>(<a class="code" href="class_r_s_s_parser.html#1ecd7d87fb53086c704d6940be4e4dfd" title="The parser.">$parser</a>, $tagName, $attrs)
<a name="l00091"></a>00091                 {
<a name="l00092"></a>00092                         <span class="keywordflow">if</span> ($this-&gt;isWithinItem)
<a name="l00093"></a>00093                         {
<a name="l00094"></a>00094                                 $this-&gt;currentTag = $tagName;
<a name="l00095"></a>00095                         }
<a name="l00096"></a>00096                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($tagName == <span class="stringliteral">"ITEM"</span>)
<a name="l00097"></a>00097                         {
<a name="l00098"></a>00098                                 $this-&gt;isWithinItem = <span class="keyword">true</span>;
<a name="l00099"></a>00099                         }
<a name="l00100"></a>00100                 }
<a name="l00101"></a>00101                 
<a name="l00102"></a><a class="code" href="class_r_s_s_parser.html#3d10d0c3b273e8f6f04bf7071ebb1da1">00102</a>                 <span class="keyword">protected</span> function <a class="code" href="class_r_s_s_parser.html#3d10d0c3b273e8f6f04bf7071ebb1da1">endHandler</a>(<a class="code" href="class_r_s_s_parser.html#1ecd7d87fb53086c704d6940be4e4dfd" title="The parser.">$parser</a>, $tagName)
<a name="l00103"></a>00103                 {
<a name="l00104"></a>00104                         <span class="keywordflow">if</span> ($tagName == <span class="stringliteral">"ITEM"</span>)
<a name="l00105"></a>00105                         {
<a name="l00106"></a>00106                                 $this-&gt;items[] = $this-&gt;currentItem; <span class="comment">// could be $this-&gt;items[$this-&gt;currentItem['title']] = $this-&gt;currentItem to use titles as keys</span>
<a name="l00107"></a>00107                                 $this-&gt;currentItem = array();
<a name="l00108"></a>00108                                 $this-&gt;currentTag = <span class="stringliteral">''</span>;
<a name="l00109"></a>00109                                 $this-&gt;isWithinItem = <span class="keyword">false</span>;
<a name="l00110"></a>00110                         }
<a name="l00111"></a>00111                 }
<a name="l00112"></a>00112                 
<a name="l00113"></a><a class="code" href="class_r_s_s_parser.html#74f9f05cacf49b885c6fd6b03b021539">00113</a>                 <span class="keyword">protected</span> function <a class="code" href="class_r_s_s_parser.html#74f9f05cacf49b885c6fd6b03b021539">cdataHandler</a>(<a class="code" href="class_r_s_s_parser.html#1ecd7d87fb53086c704d6940be4e4dfd" title="The parser.">$parser</a>, $cdata)
<a name="l00114"></a>00114                 {
<a name="l00115"></a>00115                         <span class="keywordflow">if</span> ($this-&gt;isWithinItem)
<a name="l00116"></a>00116                         {
<a name="l00117"></a>00117                                 $trimmedData = trim($cdata);
<a name="l00118"></a>00118                                 <span class="keywordflow">if</span> (!empty($trimmedData) &amp;&amp; isset($this-&gt;currentTag) &amp;&amp; !empty($this-&gt;currentTag))
<a name="l00119"></a>00119                                 {
<a name="l00120"></a>00120                                         <span class="keywordflow">if</span> (!isset($this-&gt;currentItem[strtolower($this-&gt;currentTag)]))
<a name="l00121"></a>00121                                         {
<a name="l00122"></a>00122                                                 $this-&gt;currentItem[strtolower($this-&gt;currentTag)] = <span class="stringliteral">""</span>;
<a name="l00123"></a>00123                                         }
<a name="l00124"></a>00124                                         $this-&gt;currentItem[strtolower($this-&gt;currentTag)] .= $trimmedData;
<a name="l00125"></a>00125                                 }
<a name="l00126"></a>00126                         }
<a name="l00127"></a>00127                 }
<a name="l00128"></a>00128                 
<a name="l00133"></a><a class="code" href="class_r_s_s_parser.html#cc477f87d168ab60041bc258e99dc21d">00133</a>                 <span class="keyword">public</span> function <a class="code" href="class_r_s_s_parser.html#cc477f87d168ab60041bc258e99dc21d" title="Releases the parser object.">release</a>() {
<a name="l00134"></a>00134                         xml_parser_free($this-&gt;parser);
<a name="l00135"></a>00135                         unset($this);
<a name="l00136"></a>00136                 }
<a name="l00137"></a>00137                 
<a name="l00142"></a><a class="code" href="class_r_s_s_parser.html#7e1480066e1b5ab57a8cfab52795414f">00142</a>                 <span class="keyword">public</span> function <a class="code" href="class_r_s_s_parser.html#7e1480066e1b5ab57a8cfab52795414f" title="Tells whether the feed has item elements.">hasItems</a>() {
<a name="l00143"></a>00143                         <span class="keywordflow">return</span> (count($this-&gt;items) &gt; 0);
<a name="l00144"></a>00144                 }
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 ?&gt;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon May 5 23:47:20 2008 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
