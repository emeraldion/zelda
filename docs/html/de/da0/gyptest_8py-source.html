<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Emeraldion Lodge (codename Zelda): /Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/gyptest.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css">
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/Users/delphine/Development/SVN/emeraldion.it/zelda/node_modules/gulp-sass/node_modules/node-sass/node_modules/node-gyp/gyp/gyptest.py</h1><a href="../../dc/dd2/gyptest_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d8/da6/namespacegyptest.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment"># Copyright (c) 2012 Google Inc. All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"># Use of this source code is governed by a BSD-style license that can be</span>
<a name="l00005"></a>00005 <span class="comment"># found in the LICENSE file.</span>
<a name="l00006"></a>00006 
<a name="l00007"></a><a class="code" href="../../d8/da6/namespacegyptest.html#11ffff3b9d8054f0b1df1776ac06eecc">00007</a> __doc__ = <span class="stringliteral">"""</span>
<a name="l00008"></a>00008 <span class="stringliteral">gyptest.py -- test runner for GYP tests.</span>
<a name="l00009"></a>00009 <span class="stringliteral">"""</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="keyword">import</span> os
<a name="l00012"></a>00012 <span class="keyword">import</span> optparse
<a name="l00013"></a>00013 <span class="keyword">import</span> subprocess
<a name="l00014"></a>00014 <span class="keyword">import</span> sys
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html">00016</a> <span class="keyword">class </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html">CommandRunner</a>(object):
<a name="l00017"></a>00017   <span class="stringliteral">"""</span>
<a name="l00018"></a>00018 <span class="stringliteral">  Executor class for commands, including "commands" implemented by</span>
<a name="l00019"></a>00019 <span class="stringliteral">  Python functions.</span>
<a name="l00020"></a>00020 <span class="stringliteral">  """</span>
<a name="l00021"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#a9e289eddb591991c9bc7321dc5b186b">00021</a>   verbose = <span class="keyword">True</span>
<a name="l00022"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#aebf392084a5bb0210fa5b154954895b">00022</a>   active = <span class="keyword">True</span>
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#c775ee34451fdfa742b318538164070e">00024</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#c775ee34451fdfa742b318538164070e">__init__</a>(self, dictionary={}):
<a name="l00025"></a>00025     self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#8b827c0b6a859f904132e47b0a8ffebf">subst_dictionary</a>(dictionary)
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#8b827c0b6a859f904132e47b0a8ffebf">00027</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#8b827c0b6a859f904132e47b0a8ffebf">subst_dictionary</a>(self, dictionary):
<a name="l00028"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#cb8c896d6dc55bb5b28070a5580f686c">00028</a>     self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#cb8c896d6dc55bb5b28070a5580f686c">_subst_dictionary</a> = dictionary
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#fbd196f658dfa916d21b8ebf719606df">00030</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#fbd196f658dfa916d21b8ebf719606df">subst</a>(self, string, dictionary=None):
<a name="l00031"></a>00031     <span class="stringliteral">"""</span>
<a name="l00032"></a>00032 <span class="stringliteral">    Substitutes (via the format operator) the values in the specified</span>
<a name="l00033"></a>00033 <span class="stringliteral">    dictionary into the specified command.</span>
<a name="l00034"></a>00034 <span class="stringliteral"></span>
<a name="l00035"></a>00035 <span class="stringliteral">    The command can be an (action, string) tuple.  In all cases, we</span>
<a name="l00036"></a>00036 <span class="stringliteral">    perform substitution on strings and don't worry if something isn't</span>
<a name="l00037"></a>00037 <span class="stringliteral">    a string.  (It's probably a Python function to be executed.)</span>
<a name="l00038"></a>00038 <span class="stringliteral">    """</span>
<a name="l00039"></a>00039     <span class="keywordflow">if</span> dictionary <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00040"></a>00040       dictionary = self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#cb8c896d6dc55bb5b28070a5580f686c">_subst_dictionary</a>
<a name="l00041"></a>00041     <span class="keywordflow">if</span> dictionary:
<a name="l00042"></a>00042       <span class="keywordflow">try</span>:
<a name="l00043"></a>00043         string = string % dictionary
<a name="l00044"></a>00044       <span class="keywordflow">except</span> TypeError:
<a name="l00045"></a>00045         <span class="keywordflow">pass</span>
<a name="l00046"></a>00046     <span class="keywordflow">return</span> string
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#610714a2de3e4dadca4027bca4b71460">00048</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#610714a2de3e4dadca4027bca4b71460">display</a>(self, command, stdout=None, stderr=None):
<a name="l00049"></a>00049     <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#a9e289eddb591991c9bc7321dc5b186b">verbose</a>:
<a name="l00050"></a>00050       <span class="keywordflow">return</span>
<a name="l00051"></a>00051     <span class="keywordflow">if</span> type(command) == type(()):
<a name="l00052"></a>00052       func = command[0]
<a name="l00053"></a>00053       args = command[1:]
<a name="l00054"></a>00054       s = <span class="stringliteral">'%s(%s)'</span> % (func.__name__, <span class="stringliteral">', '</span>.join(map(repr, args)))
<a name="l00055"></a>00055     <span class="keywordflow">if</span> type(command) == type([]):
<a name="l00056"></a>00056       <span class="comment"># TODO:  quote arguments containing spaces</span>
<a name="l00057"></a>00057       <span class="comment"># TODO:  handle meta characters?</span>
<a name="l00058"></a>00058       s = <span class="stringliteral">' '</span>.join(command)
<a name="l00059"></a>00059     <span class="keywordflow">else</span>:
<a name="l00060"></a>00060       s = self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#fbd196f658dfa916d21b8ebf719606df">subst</a>(command)
<a name="l00061"></a>00061     <span class="keywordflow">if</span> <span class="keywordflow">not</span> s.endswith(<span class="stringliteral">'\n'</span>):
<a name="l00062"></a>00062       s += <span class="stringliteral">'\n'</span>
<a name="l00063"></a>00063     sys.stdout.write(s)
<a name="l00064"></a>00064     sys.stdout.flush()
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#d4a3a293739ba23e084f19c685303590">00066</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#d4a3a293739ba23e084f19c685303590">execute</a>(self, command, stdout=None, stderr=None):
<a name="l00067"></a>00067     <span class="stringliteral">"""</span>
<a name="l00068"></a>00068 <span class="stringliteral">    Executes a single command.</span>
<a name="l00069"></a>00069 <span class="stringliteral">    """</span>
<a name="l00070"></a>00070     <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#aebf392084a5bb0210fa5b154954895b">active</a>:
<a name="l00071"></a>00071       <span class="keywordflow">return</span> 0
<a name="l00072"></a>00072     <span class="keywordflow">if</span> type(command) == type(<span class="stringliteral">''</span>):
<a name="l00073"></a>00073       command = self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#fbd196f658dfa916d21b8ebf719606df">subst</a>(command)
<a name="l00074"></a>00074       cmdargs = shlex.split(command)
<a name="l00075"></a>00075       <span class="keywordflow">if</span> cmdargs[0] == <span class="stringliteral">'cd'</span>:
<a name="l00076"></a>00076          command = (os.chdir,) + tuple(cmdargs[1:])
<a name="l00077"></a>00077     <span class="keywordflow">if</span> type(command) == type(()):
<a name="l00078"></a>00078       func = command[0]
<a name="l00079"></a>00079       args = command[1:]
<a name="l00080"></a>00080       <span class="keywordflow">return</span> func(*args)
<a name="l00081"></a>00081     <span class="keywordflow">else</span>:
<a name="l00082"></a>00082       <span class="keywordflow">if</span> stdout <span class="keywordflow">is</span> sys.stdout:
<a name="l00083"></a>00083         <span class="comment"># Same as passing sys.stdout, except python2.4 doesn't fail on it.</span>
<a name="l00084"></a>00084         subout = <span class="keywordtype">None</span>
<a name="l00085"></a>00085       <span class="keywordflow">else</span>:
<a name="l00086"></a>00086         <span class="comment"># Open pipe for anything else so Popen works on python2.4.</span>
<a name="l00087"></a>00087         subout = subprocess.PIPE
<a name="l00088"></a>00088       <span class="keywordflow">if</span> stderr <span class="keywordflow">is</span> sys.stderr:
<a name="l00089"></a>00089         <span class="comment"># Same as passing sys.stderr, except python2.4 doesn't fail on it.</span>
<a name="l00090"></a>00090         suberr = <span class="keywordtype">None</span>
<a name="l00091"></a>00091       <span class="keywordflow">elif</span> stderr <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00092"></a>00092         <span class="comment"># Merge with stdout if stderr isn't specified.</span>
<a name="l00093"></a>00093         suberr = subprocess.STDOUT
<a name="l00094"></a>00094       <span class="keywordflow">else</span>:
<a name="l00095"></a>00095         <span class="comment"># Open pipe for anything else so Popen works on python2.4.</span>
<a name="l00096"></a>00096         suberr = subprocess.PIPE
<a name="l00097"></a>00097       p = subprocess.Popen(command,
<a name="l00098"></a>00098                            shell=(sys.platform == <span class="stringliteral">'win32'</span>),
<a name="l00099"></a>00099                            stdout=subout,
<a name="l00100"></a>00100                            stderr=suberr)
<a name="l00101"></a>00101       p.wait()
<a name="l00102"></a>00102       <span class="keywordflow">if</span> stdout <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00103"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#e6b0515ae8a991c3aa2c521bcc11953b">00103</a>         self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#e6b0515ae8a991c3aa2c521bcc11953b">stdout</a> = p.stdout.read()
<a name="l00104"></a>00104       <span class="keywordflow">elif</span> stdout <span class="keywordflow">is</span> <span class="keywordflow">not</span> sys.stdout:
<a name="l00105"></a>00105         stdout.write(p.stdout.read())
<a name="l00106"></a>00106       <span class="keywordflow">if</span> stderr <span class="keywordflow">not</span> <span class="keywordflow">in</span> (<span class="keywordtype">None</span>, sys.stderr):
<a name="l00107"></a>00107         stderr.write(p.stderr.read())
<a name="l00108"></a>00108       <span class="keywordflow">return</span> p.returncode
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#edcaade7dd45761ddcc3b3cc07005314">00110</a>   <span class="keyword">def </span><a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#edcaade7dd45761ddcc3b3cc07005314">run</a>(self, command, display=None, stdout=None, stderr=None):
<a name="l00111"></a>00111     <span class="stringliteral">"""</span>
<a name="l00112"></a>00112 <span class="stringliteral">    Runs a single command, displaying it first.</span>
<a name="l00113"></a>00113 <span class="stringliteral">    """</span>
<a name="l00114"></a>00114     <span class="keywordflow">if</span> display <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00115"></a>00115       display = command
<a name="l00116"></a>00116     self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#610714a2de3e4dadca4027bca4b71460">display</a>(display)
<a name="l00117"></a>00117     <span class="keywordflow">return</span> self.<a class="code" href="../../d2/d5f/classgyptest_1_1_command_runner.html#d4a3a293739ba23e084f19c685303590">execute</a>(command, stdout, stderr)
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html">00120</a> <span class="keyword">class </span><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html">Unbuffered</a>(object):
<a name="l00121"></a><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#c775ee34451fdfa742b318538164070e">00121</a>   <span class="keyword">def </span><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#c775ee34451fdfa742b318538164070e">__init__</a>(self, fp):
<a name="l00122"></a><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#883a1b899b644be7fc6d704c1d8e0c04">00122</a>     self.<a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#883a1b899b644be7fc6d704c1d8e0c04">fp</a> = fp
<a name="l00123"></a><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#8c7fc40f1124fcf3f5ee7116cd62f413">00123</a>   <span class="keyword">def </span><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#8c7fc40f1124fcf3f5ee7116cd62f413">write</a>(self, arg):
<a name="l00124"></a>00124     self.<a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#883a1b899b644be7fc6d704c1d8e0c04">fp</a>.write(arg)
<a name="l00125"></a>00125     self.<a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#883a1b899b644be7fc6d704c1d8e0c04">fp</a>.flush()
<a name="l00126"></a><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#0a990b3ec3889d40889daca9ee5e4695">00126</a>   <span class="keyword">def </span><a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#0a990b3ec3889d40889daca9ee5e4695">__getattr__</a>(self, attr):
<a name="l00127"></a>00127     <span class="keywordflow">return</span> getattr(self.<a class="code" href="../../dd/dd6/classgyptest_1_1_unbuffered.html#883a1b899b644be7fc6d704c1d8e0c04">fp</a>, attr)
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 sys.stdout = Unbuffered(sys.stdout)
<a name="l00130"></a>00130 sys.stderr = Unbuffered(sys.stderr)
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="../../d8/da6/namespacegyptest.html#f7fa8f01e08dda505fdfea9ca299cd9b">00133</a> <span class="keyword">def </span><a class="code" href="../../d8/da6/namespacegyptest.html#f7fa8f01e08dda505fdfea9ca299cd9b">is_test_name</a>(f):
<a name="l00134"></a>00134   <span class="keywordflow">return</span> f.startswith(<span class="stringliteral">'gyptest'</span>) <span class="keywordflow">and</span> f.endswith(<span class="stringliteral">'.py'</span>)
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="../../d8/da6/namespacegyptest.html#5c4ab84bbaeb41400c28a81068f6cec9">00137</a> <span class="keyword">def </span><a class="code" href="../../d8/da6/namespacegyptest.html#5c4ab84bbaeb41400c28a81068f6cec9">find_all_gyptest_files</a>(directory):
<a name="l00138"></a>00138   result = []
<a name="l00139"></a>00139   <span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(directory):
<a name="l00140"></a>00140     <span class="keywordflow">if</span> <span class="stringliteral">'.svn'</span> <span class="keywordflow">in</span> dirs:
<a name="l00141"></a>00141       dirs.remove(<span class="stringliteral">'.svn'</span>)
<a name="l00142"></a>00142     result.extend([ os.path.join(root, f) <span class="keywordflow">for</span> f <span class="keywordflow">in</span> files <span class="keywordflow">if</span> is_test_name(f) ])
<a name="l00143"></a>00143   result.sort()
<a name="l00144"></a>00144   <span class="keywordflow">return</span> result
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="../../d8/da6/namespacegyptest.html#15568dc1ba3f036571b8e20d4baeabfc">00147</a> <span class="keyword">def </span><a class="code" href="../../d8/da6/namespacegyptest.html#15568dc1ba3f036571b8e20d4baeabfc">main</a>(argv=None):
<a name="l00148"></a>00148   <span class="keywordflow">if</span> argv <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00149"></a>00149     argv = sys.argv
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   usage = <span class="stringliteral">"gyptest.py [-ahlnq] [-f formats] [test ...]"</span>
<a name="l00152"></a>00152   parser = optparse.OptionParser(usage=usage)
<a name="l00153"></a>00153   parser.add_option(<span class="stringliteral">"-a"</span>, <span class="stringliteral">"--all"</span>, action=<span class="stringliteral">"store_true"</span>,
<a name="l00154"></a>00154             help=<span class="stringliteral">"run all tests"</span>)
<a name="l00155"></a>00155   parser.add_option(<span class="stringliteral">"-C"</span>, <span class="stringliteral">"--chdir"</span>, action=<span class="stringliteral">"store"</span>, default=<span class="keywordtype">None</span>,
<a name="l00156"></a>00156             help=<span class="stringliteral">"chdir to the specified directory"</span>)
<a name="l00157"></a>00157   parser.add_option(<span class="stringliteral">"-f"</span>, <span class="stringliteral">"--format"</span>, action=<span class="stringliteral">"store"</span>, default=<span class="stringliteral">''</span>,
<a name="l00158"></a>00158             help=<span class="stringliteral">"run tests with the specified formats"</span>)
<a name="l00159"></a>00159   parser.add_option(<span class="stringliteral">"-G"</span>, <span class="stringliteral">'--gyp_option'</span>, action=<span class="stringliteral">"append"</span>, default=[],
<a name="l00160"></a>00160             help=<span class="stringliteral">"Add -G options to the gyp command line"</span>)
<a name="l00161"></a>00161   parser.add_option(<span class="stringliteral">"-l"</span>, <span class="stringliteral">"--list"</span>, action=<span class="stringliteral">"store_true"</span>,
<a name="l00162"></a>00162             help=<span class="stringliteral">"list available tests and exit"</span>)
<a name="l00163"></a>00163   parser.add_option(<span class="stringliteral">"-n"</span>, <span class="stringliteral">"--no-exec"</span>, action=<span class="stringliteral">"store_true"</span>,
<a name="l00164"></a>00164             help=<span class="stringliteral">"no execute, just print the command line"</span>)
<a name="l00165"></a>00165   parser.add_option(<span class="stringliteral">"--passed"</span>, action=<span class="stringliteral">"store_true"</span>,
<a name="l00166"></a>00166             help=<span class="stringliteral">"report passed tests"</span>)
<a name="l00167"></a>00167   parser.add_option(<span class="stringliteral">"--path"</span>, action=<span class="stringliteral">"append"</span>, default=[],
<a name="l00168"></a>00168             help=<span class="stringliteral">"additional $PATH directory"</span>)
<a name="l00169"></a>00169   parser.add_option(<span class="stringliteral">"-q"</span>, <span class="stringliteral">"--quiet"</span>, action=<span class="stringliteral">"store_true"</span>,
<a name="l00170"></a>00170             help=<span class="stringliteral">"quiet, don't print test command lines"</span>)
<a name="l00171"></a>00171   opts, args = parser.parse_args(argv[1:])
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordflow">if</span> opts.chdir:
<a name="l00174"></a>00174     os.chdir(opts.chdir)
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="keywordflow">if</span> opts.path:
<a name="l00177"></a>00177     extra_path = [os.path.abspath(p) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> opts.path]
<a name="l00178"></a>00178     extra_path = os.pathsep.join(extra_path)
<a name="l00179"></a>00179     os.environ[<span class="stringliteral">'PATH'</span>] = extra_path + os.pathsep + os.environ[<span class="stringliteral">'PATH'</span>]
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">if</span> <span class="keywordflow">not</span> args:
<a name="l00182"></a>00182     <span class="keywordflow">if</span> <span class="keywordflow">not</span> opts.all:
<a name="l00183"></a>00183       sys.stderr.write(<span class="stringliteral">'Specify -a to get all tests.\n'</span>)
<a name="l00184"></a>00184       <span class="keywordflow">return</span> 1
<a name="l00185"></a>00185     args = [<span class="stringliteral">'test'</span>]
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   tests = []
<a name="l00188"></a>00188   <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> args:
<a name="l00189"></a>00189     <span class="keywordflow">if</span> os.path.isdir(arg):
<a name="l00190"></a>00190       tests.extend(find_all_gyptest_files(os.path.normpath(arg)))
<a name="l00191"></a>00191     <span class="keywordflow">else</span>:
<a name="l00192"></a>00192       <span class="keywordflow">if</span> <span class="keywordflow">not</span> is_test_name(os.path.basename(arg)):
<a name="l00193"></a>00193         <span class="keywordflow">print</span> &gt;&gt;sys.stderr, arg, <span class="stringliteral">'is not a valid gyp test name.'</span>
<a name="l00194"></a>00194         sys.exit(1)
<a name="l00195"></a>00195       tests.append(arg)
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="keywordflow">if</span> opts.list:
<a name="l00198"></a>00198     <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00199"></a>00199       <span class="keywordflow">print</span> test
<a name="l00200"></a>00200     sys.exit(0)
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   CommandRunner.verbose = <span class="keywordflow">not</span> opts.quiet
<a name="l00203"></a>00203   CommandRunner.active = <span class="keywordflow">not</span> opts.no_exec
<a name="l00204"></a>00204   cr = CommandRunner()
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   os.environ[<span class="stringliteral">'PYTHONPATH'</span>] = os.path.abspath(<span class="stringliteral">'test/lib'</span>)
<a name="l00207"></a>00207   <span class="keywordflow">if</span> <span class="keywordflow">not</span> opts.quiet:
<a name="l00208"></a>00208     sys.stdout.write(<span class="stringliteral">'PYTHONPATH=%s\n'</span> % os.environ[<span class="stringliteral">'PYTHONPATH'</span>])
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   passed = []
<a name="l00211"></a>00211   failed = []
<a name="l00212"></a>00212   no_result = []
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="keywordflow">if</span> opts.format:
<a name="l00215"></a>00215     format_list = opts.format.split(<span class="stringliteral">','</span>)
<a name="l00216"></a>00216   <span class="keywordflow">else</span>:
<a name="l00217"></a>00217     <span class="comment"># TODO:  not duplicate this mapping from pylib/gyp/__init__.py</span>
<a name="l00218"></a>00218     format_list = {
<a name="l00219"></a>00219       <span class="stringliteral">'aix5'</span>:     [<span class="stringliteral">'make'</span>],
<a name="l00220"></a>00220       <span class="stringliteral">'freebsd7'</span>: [<span class="stringliteral">'make'</span>],
<a name="l00221"></a>00221       <span class="stringliteral">'freebsd8'</span>: [<span class="stringliteral">'make'</span>],
<a name="l00222"></a>00222       <span class="stringliteral">'openbsd5'</span>: [<span class="stringliteral">'make'</span>],
<a name="l00223"></a>00223       <span class="stringliteral">'cygwin'</span>:   [<span class="stringliteral">'msvs'</span>],
<a name="l00224"></a>00224       <span class="stringliteral">'win32'</span>:    [<span class="stringliteral">'msvs'</span>, <span class="stringliteral">'ninja'</span>],
<a name="l00225"></a>00225       <span class="stringliteral">'linux2'</span>:   [<span class="stringliteral">'make'</span>, <span class="stringliteral">'ninja'</span>],
<a name="l00226"></a>00226       <span class="stringliteral">'linux3'</span>:   [<span class="stringliteral">'make'</span>, <span class="stringliteral">'ninja'</span>],
<a name="l00227"></a>00227       <span class="stringliteral">'darwin'</span>:   [<span class="stringliteral">'make'</span>, <span class="stringliteral">'ninja'</span>, <span class="stringliteral">'xcode'</span>, <span class="stringliteral">'xcode-ninja'</span>],
<a name="l00228"></a>00228     }[sys.platform]
<a name="l00229"></a>00229 
<a name="l00230"></a>00230   <span class="keywordflow">for</span> format <span class="keywordflow">in</span> format_list:
<a name="l00231"></a>00231     os.environ[<span class="stringliteral">'TESTGYP_FORMAT'</span>] = format
<a name="l00232"></a>00232     <span class="keywordflow">if</span> <span class="keywordflow">not</span> opts.quiet:
<a name="l00233"></a>00233       sys.stdout.write(<span class="stringliteral">'TESTGYP_FORMAT=%s\n'</span> % format)
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     gyp_options = []
<a name="l00236"></a>00236     <span class="keywordflow">for</span> option <span class="keywordflow">in</span> opts.gyp_option:
<a name="l00237"></a>00237       gyp_options += [<span class="stringliteral">'-G'</span>, option]
<a name="l00238"></a>00238     <span class="keywordflow">if</span> gyp_options <span class="keywordflow">and</span> <span class="keywordflow">not</span> opts.quiet:
<a name="l00239"></a>00239       sys.stdout.write(<span class="stringliteral">'Extra Gyp options: %s\n'</span> % gyp_options)
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00242"></a>00242       status = cr.run([sys.executable, test] + gyp_options,
<a name="l00243"></a>00243                       stdout=sys.stdout,
<a name="l00244"></a>00244                       stderr=sys.stderr)
<a name="l00245"></a>00245       <span class="keywordflow">if</span> status == 2:
<a name="l00246"></a>00246         no_result.append(test)
<a name="l00247"></a>00247       <span class="keywordflow">elif</span> status:
<a name="l00248"></a>00248         failed.append(test)
<a name="l00249"></a>00249       <span class="keywordflow">else</span>:
<a name="l00250"></a>00250         passed.append(test)
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="keywordflow">if</span> <span class="keywordflow">not</span> opts.quiet:
<a name="l00253"></a>00253     <span class="keyword">def </span>report(description, tests):
<a name="l00254"></a>00254       <span class="keywordflow">if</span> tests:
<a name="l00255"></a>00255         <span class="keywordflow">if</span> len(tests) == 1:
<a name="l00256"></a>00256           sys.stdout.write(<span class="stringliteral">"\n%s the following test:\n"</span> % description)
<a name="l00257"></a>00257         <span class="keywordflow">else</span>:
<a name="l00258"></a>00258           fmt = <span class="stringliteral">"\n%s the following %d tests:\n"</span>
<a name="l00259"></a>00259           sys.stdout.write(fmt % (description, len(tests)))
<a name="l00260"></a>00260         sys.stdout.write(<span class="stringliteral">"\t"</span> + <span class="stringliteral">"\n\t"</span>.join(tests) + <span class="stringliteral">"\n"</span>)
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">if</span> opts.passed:
<a name="l00263"></a>00263       report(<span class="stringliteral">"Passed"</span>, passed)
<a name="l00264"></a>00264     report(<span class="stringliteral">"Failed"</span>, failed)
<a name="l00265"></a>00265     report(<span class="stringliteral">"No result from"</span>, no_result)
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="keywordflow">if</span> failed:
<a name="l00268"></a>00268     <span class="keywordflow">return</span> 1
<a name="l00269"></a>00269   <span class="keywordflow">else</span>:
<a name="l00270"></a>00270     <span class="keywordflow">return</span> 0
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">"__main__"</span>:
<a name="l00274"></a>00274   sys.exit(main())
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Oct 7 19:26:25 2015 for Emeraldion Lodge (codename Zelda) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
